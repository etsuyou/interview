<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Nginx 配置 | 前端笔记</title>
    <meta name="description" content="整理了常见的前端面试问题，希望对大家有所帮助">
    <meta name="generator" content="VitePress v1.2.3">
    <link rel="preload stylesheet" href="/assets/style.CTsPrQqq.css" as="style">
    
    <script type="module" src="/assets/app.DxgFk6Eo.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.B2xMVIVo.js">
    <link rel="modulepreload" href="/assets/chunks/theme.BeUm4wlt.js">
    <link rel="modulepreload" href="/assets/nginx_03-nginx-configuration.md.DTJfc777.lean.js">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-5d98c3a5><!--[--><!--]--><!--[--><span tabindex="-1" data-v-0f60ec36></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-0f60ec36> Skip to content </a><!--]--><!----><header class="VPNav" data-v-5d98c3a5 data-v-ae24b3ad><div class="VPNavBar has-sidebar top" data-v-ae24b3ad data-v-ccf7ddec><div class="wrapper" data-v-ccf7ddec><div class="container" data-v-ccf7ddec><div class="title" data-v-ccf7ddec><div class="VPNavBarTitle has-sidebar" data-v-ccf7ddec data-v-ab179fa1><a class="title" href="/" data-v-ab179fa1><!--[--><!--]--><!--[--><img class="VPImage logo" src="/1024x1024.png" alt data-v-8426fc1a><!--]--><span data-v-ab179fa1>前端笔记</span><!--[--><!--]--></a></div></div><div class="content" data-v-ccf7ddec><div class="content-body" data-v-ccf7ddec><!--[--><!--]--><div class="VPNavBarSearch search" data-v-ccf7ddec><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索文档"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">搜索文档</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-ccf7ddec data-v-7f418b0f><span id="main-nav-aria-label" class="visually-hidden" data-v-7f418b0f>Main Navigation</span><!--[--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-b6c34ac9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-b6c34ac9><span class="text" data-v-b6c34ac9><!----><span data-v-b6c34ac9>面试题</span><span class="vpi-chevron-down text-icon" data-v-b6c34ac9></span></span></button><div class="menu" data-v-b6c34ac9><div class="VPMenu" data-v-b6c34ac9 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/interview/css.html" data-v-43f1e123><!--[-->CSS<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/interview/js.html" data-v-43f1e123><!--[-->JS<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/interview/miniapp.html" data-v-43f1e123><!--[-->小程序<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/interview/vue-hangzhou.html" data-v-43f1e123><!--[-->Vue<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-b6c34ac9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-b6c34ac9><span class="text" data-v-b6c34ac9><!----><span data-v-b6c34ac9>部署</span><span class="vpi-chevron-down text-icon" data-v-b6c34ac9></span></span></button><div class="menu" data-v-b6c34ac9><div class="VPMenu" data-v-b6c34ac9 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/nginx/00-nginx-introduction.html" data-v-43f1e123><!--[-->nginx<!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-b6c34ac9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-b6c34ac9><span class="text" data-v-b6c34ac9><!----><span data-v-b6c34ac9>教程</span><span class="vpi-chevron-down text-icon" data-v-b6c34ac9></span></span></button><div class="menu" data-v-b6c34ac9><div class="VPMenu" data-v-b6c34ac9 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuLink" data-v-e7ea1737 data-v-43f1e123><a class="VPLink link" href="/tutorial/index.html" data-v-43f1e123><!--[-->介绍<!--]--></a></div><!--]--><!--[--><div class="VPMenuGroup" data-v-e7ea1737 data-v-69e747b5><p class="title" data-v-69e747b5>教程目录</p><!--[--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/tutorial/00-%E5%89%8D%E7%AB%AF%E5%B7%A5%E5%85%B7/01-VS%20Code%E7%9A%84%E4%BD%BF%E7%94%A8.html" data-v-43f1e123><!--[-->00-前端工具<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/tutorial/01-HTML/01-%E8%AE%A4%E8%AF%86Web%E5%92%8CWeb%E6%A0%87%E5%87%86.html" data-v-43f1e123><!--[-->01-HTML<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/tutorial/02-CSS%E5%9F%BA%E7%A1%80/01-CSS%E5%B1%9E%E6%80%A7%EF%BC%9A%E5%AD%97%E4%BD%93%E5%B1%9E%E6%80%A7%E5%92%8C%E6%96%87%E6%9C%AC%E5%B1%9E%E6%80%A7.html" data-v-43f1e123><!--[-->02-CSS基础<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/tutorial/03-CSS%E8%BF%9B%E9%98%B6/00-%E5%87%86%E5%A4%87.html" data-v-43f1e123><!--[-->03-CSS进阶<!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-7f418b0f data-v-b6c34ac9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-b6c34ac9><span class="text" data-v-b6c34ac9><!----><span data-v-b6c34ac9>面试官系列</span><span class="vpi-chevron-down text-icon" data-v-b6c34ac9></span></span></button><div class="menu" data-v-b6c34ac9><div class="VPMenu" data-v-b6c34ac9 data-v-e7ea1737><div class="items" data-v-e7ea1737><!--[--><!--[--><div class="VPMenuGroup" data-v-e7ea1737 data-v-69e747b5><p class="title" data-v-69e747b5>Vue系列</p><!--[--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/vue/vue.html" data-v-43f1e123><!--[-->Vue<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/vue3/goal.html" data-v-43f1e123><!--[-->Vue3<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-e7ea1737 data-v-69e747b5><p class="title" data-v-69e747b5>JavaScript系列</p><!--[--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/javascript/data_type.html" data-v-43f1e123><!--[-->JavaScript<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/es6/var_let_const.html" data-v-43f1e123><!--[-->ES6<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/typescript/typescript_javascript.html" data-v-43f1e123><!--[-->TypeScript<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-e7ea1737 data-v-69e747b5><p class="title" data-v-69e747b5>CSS系列</p><!--[--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/css/box.html" data-v-43f1e123><!--[-->CSS<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-e7ea1737 data-v-69e747b5><p class="title" data-v-69e747b5>小程序系列</p><!--[--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/applet/applet.html" data-v-43f1e123><!--[-->小程序<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-e7ea1737 data-v-69e747b5><p class="title" data-v-69e747b5>环境和打包系列</p><!--[--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/webpack/webpack.html" data-v-43f1e123><!--[-->Webpack<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/nodejs/nodejs.html" data-v-43f1e123><!--[-->NodeJS<!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-e7ea1737 data-v-69e747b5><p class="title" data-v-69e747b5>计算机通识</p><!--[--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/http/HTTP_HTTPS.html" data-v-43f1e123><!--[-->HTTP<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/algorithm/Algorithm.html" data-v-43f1e123><!--[-->算法与数据结构<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/linux/linux.html" data-v-43f1e123><!--[-->Linux<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/git/Version_control.html" data-v-43f1e123><!--[-->版本控制<!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-69e747b5 data-v-43f1e123><a class="VPLink link" href="/design/design.html" data-v-43f1e123><!--[-->设计模式<!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-ccf7ddec data-v-e6aabb21><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-e6aabb21 data-v-d1f28634 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-d1f28634></span><span class="vpi-moon moon" data-v-d1f28634></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-ccf7ddec data-v-0394ad82 data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/etsuyou" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-eee4e7cb><span class="vpi-social-github" /></a><a class="VPSocialLink no-icon" href="https://gitee.com/etsuyou" aria-label target="_blank" rel="noopener" data-v-7bc22406 data-v-eee4e7cb>
            <svg t="1713377554330" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="12062" data-darkreader-inline-fill="" width="200" height="200"><path d="M511.317333 0A512 512 0 0 0 0 512a512 512 0 0 0 512 512 512 512 0 0 0 512-512A512 512 0 0 0 512 0a512 512 0 0 0-0.682667 0z m259.84 227.541333c13.994667 0 25.301333 11.349333 25.258667 25.301334v63.232a25.344 25.344 0 0 1-25.301333 25.258666H417.152c-41.898667 0-75.861333 33.962667-75.861333 75.861334v240.213333c0 13.952 11.349333 25.258667 25.301333 25.258667h240.213333c41.898667 0 75.861333-33.962667 75.861334-75.861334v-12.629333a25.301333 25.301333 0 0 0-25.258667-25.301333h-177.066667a25.258667 25.258667 0 0 1-25.258666-25.258667v-63.232a25.301333 25.301333 0 0 1 25.301333-25.258667h290.773333c13.952 0 25.301333 11.306667 25.301334 25.258667v145.408a170.666667 170.666667 0 0 1-170.666667 170.666667H252.842667a25.301333 25.301333 0 0 1-25.301334-25.301334V417.194667a189.610667 189.610667 0 0 1 189.653334-189.610667h353.962666z" p-id="12063"></path></svg></a><a class="VPSocialLink no-icon" href="https://space.bilibili.com/13716124" aria-label target="_blank" rel="noopener" data-v-7bc22406 data-v-eee4e7cb>
            <svg t="1713377220319" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4260" data-darkreader-inline-fill="" width="200" height="200"><path d="M977.2 208.2c33.4 36.2 48.8 79.4 46.6 131.4v404.8c-0.8 52.8-18.4 96.2-53 130.2-34.4 34-78.2 51.8-131 53.4H184.04c-52.9-1.6-96.42-19.6-130.56-54.4C19.364 838.8 1.534 793 0 736.4V339.6c1.534-52 19.364-95.2 53.48-131.4C87.62 175.5 131.14 157.54 184.04 156h58.76L192.1 104.38c-11.5-11.46-17.26-26-17.26-43.58 0-17.6 5.76-32.12 17.26-43.594C203.6 5.736 218.2 0 235.8 0s32.2 5.736 43.8 17.206L426.2 156h176l149-138.794C763.4 5.736 778.4 0 796 0c17.6 0 32.2 5.736 43.8 17.206 11.4 11.474 17.2 25.994 17.2 43.594 0 17.58-5.8 32.12-17.2 43.58L789.2 156h58.6c52.8 1.54 96 19.5 129.4 52.2z m-77.6 139.4c-0.8-19.2-7.4-34.8-21.4-47-10.4-12.2-28-18.8-45.4-19.6H192.1c-19.18 0.8-34.9 7.4-47.16 19.6-12.28 12.2-18.8 27.8-19.56 47v388.8c0 18.4 6.52 34 19.56 47s28.76 19.6 47.16 19.6H832.8c18.4 0 34-6.6 46.6-19.6 12.6-13 19.4-28.6 20.2-47V347.6z m-528.6 85.4c12.6 12.6 19.4 28.2 20.2 46.4V546c-0.8 18.4-7.4 33.8-19.6 46.4-12.4 12.6-28 19-47.2 19-19.2 0-35-6.4-47.2-19-12.2-12.6-18.8-28-19.6-46.4v-66.6c0.8-18.2 7.6-33.8 20.2-46.4 12.6-12.6 26.4-19.2 46.6-20 18.4 0.8 34 7.4 46.6 20z m383 0c12.6 12.6 19.4 28.2 20.2 46.4V546c-0.8 18.4-7.4 33.8-19.6 46.4-12.2 12.6-28 19-47.2 19-19.2 0-34.8-6.4-47.2-19-14-12.6-18.8-28-19.4-46.4v-66.6c0.6-18.2 7.4-33.8 20-46.4 12.6-12.6 28.2-19.2 46.6-20 18.4 0.8 34 7.4 46.6 20z" p-id="4261"></path></svg></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-ccf7ddec data-v-d0bd9dde data-v-b6c34ac9><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-b6c34ac9><span class="vpi-more-horizontal icon" data-v-b6c34ac9></span></button><div class="menu" data-v-b6c34ac9><div class="VPMenu" data-v-b6c34ac9 data-v-e7ea1737><!----><!--[--><!--[--><!----><div class="group" data-v-d0bd9dde><div class="item appearance" data-v-d0bd9dde><p class="label" data-v-d0bd9dde>Appearance</p><div class="appearance-action" data-v-d0bd9dde><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-d0bd9dde data-v-d1f28634 data-v-1d5665e3><span class="check" data-v-1d5665e3><span class="icon" data-v-1d5665e3><!--[--><span class="vpi-sun sun" data-v-d1f28634></span><span class="vpi-moon moon" data-v-d1f28634></span><!--]--></span></span></button></div></div></div><div class="group" data-v-d0bd9dde><div class="item social-links" data-v-d0bd9dde><div class="VPSocialLinks social-links-list" data-v-d0bd9dde data-v-7bc22406><!--[--><a class="VPSocialLink no-icon" href="https://github.com/etsuyou" aria-label="github" target="_blank" rel="noopener" data-v-7bc22406 data-v-eee4e7cb><span class="vpi-social-github" /></a><a class="VPSocialLink no-icon" href="https://gitee.com/etsuyou" aria-label target="_blank" rel="noopener" data-v-7bc22406 data-v-eee4e7cb>
            <svg t="1713377554330" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="12062" data-darkreader-inline-fill="" width="200" height="200"><path d="M511.317333 0A512 512 0 0 0 0 512a512 512 0 0 0 512 512 512 512 0 0 0 512-512A512 512 0 0 0 512 0a512 512 0 0 0-0.682667 0z m259.84 227.541333c13.994667 0 25.301333 11.349333 25.258667 25.301334v63.232a25.344 25.344 0 0 1-25.301333 25.258666H417.152c-41.898667 0-75.861333 33.962667-75.861333 75.861334v240.213333c0 13.952 11.349333 25.258667 25.301333 25.258667h240.213333c41.898667 0 75.861333-33.962667 75.861334-75.861334v-12.629333a25.301333 25.301333 0 0 0-25.258667-25.301333h-177.066667a25.258667 25.258667 0 0 1-25.258666-25.258667v-63.232a25.301333 25.301333 0 0 1 25.301333-25.258667h290.773333c13.952 0 25.301333 11.306667 25.301334 25.258667v145.408a170.666667 170.666667 0 0 1-170.666667 170.666667H252.842667a25.301333 25.301333 0 0 1-25.301334-25.301334V417.194667a189.610667 189.610667 0 0 1 189.653334-189.610667h353.962666z" p-id="12063"></path></svg></a><a class="VPSocialLink no-icon" href="https://space.bilibili.com/13716124" aria-label target="_blank" rel="noopener" data-v-7bc22406 data-v-eee4e7cb>
            <svg t="1713377220319" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="4260" data-darkreader-inline-fill="" width="200" height="200"><path d="M977.2 208.2c33.4 36.2 48.8 79.4 46.6 131.4v404.8c-0.8 52.8-18.4 96.2-53 130.2-34.4 34-78.2 51.8-131 53.4H184.04c-52.9-1.6-96.42-19.6-130.56-54.4C19.364 838.8 1.534 793 0 736.4V339.6c1.534-52 19.364-95.2 53.48-131.4C87.62 175.5 131.14 157.54 184.04 156h58.76L192.1 104.38c-11.5-11.46-17.26-26-17.26-43.58 0-17.6 5.76-32.12 17.26-43.594C203.6 5.736 218.2 0 235.8 0s32.2 5.736 43.8 17.206L426.2 156h176l149-138.794C763.4 5.736 778.4 0 796 0c17.6 0 32.2 5.736 43.8 17.206 11.4 11.474 17.2 25.994 17.2 43.594 0 17.58-5.8 32.12-17.2 43.58L789.2 156h58.6c52.8 1.54 96 19.5 129.4 52.2z m-77.6 139.4c-0.8-19.2-7.4-34.8-21.4-47-10.4-12.2-28-18.8-45.4-19.6H192.1c-19.18 0.8-34.9 7.4-47.16 19.6-12.28 12.2-18.8 27.8-19.56 47v388.8c0 18.4 6.52 34 19.56 47s28.76 19.6 47.16 19.6H832.8c18.4 0 34-6.6 46.6-19.6 12.6-13 19.4-28.6 20.2-47V347.6z m-528.6 85.4c12.6 12.6 19.4 28.2 20.2 46.4V546c-0.8 18.4-7.4 33.8-19.6 46.4-12.4 12.6-28 19-47.2 19-19.2 0-35-6.4-47.2-19-12.2-12.6-18.8-28-19.6-46.4v-66.6c0.8-18.2 7.6-33.8 20.2-46.4 12.6-12.6 26.4-19.2 46.6-20 18.4 0.8 34 7.4 46.6 20z m383 0c12.6 12.6 19.4 28.2 20.2 46.4V546c-0.8 18.4-7.4 33.8-19.6 46.4-12.2 12.6-28 19-47.2 19-19.2 0-34.8-6.4-47.2-19-14-12.6-18.8-28-19.4-46.4v-66.6c0.6-18.2 7.4-33.8 20-46.4 12.6-12.6 28.2-19.2 46.6-20 18.4 0.8 34 7.4 46.6 20z" p-id="4261"></path></svg></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-ccf7ddec data-v-e5dd9c1c><span class="container" data-v-e5dd9c1c><span class="top" data-v-e5dd9c1c></span><span class="middle" data-v-e5dd9c1c></span><span class="bottom" data-v-e5dd9c1c></span></span></button></div></div></div></div><div class="divider" data-v-ccf7ddec><div class="divider-line" data-v-ccf7ddec></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-5d98c3a5 data-v-a6f0e41e><div class="container" data-v-a6f0e41e><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-a6f0e41e><span class="vpi-align-left menu-icon" data-v-a6f0e41e></span><span class="menu-text" data-v-a6f0e41e>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-a6f0e41e data-v-17a5e62e><button data-v-17a5e62e>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-5d98c3a5 data-v-575e6a36><div class="curtain" data-v-575e6a36></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-575e6a36><span class="visually-hidden" id="sidebar-aria-label" data-v-575e6a36> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-575e6a36><section class="VPSidebarItem level-0 has-active" data-v-575e6a36 data-v-b8d55f3b><div class="item" role="button" tabindex="0" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><h2 class="text" data-v-b8d55f3b>Nginx教程</h2><!----></div><div class="items" data-v-b8d55f3b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/nginx/00-nginx-introduction.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>00-nginx-introduction</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/nginx/01-nginx-quickstart.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>01-nginx-quickstart</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/nginx/02-nginx-ops.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>02-nginx-ops</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/nginx/03-nginx-configuration.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>03-nginx-configuration</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-b8d55f3b data-v-b8d55f3b><div class="item" data-v-b8d55f3b><div class="indicator" data-v-b8d55f3b></div><a class="VPLink link link" href="/nginx/04-nginx-faq.html" data-v-b8d55f3b><!--[--><p class="text" data-v-b8d55f3b>04-nginx-faq</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-5d98c3a5 data-v-1428d186><div class="VPDoc has-sidebar has-aside" data-v-1428d186 data-v-39a288b8><!--[--><!--]--><div class="container" data-v-39a288b8><div class="aside" data-v-39a288b8><div class="aside-curtain" data-v-39a288b8></div><div class="aside-container" data-v-39a288b8><div class="aside-content" data-v-39a288b8><div class="VPDocAside" data-v-39a288b8 data-v-3f215769><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-3f215769 data-v-a5bbad30><div class="content" data-v-a5bbad30><div class="outline-marker" data-v-a5bbad30></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-a5bbad30>文章目录</div><ul class="VPDocOutlineItem root" data-v-a5bbad30 data-v-b933a997><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-3f215769></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-39a288b8><div class="content-container" data-v-39a288b8><!--[--><!--]--><main class="main" data-v-39a288b8><div style="position:relative;" class="vp-doc _nginx_03-nginx-configuration" data-v-39a288b8><div><h1 id="nginx-配置" tabindex="-1">Nginx 配置 <a class="header-anchor" href="#nginx-配置" aria-label="Permalink to &quot;Nginx 配置&quot;">​</a></h1><blockquote><p>Nginx 的默认配置文件为 <code>nginx.conf</code>。</p><ul><li><code>nginx -c xxx.conf</code> - 以指定的文件作为配置文件，启动 Nginx。</li></ul></blockquote><h2 id="配置文件实例" tabindex="-1">配置文件实例 <a class="header-anchor" href="#配置文件实例" aria-label="Permalink to &quot;配置文件实例&quot;">​</a></h2><p>以下为一个 <code>nginx.conf</code> 配置文件实例：</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#定义 nginx 运行的用户和用户组</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">user </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">www www;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#nginx 进程数，建议设置为等于 CPU 总核心数。</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">worker_processes </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#nginx 默认没有开启利用多核 CPU, 通过增加 worker_cpu_affinity 配置参数来充分利用多核 CPU 以下是 8 核的配置参数</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">worker_cpu_affinity </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">00000001</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 00000010</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 00000100</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 00001000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 00010000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 00100000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 01000000</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10000000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#全局错误日志定义类型，[ debug | info | notice | warn | error | crit ]</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error_log </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/var/log/nginx/error.log info;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#进程文件</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">pid </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/var/run/nginx.pid;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#一个 nginx 进程打开的最多文件描述符数目，理论值应该是最多打开文件数（系统的值 ulimit -n）与 nginx 进程数相除，但是 nginx 分配请求并不均匀，所以建议与 ulimit -n 的值保持一致。</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">worker_rlimit_nofile </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">65535</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#工作模式与连接数上限</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">events</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #参考事件模型，use [ kqueue | rtsig | epoll | /dev/poll | select | poll ]; epoll 模型是 Linux 2.6 以上版本内核中的高性能网络 I/O 模型，如果跑在 FreeBSD 上面，就用 kqueue 模型。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #epoll 是多路复用 IO(I/O Multiplexing) 中的一种方式，但是仅用于 linux2.6 以上内核，可以大大提高 nginx 的性能</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    use </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">epoll</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ############################################################################</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #单个后台 worker process 进程的最大并发链接数</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #事件模块指令，定义 nginx 每个进程最大连接数，默认 1024。最大客户连接数由 worker_processes 和 worker_connections 决定</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #即 max_client=worker_processes*worker_connections, 在作为反向代理时：max_client=worker_processes*worker_connections / 4</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    worker_connections </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">65535</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ############################################################################</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#设定 http 服务器</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    include </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">mime.types; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#文件扩展名与文件类型映射表</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    default_type </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">application/octet-stream; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#默认文件类型</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #charset utf-8; #默认编码</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server_names_hash_bucket_size </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">128</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#服务器名字的 hash 表大小</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    client_header_buffer_size </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">32k</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#上传文件大小限制</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    large_client_header_buffers </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 64k</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#设定请求缓</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    client_max_body_size </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8m</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#设定请求缓</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    sendfile </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#开启高效文件传输模式，sendfile 指令指定 nginx 是否调用 sendfile 函数来输出文件，对于普通应用设为 on，如果用来进行下载等应用磁盘 IO 重负载应用，可设置为 off，以平衡磁盘与网络 I/O 处理速度，降低系统的负载。注意：如果图片显示不正常把这个改成 off。</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    autoindex </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#开启目录列表访问，合适下载服务器，默认关闭。</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    tcp_nopush </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#防止网络阻塞</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    tcp_nodelay </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#防止网络阻塞</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ##连接客户端超时时间各种参数设置##</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    keepalive_timeout </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 120</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#单位是秒，客户端连接时时间，超时之后服务器端自动关闭该连接 如果 nginx 守护进程在这个等待的时间里，一直没有收到浏览发过来 http 请求，则关闭这个 http 连接</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    client_header_timeout </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;        </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#客户端请求头的超时时间</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    client_body_timeout </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#客户端请求主体超时时间</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    reset_timedout_connection </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#告诉 nginx 关闭不响应的客户端连接。这将会释放那个客户端所占有的内存空间</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    send_timeout </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;                 </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#客户端响应超时时间，在两次客户端读取操作之间。如果在这段时间内，客户端没有读取任何数据，nginx 就会关闭连接</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ################################</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #FastCGI 相关参数是为了改善网站的性能：减少资源占用，提高访问速度。下面参数看字面意思都能理解。</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    fastcgi_connect_timeout </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">300</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    fastcgi_send_timeout </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">300</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    fastcgi_read_timeout </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">300</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    fastcgi_buffer_size </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">64k</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    fastcgi_buffers </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 64k</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    fastcgi_busy_buffers_size </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">128k</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    fastcgi_temp_file_write_size </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">128k</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ###作为代理缓存服务器设置#######</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ###先写到 temp 再移动到 cache</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #proxy_cache_path /var/tmp/nginx/proxy_cache levels=1:2 keys_zone=cache_one:512m inactive=10m max_size=64m;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ###以上 proxy_temp 和 proxy_cache 需要在同一个分区中</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ###levels=1:2 表示缓存级别，表示缓存目录的第一级目录是 1 个字符，第二级目录是 2 个字符 keys_zone=cache_one:128m 缓存空间起名为 cache_one 大小为 512m</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ###max_size=64m 表示单个文件超过 128m 就不缓存了  inactive=10m 表示缓存的数据，10 分钟内没有被访问过就删除</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #########end####################</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #####对传输文件压缩###########</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #gzip 模块设置</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    gzip </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#开启 gzip 压缩输出</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    gzip_min_length </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1k</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#最小压缩文件大小</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    gzip_buffers </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 16k</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#压缩缓冲区</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    gzip_http_version </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#压缩版本（默认 1.1，前端如果是 squid2.5 请使用 1.0）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    gzip_comp_level </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#压缩等级，gzip 压缩比，1 为最小，处理最快；9 为压缩比最大，处理最慢，传输速度最快，也最消耗 CPU；</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    gzip_types </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">text/plain application/x-javascript text/css application/xml;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #压缩类型，默认就已经包含 text/html，所以下面就不用再写了，写上去也不会有问题，但是会有一个 warn。</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    gzip_vary </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ##############################</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #limit_zone crawler $binary_remote_addr 10m; #开启限制 IP 连接数的时候需要使用</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> blog.ha97.com </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #upstream 的负载均衡，weight 是权重，可以根据机器配置定义权重。weigth 参数表示权值，权值越高被分配到的几率越大。</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 192.168.80.121:80 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">weight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        server 192.168.80.122:80 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">weight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        server 192.168.80.123:80 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">weight</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    #虚拟主机的配置</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    server {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #监听端口</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #############https##################</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #listen 443 ssl;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #ssl_certificate /opt/https/xxxxxx.crt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #ssl_certificate_key /opt/https/xxxxxx.key;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #ssl_protocols SSLv3 TLSv1;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #ssl_ciphers HIGH:!ADH:!EXPORT57:RC4+RSA:+MEDIUM;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #ssl_prefer_server_ciphers on;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #ssl_session_cache shared:SSL:2m;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #ssl_session_timeout 5m;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        ####################################end</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #域名可以有多个，用空格隔开</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">www.ha97.com ha97.com;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        index </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index.html index.htm index.php;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        root </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/data/www/ha97;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> .*.(php|php5)?$ </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            fastcgi_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">127.0.0.1:9000;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            fastcgi_index </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index.php;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            include </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">fastcgi.conf;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #图片缓存时间设置</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> .*.(gif|jpg|jpeg|png|bmp|swf)$ </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            expires </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #JS 和 CSS 缓存时间设置</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> .*.(js|css)?$ </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            expires </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1h</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #日志格式设定</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        log_format </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">access </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">remote_addr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> - $</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">remote_user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> [$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">time_local</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">] &quot;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; &#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> $</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">body_bytes_sent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http_referer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; &#39;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;&quot;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http_user_agent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; $</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http_x_forwarded_for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #定义本虚拟主机的访问日志</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        access_log </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/var/log/nginx/ha97access.log access;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #对 &quot;/&quot; 启用反向代理</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://127.0.0.1:88;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_redirect </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">off</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X-Real-IP $remote_addr;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            #后端的 Web 服务器可以通过 X-Forwarded-For 获取用户真实 IP</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X-Forwarded-For $proxy_add_x_forwarded_for;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            #以下是一些反向代理的配置，可选。</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Host $host;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            client_max_body_size </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10m</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#允许客户端请求的最大单文件字节数</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            client_body_buffer_size </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">128k</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#缓冲区代理缓冲用户端请求的最大字节数，</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            ##代理设置 以下设置是 nginx 和后端服务器之间通讯的设置##</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_connect_timeout </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">90</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#nginx 跟后端服务器连接超时时间（代理连接超时）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_send_timeout </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">90</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#后端服务器数据回传时间（代理发送超时）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_read_timeout </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">90</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#连接成功后，后端服务器响应时间（代理接收超时）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_buffering </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#该指令开启从后端被代理服务器的响应内容缓冲 此参数开启后 proxy_buffers 和 proxy_busy_buffers_size 参数才会起作用</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_buffer_size </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4k</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#设置代理服务器（nginx）保存用户头信息的缓冲区大小</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_buffers </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 32k</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#proxy_buffers 缓冲区，网页平均在 32k 以下的设置</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_busy_buffers_size </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">64k</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#高负荷下缓冲大小（proxy_buffers*2）</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_max_temp_file_size </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2048m</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#默认 1024m, 该指令用于设置当网页内容大于 proxy_buffers 时，临时文件大小的最大值。如果文件大于这个值，它将从 upstream 服务器同步地传递请求，而不是缓冲到磁盘</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_temp_file_write_size </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">512k</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; 这是当被代理服务器的响应过大时 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">nginx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> 一次性写入临时文件的数据量。</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_temp_path </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> /var/tmp/nginx/proxy_temp;    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">##定义缓冲存储目录，之前必须要先手动创建此目录</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_headers_hash_max_size </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">51200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_headers_hash_bucket_size </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6400</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            #######################################################</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #设定查看 nginx 状态的地址</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /nginxStatus </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            stub_status</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> on;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            access_log </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            auth_basic </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;nginxStatus&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            auth_basic_user_file </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">conf/htpasswd;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            #htpasswd 文件的内容可以用 apache 提供的 htpasswd 工具来产生。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #本地动静分离反向代理配置</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #所有 jsp 的页面均交由 tomcat 或 resin 处理</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> .(jsp|jspx|do)?$ </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Host $host;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X-Real-IP $remote_addr;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X-Forwarded-For $proxy_add_x_forwarded_for;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://127.0.0.1:8080;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        #所有静态文件由 nginx 直接读取不经过 tomcat 或 resin</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> .*.(htm|html|gif|jpg|jpeg|png|bmp|swf|ioc|rar|zip|txt|flv|mid|doc|ppt|pdf|xls|mp3|wma)$</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        {</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> expires </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">15d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> .*.(js|css)?$</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        {</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> expires </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1h</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="基本规则" tabindex="-1">基本规则 <a class="header-anchor" href="#基本规则" aria-label="Permalink to &quot;基本规则&quot;">​</a></h2><h3 id="管理-nginx-配置" tabindex="-1">管理 Nginx 配置 <a class="header-anchor" href="#管理-nginx-配置" aria-label="Permalink to &quot;管理 Nginx 配置&quot;">​</a></h3><blockquote><p>随着 Nginx 配置的增长，您有必要组织、管理配置内容。</p><p>当您的 Nginx 配置增加时，组织配置的需求也会增加。 井井有条的代码是：</p><ul><li>易于理解</li><li>易于维护</li><li>易于使用</li></ul></blockquote><blockquote><p>使用 <code>include</code> 指令可将常用服务器配置移动到单独的文件中，并将特定代码附加到全局配置，上下文等中。</p></blockquote><blockquote><p>我总是尝试在配置树的根目录中保留多个目录。 这些目录存储所有附加到主文件的配置文件。 我更喜欢以下结构：</p><ul><li><code>html</code> - 用于默认静态文件，例如 全局 5xx 错误页面</li><li><code>master</code> - 用于主要配置，例如 ACL，侦听指令和域 <ul><li><code>_acls</code> - 用于访问控制列表，例如 地理或地图模块</li><li><code>_basic</code> - 用于速率限制规则，重定向映射或代理参数</li><li><code>_listen</code> - 用于所有侦听指令； 还存储 SSL 配置</li><li><code>_server</code> - 用于域（localhost）配置； 还存储所有后端定义</li></ul></li><li><code>modules</code> - 用于动态加载到 Nginx 中的模块</li><li><code>snippets</code> - 用于 Nginx 别名，配置模板</li></ul><p>如果有必要，我会将其中一些附加到具有 <code>server</code> 指令的文件中。</p></blockquote><p>示例：</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Store this configuration in https.conf for example:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">listen </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">10.240.20.2:443 ssl;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_certificate </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/etc/nginx/master/_server/example.com/certs/nginx_example.com_bundle.crt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_certificate_key </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/etc/nginx/master/_server/example.com/certs/example.com.key;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Include this file to the server section:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  include </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/etc/nginx/master/_listen/10.240.20.2/https.conf;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ## And other:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  include </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/etc/nginx/master/_static/errors.conf;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  include </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/etc/nginx/master/_server/_helpers/global.conf;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">domain.com www.domain.com;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span></code></pre></div><h3 id="重加载-nginx-配置" tabindex="-1">重加载 Nginx 配置 <a class="header-anchor" href="#重加载-nginx-配置" aria-label="Permalink to &quot;重加载 Nginx 配置&quot;">​</a></h3><p>示例：</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## 1)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reload</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## 2)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reload</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## 3)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/etc/init.d/nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reload</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## 4)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/usr/sbin/nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reload</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## 5)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">kill</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -HUP</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/run/nginx.pid</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## or</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">kill</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -HUP</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">pgrep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;nginx: master&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## 6)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">/usr/sbin/nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -g</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;daemon on; master_process on;&#39;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reload</span></span></code></pre></div><h3 id="监听-80-和-443-端口" tabindex="-1">监听 80 和 443 端口 <a class="header-anchor" href="#监听-80-和-443-端口" aria-label="Permalink to &quot;监听 80 和 443 端口&quot;">​</a></h3><blockquote><p>如果您使用完全相同的配置为 HTTP 和 HTTPS 提供服务（单个服务器同时处理 HTTP 和 HTTPS 请求），Nginx 足够智能，可以忽略通过端口 80 加载的 SSL 指令。</p><p>Nginx 的最佳实践是使用单独的服务器进行这样的重定向（不与您的主要配置的服务器共享），对所有内容进行硬编码，并且完全不使用正则表达式。</p><p>我不喜欢复制规则，但是单独的监听指令无疑可以帮助您维护和修改配置。</p><p>如果将多个域固定到一个 IP 地址，则很有用。 这使您可以将一个侦听指令（例如，如果将其保留在配置文件中）附加到多个域配置。</p><p>如果您使用的是 HTTPS，则可能还需要对域进行硬编码，因为您必须预先知道要提供的证书。</p></blockquote><p>示例：</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## For HTTP:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  listen </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">10.240.20.2:80;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## For HTTPS:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  listen </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">10.240.20.2:443 ssl;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="显示指定监听的地址和端口" tabindex="-1">显示指定监听的地址和端口 <a class="header-anchor" href="#显示指定监听的地址和端口" aria-label="Permalink to &quot;显示指定监听的地址和端口&quot;">​</a></h3><p>Nginx 的 listen 指令用于监听指定的 IP 地址和端口号，配置形式为：<code>listen &lt;address&gt;:&lt;port&gt;</code>。若 IP 地址或端口缺失，Nginx 会以默认值来替换。</p><p>而且，仅当需要区分与 listen 指令中的同一级别匹配的服务器块时，才会评估 server_name 指令。</p><p>示例：</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ## This block will be processed:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">192.168.252.10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## --&gt; 192.168.252.10:80</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">80</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## --&gt; *:80 --&gt; 0.0.0.0:80</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">api.random.com;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="防止使用未定义的服务器名称处理请求" tabindex="-1">防止使用未定义的服务器名称处理请求 <a class="header-anchor" href="#防止使用未定义的服务器名称处理请求" aria-label="Permalink to &quot;防止使用未定义的服务器名称处理请求&quot;">​</a></h3><blockquote><p>Nginx 应该阻止使用未定义的服务器名称（也使用 IP 地址）处理请求。它可以防止配置错误，例如流量转发到不正确的后端。通过创建默认虚拟虚拟主机可以轻松解决该问题，该虚拟虚拟主机可以捕获带有无法识别的主机标头的所有请求。</p><p>如果没有一个 listen 指令具有 default_server 参数，则具有 address：port 对的第一台服务器将是该对的默认服务器（这意味着 Nginx 始终具有默认服务器）。</p><p>如果有人使用 IP 地址而不是服务器名称发出请求，则主机请求标头字段将包含 IP 地址，并且可以使用 IP 地址作为服务器名称来处理请求。</p><p>在现代版本的 Nginx 中，不需要服务器名称_。如果找不到具有匹配的 listen 和 server_name 的服务器，Nginx 将使用默认服务器。如果您的配置分散在多个文件中，则评估顺序将不明确，因此您需要显式标记默认服务器。</p><p>Nginx 使用 Host 标头进行 server_name 匹配。它不使用 TLS SNI。这意味着对于 SSL 服务器，Nginx 必须能够接受 SSL 连接，这归结为具有证书/密钥。证书/密钥可以是任意值，例如自签名。</p></blockquote><p>示例：</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Place it at the beginning of the configuration file to prevent mistakes:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ## For ssl option remember about SSL parameters (private key, certs, cipher suites, etc.);</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ## add default_server to your listen directive in the server that you want to act as the default:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  listen </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">10.240.20.2:443 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">default_server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ssl;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ## We catch:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ##   - invalid domain names</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ##   - requests without the &quot;Host&quot; header</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ##   - and all others (also due to the above setting)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ##   - default_server in server_name directive is not required - I add this for a better understanding and I think it&#39;s an unwritten standard</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ## ...but you should know that it&#39;s irrelevant, really, you can put in everything there.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">_ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> default_server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 444</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ## We can also serve:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ## location / {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ## static file (error page):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ##   root /etc/nginx/error-pages/404;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ## or redirect:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ##   return 301 https://badssl.com;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ## return 444;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ## }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  listen </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">10.240.20.2:443 ssl;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">domain.com;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  listen </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">10.240.20.2:443 ssl;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">domain.org;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="不要在-listen-或-upstream-中使用-hostname" tabindex="-1">不要在 listen 或 upstream 中使用 hostname <a class="header-anchor" href="#不要在-listen-或-upstream-中使用-hostname" aria-label="Permalink to &quot;不要在 listen 或 upstream 中使用 hostname&quot;">​</a></h3><blockquote><p>通常，在 listen 或上游指令中使用主机名是一种不好的做法。</p><p>在最坏的情况下，Nginx 将无法绑定到所需的 TCP 套接字，这将完全阻止 Nginx 启动。</p><p>最好和更安全的方法是知道需要绑定的 IP 地址，并使用该地址代替主机名。 这也可以防止 Nginx 查找地址并消除对外部和内部解析器的依赖。</p><p>在 server_name 指令中使用$ hostname（计算机的主机名）变量也是不当行为的示例（类似于使用主机名标签）。</p><p>我认为也有必要设置 IP 地址和端口号对，以防止可能难以调试的软错误。</p></blockquote><p>示例：</p><p>❌ 错误配置</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http://x-9s-web01-prod:8080;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  listen </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">rev-proxy-prod:80;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>⭕ 正确配置</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http://192.168.252.200:8080;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  listen </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">10.10.100.20:80;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="指令中只配置一个-ssl" tabindex="-1">指令中只配置一个 SSL <a class="header-anchor" href="#指令中只配置一个-ssl" aria-label="Permalink to &quot;指令中只配置一个 SSL&quot;">​</a></h3><blockquote><p>此规则使调试和维护更加容易。</p><p>请记住，无论 SSL 参数如何，您都可以在同一监听指令（IP 地址）上使用多个 SSL 证书。</p><p>我认为要在多个 HTTPS 服务器之间共享一个 IP 地址，您应该使用一个 SSL 配置（例如协议，密码，曲线）。这是为了防止错误和配置不匹配。</p><p>还请记住有关默认服务器的配置。这很重要，因为如果所有 listen 指令都没有 default_server 参数，则配置中的第一台服务器将是默认服务器。因此，您应该只使用一个 SSL 设置，并且在同一 IP 地址上使用多个名称。</p><p>从 Nginx 文档中：</p><p>这是由 SSL 协议行为引起的。在浏览器发送 HTTP 请求之前，已建立 SSL 连接，nginx 不知道所请求服务器的名称。因此，它可能仅提供默认服务器的证书。</p><p>还要看看这个：</p><p>TLS 服务器名称指示扩展名（SNI，RFC 6066）是在单个 IP 地址上运行多个 HTTPS 服务器的更通用的解决方案，它允许浏览器在 SSL 握手期间传递请求的服务器名称，因此，服务器将知道哪个用于连接的证书。</p><p>另一个好主意是将常用服务器设置移到单独的文件（即 common / example.com.conf）中，然后将其包含在单独的服务器块中。</p></blockquote><p>示例：</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Store this configuration in e.g. https.conf:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">listen </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">192.168.252.10:443 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">default_server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ssl http2;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_protocols </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TLSv1.2;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_ciphers </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_prefer_server_ciphers </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_ecdh_curve </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">secp521r1:secp384r1;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Include this file to the server context (attach domain-a.com for specific listen directive):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  include </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            /etc/nginx/https.conf;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        domain-a.com;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ssl_certificate </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    domain-a.com.crt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ssl_certificate_key </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">domain-a.com.key;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Include this file to the server context (attach domain-b.com for specific listen directive):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  include </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            /etc/nginx/https.conf;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        domain-b.com;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ssl_certificate </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    domain-b.com.crt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ssl_certificate_key </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">domain-b.com.key;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="使用-geo-map-模块替代-allow-deny" tabindex="-1">使用 geo/map 模块替代 allow/deny <a class="header-anchor" href="#使用-geo-map-模块替代-allow-deny" aria-label="Permalink to &quot;使用 geo/map 模块替代 allow/deny&quot;">​</a></h3><blockquote><p>使用地图或地理模块（其中之一）可以防止用户滥用您的服务器。这样就可以创建变量，其值取决于客户端 IP 地址。</p><p>由于仅在使用变量时才对其进行求值，因此甚至仅存在大量已声明的变量。地理位置变量不会为请求处理带来任何额外费用。</p><p>这些指令提供了阻止无效访问者的完美方法，例如使用 ngx_http_geoip_module。例如，geo 模块非常适合有条件地允许或拒绝 IP。</p><p>geo 模块（注意：不要将此模块误认为是 GeoIP）在加载配置时会构建内存基数树。这与路由中使用的数据结构相同，并且查找速度非常快。如果每个网络有许多唯一值，那么较长的加载时间是由在数组中搜索数据重复项引起的。否则，可能是由于插入基数树引起的。</p><p>我将两个模块都用于大型列表。您应该考虑一下，因为此规则要求使用多个 if 条件。我认为，对于简单的列表，毕竟允许/拒绝指令是更好的解决方案。看下面的例子：</p></blockquote><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Allow/deny:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /internal </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  include </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">acls/internal.conf;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  allow </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  192.168.240.0/24;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  deny </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   all</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## vs geo/map:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /internal </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ($globals_internal_map_acl) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    set </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$pass </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ($pass </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">= </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">1) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://localhost:80;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ($pass </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!= </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">1) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 403</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>示例：</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Map module:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">remote_addr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $globals_internal_map_acl {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ## Status code:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ##  - 0 = false</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ##  - 1 = true</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  default</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ### INTERNAL ###</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  10.255.10.0/24 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  10.255.20.0/24 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  10.255.30.0/24 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  192.168.0.0/16 </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Geo module:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">geo </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$globals_internal_geo_acl {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ## Status code:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ##  - 0 = false</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ##  - 1 = true</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  default</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ### INTERNAL ###</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  10.255.10.0/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">24</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  10.255.20.0/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">24</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  10.255.30.0/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">24</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  192.168.0.0/</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">16</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="map-所有事物" tabindex="-1">Map 所有事物 <a class="header-anchor" href="#map-所有事物" aria-label="Permalink to &quot;Map 所有事物&quot;">​</a></h3><blockquote><p>使用地图管理大量重定向，并使用它们来自定义键/值对。</p><p>map 指令可映射字符串，因此可以表示例如 192.168.144.0/24 作为正则表达式，并继续使用 map 指令。</p><p>Map 模块提供了一种更优雅的解决方案，用于清晰地解析大量正则表达式，例如 用户代理，引荐来源。</p><p>您还可以对地图使用 include 指令，这样配置文件看起来会很漂亮。</p></blockquote><p>示例：</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">map</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">http_user_agent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $device_redirect {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  default</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;desktop&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(?i)ip(hone|od) </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mobile&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(?i)android.*(mobile|mini) </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mobile&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Mobile.+Firefox </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mobile&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">^HTC </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mobile&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Fennec </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mobile&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">IEMobile </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mobile&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">BB10 </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mobile&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">SymbianOS.*AppleWebKit </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mobile&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ~</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Opera</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">\sMobi </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mobile&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Turn on in a specific context (e.g. location):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ($device_redirect </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">= </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mobile&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 301</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> https://m.domain.com$request_uri;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="为所有未匹配的路径设置根路径" tabindex="-1">为所有未匹配的路径设置根路径 <a class="header-anchor" href="#为所有未匹配的路径设置根路径" aria-label="Permalink to &quot;为所有未匹配的路径设置根路径&quot;">​</a></h3><blockquote><p>为请求设置服务器指令内部的全局根路径。 它为未定义的位置指定根路径。</p><p>根据官方文档：</p><p>如果您在每个位置块中添加一个根路径，则不匹配的位置块将没有根路径。因此，重要的是，根指令必须在您的位置块之前发生，然后根目录指令可以在需要时覆盖该指令。</p></blockquote><p>示例：</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">domain.com;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  root </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/var/www/domain.com/public;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /api </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /static </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    root </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/var/www/domain.com/static;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="使用-return-指令进行-url-重定向-301、302" tabindex="-1">使用 return 指令进行 URL 重定向（301、302） <a class="header-anchor" href="#使用-return-指令进行-url-重定向-301、302" aria-label="Permalink to &quot;使用 return 指令进行 URL 重定向（301、302）&quot;">​</a></h3><blockquote><p>这是一个简单的规则。 您应该使用服务器块和 return 语句，因为它们比评估 RegEx 更快。</p><p>因为 Nginx 停止处理请求（而不必处理正则表达式），所以它更加简单快捷。</p></blockquote><p>示例</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">www.example.com;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ## return    301 https://$host$request_uri;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      301</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $scheme://www.example.com$request_uri;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="配置日志轮换策略" tabindex="-1">配置日志轮换策略 <a class="header-anchor" href="#配置日志轮换策略" aria-label="Permalink to &quot;配置日志轮换策略&quot;">​</a></h3><blockquote><p>日志文件为您提供有关服务器活动和性能以及可能出现的任何问题的反馈。 它们记录了有关请求和 Nginx 内部的详细信息。 不幸的是，日志使用了更多的磁盘空间。</p><p>您应该定义一个过程，该过程将定期存档当前日志文件并启动一个新日志文件，重命名并有选择地压缩当前日志文件，删除旧日志文件，并强制日志记录系统开始使用新日志文件。</p><p>我认为最好的工具是 logrotate。 如果我想自动管理日志，也想睡个好觉，那么我会在任何地方使用它。 这是一个旋转日志的简单程序，使用 crontab 可以工作。 它是计划的工作，而不是守护程序，因此无需重新加载其配置。</p></blockquote><p>示例：</p><ul><li><p>手动旋转</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Check manually (all log files):</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">logrotate</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -dv</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/logrotate.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Check manually with force rotation (specific log file):</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">logrotate</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -dv</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --force</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/logrotate.d/nginx</span></span></code></pre></div></li><li><p>自动旋转</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/logrotate.d/nginx</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> __EOF__</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/var/log/nginx/*.log {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  daily</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  missingok</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  rotate 14</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  compress</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  delaycompress</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  notifempty</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  create 0640 nginx nginx</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  sharedscripts</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  prerotate</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    if [ -d /etc/logrotate.d/httpd-prerotate ]; then </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      run-parts /etc/logrotate.d/httpd-prerotate; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    fi </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  endscript</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  postrotate</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    ## test ! -f /var/run/nginx.pid || kill -USR1 `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/run/nginx.pid`</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    invoke-rc.d nginx reload &gt;/dev/null 2&gt;&amp;1</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  endscript</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/var/log/nginx/localhost/*.log {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  daily</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  missingok</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  rotate 14</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  compress</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  delaycompress</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  notifempty</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  create 0640 nginx nginx</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  sharedscripts</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  prerotate</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    if [ -d /etc/logrotate.d/httpd-prerotate ]; then </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      run-parts /etc/logrotate.d/httpd-prerotate; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    fi </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  endscript</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  postrotate</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    ## test ! -f /var/run/nginx.pid || kill -USR1 `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/run/nginx.pid`</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    invoke-rc.d nginx reload &gt;/dev/null 2&gt;&amp;1</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  endscript</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/var/log/nginx/domains/example.com/*.log {</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  daily</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  missingok</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  rotate 14</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  compress</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  delaycompress</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  notifempty</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  create 0640 nginx nginx</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  sharedscripts</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  prerotate</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    if [ -d /etc/logrotate.d/httpd-prerotate ]; then </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      run-parts /etc/logrotate.d/httpd-prerotate; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    fi </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  endscript</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  postrotate</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    ## test ! -f /var/run/nginx.pid || kill -USR1 `</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/run/nginx.pid`</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    invoke-rc.d nginx reload &gt;/dev/null 2&gt;&amp;1</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  endscript</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">__EOF__</span></span></code></pre></div></li></ul><h3 id="不要重复索引指令-只能在-http-块中使用" tabindex="-1">不要重复索引指令，只能在 http 块中使用 <a class="header-anchor" href="#不要重复索引指令-只能在-http-块中使用" aria-label="Permalink to &quot;不要重复索引指令，只能在 http 块中使用&quot;">​</a></h3><blockquote><p>一次使用 index 指令。 它只需要在您的 http 上下文中发生，并将在下面继承。</p><p>我认为我们在复制相同规则时应格外小心。 但是，当然，规则的重复有时是可以的，或者不一定是大麻烦。</p></blockquote><p>示例：</p><p>❌ 错误配置</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  index </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index.php index.htm index.html;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">www.example.com;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      index </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index.php index.html index.$geo.html;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">www.example.com;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      index </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index.php index.htm index.html;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /data </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      index </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index.php;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>⭕ 正确配置</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  index </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">index.php index.htm index.html index.$geo.html;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">www.example.com;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">www.example.com;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /data </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="debugging" tabindex="-1">Debugging <a class="header-anchor" href="#debugging" aria-label="Permalink to &quot;Debugging&quot;">​</a></h2><h3 id="使用自定义日志格式" tabindex="-1">使用自定义日志格式 <a class="header-anchor" href="#使用自定义日志格式" aria-label="Permalink to &quot;使用自定义日志格式&quot;">​</a></h3><blockquote><p>您可以在 Nginx 配置中作为变量访问的任何内容都可以记录，包括非标准的 HTTP 标头等。因此，这是一种针对特定情况创建自己的日志格式的简单方法。</p><p>这对于调试特定的 <code>location</code> 指令非常有帮助。</p></blockquote><p>示例：</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Default main log format from the Nginx repository:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">log_format </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">main</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &#39;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">remote_addr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> - $</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">remote_user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> [$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">time_local</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">] &quot;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; &#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &#39;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> $</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">body_bytes_sent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http_referer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; &#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &#39;&quot;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http_user_agent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; &quot;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http_x_forwarded_for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Extended main log format:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">log_format </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">main-level-0</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &#39;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">remote_addr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> - $</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">remote_user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> [$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">time_local</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">] &#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &#39;&quot;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request_method</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> $</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scheme</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">://$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">host</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request_uri</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &#39;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">server_protocol</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; $</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> $</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">body_bytes_sent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &#39;&quot;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http_referer</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; &quot;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http_user_agent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; &#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &#39;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request_time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Debug log formats:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">log_format </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">debug-level-0</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &#39;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">remote_addr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> - $</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">remote_user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> [$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">time_local</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">] &#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &#39;&quot;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request_method</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> $</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">scheme</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">://$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">host</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request_uri</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &#39;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">server_protocol</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; $</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> $</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">body_bytes_sent</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &#39;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request_id</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> $</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pid</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> $</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">msec</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> $</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request_time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &#39;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">upstream_connect_time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> $</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">upstream_header_time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &#39;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">upstream_response_time</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request_filename</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot; &#39;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">                &#39;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request_completion</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h3 id="使用调试模式来跟踪意外行为" tabindex="-1">使用调试模式来跟踪意外行为 <a class="header-anchor" href="#使用调试模式来跟踪意外行为" aria-label="Permalink to &quot;使用调试模式来跟踪意外行为&quot;">​</a></h3><blockquote><p>通常，<code>error_log</code> 指令是在 <code>main</code> 中指定的，但是也可以在 <code>server</code> 或 <code>location</code> 块中指定，全局设置将被覆盖，并且这个 <code>error_log</code> 指令将设置其自己的日志文件路径和日志记录级别。</p><p>如果要记录 <code>ngx_http_rewrite_module</code> (at the notice level) ，应该在 <code>http</code>、<code>server</code> 或 <code>location</code> 块中开启 <code>rewrite_log on;</code>。</p><p>注意：</p><ul><li>永远不要将调试日志记录留在生产环境中的文件上</li><li>不要忘记在流量非常高的站点上恢复 <code>error_log</code> 的调试级别</li><li>必须使用日志回滚政策</li></ul></blockquote><p>示例：</p><ul><li>将 debug 信息写入文件</li></ul><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Turn on in a specific context, e.g.:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">##   - global    - for global logging</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">##   - http      - for http and all locations logging</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">##   - location  - for specific location</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error_log </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/var/log/nginx/error-debug.log </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">debug</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><ul><li>将 debug 信息写入内存</li></ul><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error_log </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">memory:32m </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">debug</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><ul><li>IP 地址/范围的调试日志：</li></ul><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">events</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  debug_connection </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   192.168.252.15/32;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  debug_connection </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   10.10.10.0/24;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><ul><li>为不同服务器设置不同 Debug 配置</li></ul><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">error_log </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/var/log/nginx/debug.log </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">debug</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ## To enable debugging:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    error_log </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/var/log/nginx/domain.com/domain.com-debug.log </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">debug</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ## To disable debugging:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    error_log </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/var/log/nginx/domain.com/domain.com-debug.log;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="核心转储" tabindex="-1">核心转储 <a class="header-anchor" href="#核心转储" aria-label="Permalink to &quot;核心转储&quot;">​</a></h3><blockquote><p>核心转储基本上是程序崩溃时内存的快照。</p><p>Nginx 是一个非常稳定的守护程序，但是有时可能会发生正在运行的 Nginx 进程独特终止的情况。</p><p>如果要保存内存转储，它可以确保应启用两个重要的指令，但是，为了正确处理内存转储，需要做一些事情。 有关它的完整信息，请参见转储进程的内存（来自本手册）。</p><p>当您的 Nginx 实例收到意外错误或崩溃时，应始终启用核心转储。</p></blockquote><p>示例：</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">worker_rlimit_core </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">   500m</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">worker_rlimit_nofile </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 65535</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">working_directory </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    /var/dump/nginx;</span></span></code></pre></div><h2 id="性能" tabindex="-1">性能 <a class="header-anchor" href="#性能" aria-label="Permalink to &quot;性能&quot;">​</a></h2><h3 id="工作进程数" tabindex="-1">工作进程数 <a class="header-anchor" href="#工作进程数" aria-label="Permalink to &quot;工作进程数&quot;">​</a></h3><blockquote><p><code>worker_processes</code> - 用于设置 Nginx 的工作进程数。</p></blockquote><ul><li>worker_processes 的默认值为 1。</li><li>设置 worker_processes 的安全做法是将其设为 auto，则启动 Nginx 时会自动分配工作进程数。当然，也可以显示的设置一个工作进程数值。</li><li>一般一个进程足够了，你可以把连接数设得很大。（worker_processes: 1，worker_connections: 10,000）如果有 SSL、gzip 这些比较消耗 CPU 的工作，而且是多核 CPU 的话，可以设为和 CPU 的数量一样。或者要处理很多很多的小文件，而且文件总大小比内存大很多的时候，也可以把进程数增加，以充分利用 IO 带宽（主要似乎是 IO 操作有 block）</li></ul><p>示例：</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## The safest way:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">worker_processes </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">auto;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## VCPU = 4 , expr $(nproc --all) - 1</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">worker_processes </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h3 id="最大连接数" tabindex="-1">最大连接数 <a class="header-anchor" href="#最大连接数" aria-label="Permalink to &quot;最大连接数&quot;">​</a></h3><blockquote><p><code>worker_connections</code> - 单个 Nginx 工作进程允许同时建立的外部连接的数量。数字越大，能同时处理的连接越多。</p></blockquote><p><code>worker_connections</code> 不是随便设置的，而是与两个指标有重要关联：</p><ul><li>内存 <ul><li>每个连接数分别对应一个 read_event、一个 write_event 事件，一个连接数大概占用 232 字节，2 个事件总占用 96 字节，那么一个连接总共占用 328 字节，通过数学公式可以算出 100000 个连接数大概会占用 31M = 100000 * 328 / 1024 / 1024，当然这只是 nginx 启动时，worker_connections 连接数所占用的 nginx。</li></ul></li><li>操作系统级别”进程最大可打开文件数“。 <ul><li>进程最大可打开文件数受限于操作系统，可通过 <code>ulimit -n</code> 命令查询，以前是 1024，现在是 65535。</li><li>nginx 提供了 worker_rlimit_nofile 指令，这是除了 ulimit 的一种设置可用的描述符的方式。 该指令与使用 ulimit 对用户的设置是同样的效果。此指令的值将覆盖 ulimit 的值，如：worker_rlimit_nofile 20960; 设置 ulimits：ulimit -SHn 65535</li></ul></li></ul><h3 id="使用-http-2" tabindex="-1">使用 HTTP/2 <a class="header-anchor" href="#使用-http-2" aria-label="Permalink to &quot;使用 HTTP/2&quot;">​</a></h3><blockquote><p>HTTP / 2 将使我们的应用程序更快，更简单且更可靠。 HTTP / 2 的主要目标是通过启用完整的请求和响应多路复用来减少延迟，通过有效压缩 HTTP 标头字段来最小化协议开销，并增加对请求优先级和服务器推送的支持。</p><p>HTTP / 2 与 HTTP / 1.1 向后兼容，因此有可能完全忽略它，并且一切都会像以前一样继续工作，因为如果不支持 HTTP / 2 的客户端永远不会向服务器请求 HTTP / 2 通讯升级：它们之间的通讯将完全是 HTTP1 / 1。</p><p>请注意，HTTP / 2 在单个 TCP 连接中多路复用许多请求。 通常，当使用 HTTP / 2 时，将与服务器建立单个 TCP 连接。</p><p>您还应该包括 ssl 参数，这是必需的，因为浏览器不支持未经加密的 HTTP / 2。</p><p>HTTP / 2 对旧的和不安全的密码有一个非常大的黑名单，因此您应该避免使用它们。</p></blockquote><p>示例：</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  listen </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">10.240.20.2:443 ssl http2;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span></code></pre></div><h3 id="维护-ssl-会话" tabindex="-1">维护 SSL 会话 <a class="header-anchor" href="#维护-ssl-会话" aria-label="Permalink to &quot;维护 SSL 会话&quot;">​</a></h3><blockquote><p>客户端每次发出请求时都进行新的 SSL 握手的需求。默认情况下，内置会话缓存并不是最佳选择，因为它只能由一个工作进程使用，并且可能导致内存碎片，最好使用共享缓存。</p><p>使用 <code>ssl_session_cache</code> 时，通过 SSL 保持连接的性能可能会大大提高。10M 的值是一个很好的起点（1MB 共享缓存可以容纳大约 4,000 个会话）。通过共享，所有工作进程之间共享一个缓存（可以在多个虚拟服务器中使用相同名称的缓存）。</p><p>但是，大多数服务器不清除会话或票证密钥，因此增加了服务器受到损害将泄漏先前（和将来）连接中的数据的风险。</p></blockquote><p>示例：</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_session_cache </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  shared:NGX_SSL_CACHE:10m;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_session_timeout </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">12h</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_session_tickets </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">off</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_buffer_size </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    1400</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h4 id="尽可能在-server-name-指令中使用确切名称" tabindex="-1">尽可能在 server_name 指令中使用确切名称 <a class="header-anchor" href="#尽可能在-server-name-指令中使用确切名称" aria-label="Permalink to &quot;尽可能在 server_name 指令中使用确切名称&quot;">​</a></h4><blockquote><p>确切名称，以星号开头的通配符名称和以星号结尾的通配符名称存储在绑定到侦听端口的三个哈希表中。</p><p>首先搜索确切名称哈希表。 如果未找到名称，则搜索具有以星号开头的通配符名称的哈希表。 如果未在此处找到名称，则搜索带有通配符名称以星号结尾的哈希表。 搜索通配符名称哈希表比搜索精确名称哈希表要慢，因为名称是按域部分搜索的。</p><p>正则表达式是按顺序测试的，因此是最慢的方法，并且不可缩放。由于这些原因，最好在可能的地方使用确切的名称。</p></blockquote><p>示例：</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## It is more efficient to define them explicitly:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    listen </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      192.168.252.10:80;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> example.org  www.example.org  *.example.org;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Than to use the simplified form:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    listen </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      192.168.252.10:80;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> .example.org;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="避免使用-if-检查-server-name" tabindex="-1">避免使用 <code>if</code> 检查 <code>server_name</code> <a class="header-anchor" href="#避免使用-if-检查-server-name" aria-label="Permalink to &quot;避免使用 `if` 检查 `server_name`&quot;">​</a></h3><blockquote><p>当 Nginx 收到请求时，无论请求的是哪个子域，无论是 www.example.com 还是普通的 example.com，如果始终对 if 指令进行评估。 由于您是在请求 Nginx 检查每个请求的 Host 标头。 效率极低。</p><p>而是使用两个服务器指令，如下面的示例。 这种方法降低了 Nginx 的处理要求。</p></blockquote><p>示例：</p><p>❌ 错误配置</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                domain.com www.domain.com;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ($host </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">= </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">www.domain.com) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                    301</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> https://domain.com$request_uri;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                domain.com;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>⭕ 正确配置</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">              www.domain.com;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">                    301</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> $scheme://domain.com$request_uri;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ## If you force your web traffic to use HTTPS:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ##                         301 https://domain.com$request_uri;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    listen </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                   192.168.252.10:80;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">              domain.com;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="使用-request-uri-来避免使用正则表达式" tabindex="-1">使用 <code>$request_uri</code> 来避免使用正则表达式 <a class="header-anchor" href="#使用-request-uri-来避免使用正则表达式" aria-label="Permalink to &quot;使用 `$request_uri` 来避免使用正则表达式&quot;">​</a></h3><blockquote><p>使用内置变量 <code>$request_uri</code>，我们可以完全避免进行任何捕获或匹配。默认情况下，正则表达式的代价较高，并且会降低性能。</p><p>此规则用于解决将 URL 不变地传递到新主机，确保仅通过现有 URI 进行返回的效率更高。</p></blockquote><p>示例：</p><p>❌ 错误配置</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## 1)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">rewrite</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^/(.*)$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> https://example.com/$1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">permanent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## 2)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">rewrite</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^ https://example.com$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">request_uri? </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">permanent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>⭕ 正确配置</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 301</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> https://example.com$request_uri;</span></span></code></pre></div><h3 id="使用-try-files-指令确认文件是否存在" tabindex="-1">使用 <code>try_files</code> 指令确认文件是否存在 <a class="header-anchor" href="#使用-try-files-指令确认文件是否存在" aria-label="Permalink to &quot;使用 `try_files` 指令确认文件是否存在&quot;">​</a></h3><blockquote><p><code>try_files</code> is definitely a very useful thing. You can use <code>try_files</code> directive to check a file exists in a specified order.</p></blockquote><blockquote><p>You should use <code>try_files</code> instead of <code>if</code> directive. It&#39;s definitely better way than using <code>if</code> for this action because <code>if</code> directive is extremely inefficient since it is evaluated every time for every request.</p></blockquote><blockquote><p>The advantage of using <code>try_files</code> is that the behavior switches immediately with one command. I think the code is more readable also.</p></blockquote><blockquote><p><code>try_files</code> allows you:</p><ul><li>to check if the file exists from a predefined list</li><li>to check if the file exists from a specified directory</li><li>to use an internal redirect if none of the files are found</li></ul></blockquote><p>示例：</p><p>❌ 错误配置</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  root </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/var/www/example.com;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /images </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-f </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$request_filename) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      expires </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">30d</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      break</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>⭕ 正确配置</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  root </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">/var/www/example.com;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /images </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    try_files </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$uri </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">=404</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="使用-return-代替-rewrite-来做重定向" tabindex="-1">使用 return 代替 rewrite 来做重定向 <a class="header-anchor" href="#使用-return-代替-rewrite-来做重定向" aria-label="Permalink to &quot;使用 return 代替 rewrite 来做重定向&quot;">​</a></h3><blockquote><p>您应该使用服务器块和 return 语句，因为它们比通过位置块评估 RegEx 更简单，更快捷。 该指令停止处理，并将指定的代码返回给客户端。</p></blockquote><p>示例：</p><p>❌ 错误配置</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ($host </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">= </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">api.domain.com) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    rewrite</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">     ^/(.*)$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> http://example.com/$1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">permanent</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span></code></pre></div><p>⭕ 正确配置</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ($host </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">= </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">api.domain.com) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">      403</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ## or other examples:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ##   return    301 https://domain.com$request_uri;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ##   return    301 $scheme://$host$request_uri;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span></code></pre></div><h3 id="开启-pcre-jit-来加速正则表达式处理" tabindex="-1">开启 PCRE JIT 来加速正则表达式处理 <a class="header-anchor" href="#开启-pcre-jit-来加速正则表达式处理" aria-label="Permalink to &quot;开启 PCRE JIT 来加速正则表达式处理&quot;">​</a></h3><blockquote><p>允许使用 JIT 的正则表达式来加速他们的处理。</p><p>通过与 PCRE 库编译 Nginx 的，你可以用你的 location 块进行复杂的操作和使用功能强大的 return 和 rewrite。</p><p>PCRE JIT 可以显著加快正则表达式的处理。 Nginx 的与 pcre_jit 比没有更快的幅度。</p><p>如果你试图在使用 pcre_jit;没有可用的 JIT，或者 Nginx 的与现有 JIT，但当前加载 PCRE 库编译不支持 JIT，将配置解析时发出警告。</p><p>当您编译使用 NGNIX 配置 PCRE 库时，才需要--with-PCRE-JIT 时（./configure --with-PCRE =）。当使用系统 PCRE 库 JIT 是否被支持依赖于库是如何被编译。</p><p>从 Nginx 的文档：</p><p>JIT 正在从与--enable-JIT 配置参数内置 8.20 版本开始 PCRE 库提供。当 PCRE 库与 nginx 的内置（--with-PCRE =）时，JIT 支持经由--with-PCRE-JIT 配置参数使能。</p></blockquote><p>示例：</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## In global context:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">pcre_jit </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h4 id="进行精确的位置匹配以加快选择过程" tabindex="-1">进行精确的位置匹配以加快选择过程 <a class="header-anchor" href="#进行精确的位置匹配以加快选择过程" aria-label="Permalink to &quot;进行精确的位置匹配以加快选择过程&quot;">​</a></h4><blockquote><p>精确的位置匹配通常用于通过立即结束算法的执行来加快选择过程。</p></blockquote><p>示例：</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Matches the query / only and stops searching:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Matches the query /v9 only and stops searching:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> /v9 </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Matches any query due to the fact that all queries begin at /,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## but regular expressions and any longer conventional blocks will be matched at first place:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="使用-limit-conn-改善对下载速度的限制" tabindex="-1">使用 <code>limit_conn</code> 改善对下载速度的限制 <a class="header-anchor" href="#使用-limit-conn-改善对下载速度的限制" aria-label="Permalink to &quot;使用 `limit_conn` 改善对下载速度的限制&quot;">​</a></h4><blockquote><p>Nginx provides two directives to limiting download speed:</p><p>Nginx 提供了两个指令来限制下载速度：</p><ul><li><code>limit_rate_after</code> - 设置 limit_rate 指令生效之前传输的数据量</li><li><code>limit_rate</code> - 允许您限制单个客户端连接的传输速率</li></ul></blockquote><blockquote><p>此解决方案限制了每个连接的 Nginx 下载速度，因此，如果一个用户打开多个（例如） 视频文件，则可以下载 <code>X * 连接到视频文件的次数</code> 。</p></blockquote><p>示例：</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Create limit connection zone:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">limit_conn_zone </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$binary_remote_addr zone=conn_for_remote_addr:1m;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Add rules to limiting the download speed:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">limit_rate_after </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1m</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## run at maximum speed for the first 1 megabyte</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">limit_rate </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">250k</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;      </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## and set rate limit after 1 megabyte</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Enable queue:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /videos </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ## Max amount of data by one client: 10 megabytes (limit_rate_after * 10)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  limit_conn </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">conn_for_remote_addr </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span></code></pre></div><h2 id="hardening" tabindex="-1">Hardening <a class="header-anchor" href="#hardening" aria-label="Permalink to &quot;Hardening&quot;">​</a></h2><ul><li><strong><a href="https://github.com/trimstray/nginx-admins-handbook#toc-hardening-2" target="_blank" rel="noreferrer">⬆ Hardening</a></strong><ul><li><a href="#beginner-always-keep-nginx-up-to-date">Always keep Nginx up-to-date</a></li><li><a href="#beginner-run-as-an-unprivileged-user">Run as an unprivileged user</a></li><li><a href="#beginner-disable-unnecessary-modules">Disable unnecessary modules</a></li><li><a href="#beginner-protect-sensitive-resources">Protect sensitive resources</a></li><li><a href="#beginner-hide-nginx-version-number">Hide Nginx version number</a></li><li><a href="#beginner-hide-nginx-server-signature">Hide Nginx server signature</a></li><li><a href="#beginner-hide-upstream-proxy-headers">Hide upstream proxy headers</a></li><li><a href="#beginner-force-all-connections-over-tls">Force all connections over TLS</a></li><li><a href="#beginner-use-only-the-latest-supported-openssl-version">Use only the latest supported OpenSSL version</a></li><li><a href="#beginner-use-min-2048-bit-private-keys">Use min. 2048-bit private keys</a></li><li><a href="#beginner-keep-only-tls-13-and-tls-12">Keep only TLS 1.3 and TLS 1.2</a></li><li><a href="#beginner-use-only-strong-ciphers">Use only strong ciphers</a></li><li><a href="#beginner-use-more-secure-ecdh-curve">Use more secure ECDH Curve</a></li><li><a href="#beginner-use-strong-key-exchange-with-perfect-forward-secrecy">Use strong Key Exchange with Perfect Forward Secrecy</a></li><li><a href="#beginner-prevent-replay-attacks-on-zero-round-trip-time">Prevent Replay Attacks on Zero Round-Trip Time</a></li><li><a href="#beginner-defend-against-the-beast-attack">Defend against the BEAST attack</a></li><li><a href="#beginner-mitigation-of-crimebreach-attacks">Mitigation of CRIME/BREACH attacks</a></li><li><a href="#beginner-http-strict-transport-security">HTTP Strict Transport Security</a></li><li><a href="#beginner-reduce-xss-risks-content-security-policy">Reduce XSS risks (Content-Security-Policy)</a></li><li><a href="#beginner-control-the-behaviour-of-the-referer-header-referrer-policy">Control the behaviour of the Referer header (Referrer-Policy)</a></li><li><a href="#beginner-provide-clickjacking-protection-x-frame-options">Provide clickjacking protection (X-Frame-Options)</a></li><li><a href="#beginner-prevent-some-categories-of-xss-attacks-x-xss-protection">Prevent some categories of XSS attacks (X-XSS-Protection)</a></li><li><a href="#beginner-prevent-sniff-mimetype-middleware-x-content-type-options">Prevent Sniff Mimetype middleware (X-Content-Type-Options)</a></li><li><a href="#beginner-deny-the-use-of-browser-features-feature-policy">Deny the use of browser features (Feature-Policy)</a></li><li><a href="#beginner-reject-unsafe-http-methods">Reject unsafe HTTP methods</a></li><li><a href="#beginner-prevent-caching-of-sensitive-data">Prevent caching of sensitive data</a></li><li><a href="#beginner-control-buffer-overflow-attacks">Control Buffer Overflow attacks</a></li><li><a href="#beginner-mitigating-slow-http-dos-attacks-closing-slow-connections">Mitigating Slow HTTP DoS attacks (Closing Slow Connections)</a></li></ul></li></ul><p>In this chapter I will talk about some of the Nginx hardening approaches and security standards.</p><h3 id="always-keep-nginx-up-to-date" tabindex="-1">🔰 Always keep Nginx up-to-date <a class="header-anchor" href="#always-keep-nginx-up-to-date" aria-label="Permalink to &quot;:beginner: Always keep Nginx up-to-date&quot;">​</a></h3><h4 id="rationale" tabindex="-1">Rationale <a class="header-anchor" href="#rationale" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>Nginx is a very secure and stable but vulnerabilities in the main binary itself do pop up from time to time. It&#39;s the main reason for keep Nginx up-to-date as hard as you can.</p></blockquote><blockquote><p>A very safe way to plan the update is once a new stable version is released but for me the most common way to handle Nginx updates is to wait a few weeks after the stable release.</p></blockquote><blockquote><p>Before update/upgrade Nginx remember about do it on the testing environment.</p></blockquote><blockquote><p>Most modern GNU/Linux distros will not push the latest version of Nginx into their default package lists so maybe you should consider install it from sources.</p></blockquote><h3 id="run-as-an-unprivileged-user" tabindex="-1">🔰 Run as an unprivileged user <a class="header-anchor" href="#run-as-an-unprivileged-user" aria-label="Permalink to &quot;:beginner: Run as an unprivileged user&quot;">​</a></h3><h4 id="rationale-1" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-1" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>There is no real difference in security just by changing the process owner name. On the other hand in security, the principle of least privilege states that an entity should be given no more permission than necessary to accomplish its goals within a given system. This way only master process runs as root.</p></blockquote><blockquote><p>This is the default Nginx behaviour, but remember to check it.</p></blockquote><h4 id="example" tabindex="-1">Example <a class="header-anchor" href="#example" aria-label="Permalink to &quot;Example&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Edit nginx.conf:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">user</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Set owner and group for root (app, default) directory:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chown</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -R</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx:nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /var/www/domain.com</span></span></code></pre></div><h4 id="external-resources" tabindex="-1">External resources <a class="header-anchor" href="#external-resources" aria-label="Permalink to &quot;External resources&quot;">​</a></h4><ul><li><a href="https://unix.stackexchange.com/questions/134301/why-does-nginx-starts-process-as-root" target="_blank" rel="noreferrer">Why does nginx starts process as root?</a></li></ul><h3 id="disable-unnecessary-modules" tabindex="-1">🔰 Disable unnecessary modules <a class="header-anchor" href="#disable-unnecessary-modules" aria-label="Permalink to &quot;:beginner: Disable unnecessary modules&quot;">​</a></h3><h4 id="rationale-2" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-2" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>It is recommended to disable any modules which are not required as this will minimise the risk of any potential attacks by limiting the operations allowed by the web server.</p></blockquote><blockquote><p>The best way to unload unused modules is use the <code>configure</code> option during installation. If you have static linking a shared module you should re-compile Nginx.</p></blockquote><blockquote><p>Use only high quality modules and remember about that:</p><p><em>Unfortunately, many third‑party modules use blocking calls, and users (and sometimes even the developers of the modules) aren’t aware of the drawbacks. Blocking operations can ruin Nginx performance and must be avoided at all costs.</em></p></blockquote><h4 id="example-1" tabindex="-1">Example <a class="header-anchor" href="#example-1" aria-label="Permalink to &quot;Example&quot;">​</a></h4><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## 1) During installation:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">./</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">configure</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> --without-http_autoindex_module</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## 2) Comment modules in the configuration file e.g. modules.conf:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## load_module                 /usr/share/nginx/modules/ndk_http_module.so;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## load_module                 /usr/share/nginx/modules/ngx_http_auth_pam_module.so;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## load_module                 /usr/share/nginx/modules/ngx_http_cache_purge_module.so;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## load_module                 /usr/share/nginx/modules/ngx_http_dav_ext_module.so;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">load_module </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                  /usr/share/nginx/modules/ngx_http_echo_module.so;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## load_module                 /usr/share/nginx/modules/ngx_http_fancyindex_module.so;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">load_module </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                  /usr/share/nginx/modules/ngx_http_geoip_module.so;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">load_module </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                  /usr/share/nginx/modules/ngx_http_headers_more_filter_module.so;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## load_module                 /usr/share/nginx/modules/ngx_http_image_filter_module.so;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## load_module                 /usr/share/nginx/modules/ngx_http_lua_module.so;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">load_module </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">                  /usr/share/nginx/modules/ngx_http_perl_module.so;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## load_module                 /usr/share/nginx/modules/ngx_mail_module.so;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## load_module                 /usr/share/nginx/modules/ngx_nchan_module.so;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## load_module                 /usr/share/nginx/modules/ngx_stream_module.so;</span></span></code></pre></div><h4 id="external-resources-1" tabindex="-1">External resources <a class="header-anchor" href="#external-resources-1" aria-label="Permalink to &quot;External resources&quot;">​</a></h4><ul><li><a href="https://github.com/nginx-modules" target="_blank" rel="noreferrer">nginx-modules</a></li></ul><h3 id="protect-sensitive-resources" tabindex="-1">🔰 Protect sensitive resources <a class="header-anchor" href="#protect-sensitive-resources" aria-label="Permalink to &quot;:beginner: Protect sensitive resources&quot;">​</a></h3><h4 id="rationale-3" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-3" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>Hidden directories and files should never be web accessible - sometimes critical data are published during application deploy. If you use control version system you should defninitely drop the access to the critical hidden directories like a <code>.git</code> or <code>.svn</code> to prevent expose source code of your application.</p></blockquote><blockquote><p>Sensitive resources contains items that abusers can use to fully recreate the source code used by the site and look for bugs, vulnerabilities, and exposed passwords.</p></blockquote><h4 id="example-2" tabindex="-1">Example <a class="header-anchor" href="#example-2" aria-label="Permalink to &quot;Example&quot;">​</a></h4><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ($request_uri </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">~ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/\.git&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 403</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## or</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> /\.git </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  deny </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">all</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## or</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~*</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^.*(\.(?:git|svn|htaccess))$ </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 403</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## or all . directories/files excepted .well-known</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> /\.(?!well-known\/) </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  deny </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">all</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="external-resources-2" tabindex="-1">External resources <a class="header-anchor" href="#external-resources-2" aria-label="Permalink to &quot;External resources&quot;">​</a></h4><ul><li><a href="https://github.com/bl4de/research/tree/master/hidden_directories_leaks" target="_blank" rel="noreferrer">Hidden directories and files as a source of sensitive information about web application</a></li></ul><h3 id="hide-nginx-version-number" tabindex="-1">🔰 Hide Nginx version number <a class="header-anchor" href="#hide-nginx-version-number" aria-label="Permalink to &quot;:beginner: Hide Nginx version number&quot;">​</a></h3><h4 id="rationale-4" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-4" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>Disclosing the version of Nginx running can be undesirable, particularly in environments sensitive to information disclosure.</p></blockquote><p>But the &quot;Official Apache Documentation (Apache Core Features)&quot; (yep, it&#39;s not a joke...) say:</p><blockquote><p><em>Setting ServerTokens to less than minimal is not recommended because it makes it more difficult to debug interoperational problems. Also note that disabling the Server: header does nothing at all to make your server more secure. The idea of &quot;security through obscurity&quot; is a myth and leads to a false sense of safety.</em></p></blockquote><h4 id="example-3" tabindex="-1">Example <a class="header-anchor" href="#example-3" aria-label="Permalink to &quot;Example&quot;">​</a></h4><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server_tokens </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">off</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h4 id="external-resources-3" tabindex="-1">External resources <a class="header-anchor" href="#external-resources-3" aria-label="Permalink to &quot;External resources&quot;">​</a></h4><ul><li><a href="https://geekflare.com/remove-server-header-banner-nginx/" target="_blank" rel="noreferrer">Remove Version from Server Header Banner in nginx</a></li><li><a href="https://www.tunetheweb.com/security/http-security-headers/server-header/" target="_blank" rel="noreferrer">Reduce or remove server headers</a></li></ul><h3 id="hide-nginx-server-signature" tabindex="-1">🔰 Hide Nginx server signature <a class="header-anchor" href="#hide-nginx-server-signature" aria-label="Permalink to &quot;:beginner: Hide Nginx server signature&quot;">​</a></h3><h4 id="rationale-5" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-5" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>One of the easiest first steps to undertake, is to prevent the web server from showing its used software via the server header. Certainly, there are several reasons why you would like to change the server header. It could be security, it could be redundant systems, load balancers etc.</p></blockquote><blockquote><p>In my opinion there is no real reason or need to show this much information about your server. It is easy to look up particular vulnerabilities once you know the version number.</p></blockquote><blockquote><p>You should compile Nginx from sources with <code>ngx_headers_more</code> to used <code>more_set_headers</code> directive or use a <a href="https://gitlab.com/buik/nginx/blob/master/nginx-remove-server-header.patch" target="_blank" rel="noreferrer">nginx-remove-server-header.patch</a>.</p></blockquote><h4 id="example-4" tabindex="-1">Example <a class="header-anchor" href="#example-4" aria-label="Permalink to &quot;Example&quot;">​</a></h4><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">more_set_headers</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Server: Unknown&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h4 id="external-resources-4" tabindex="-1">External resources <a class="header-anchor" href="#external-resources-4" aria-label="Permalink to &quot;External resources&quot;">​</a></h4><ul><li><a href="https://www.troyhunt.com/shhh-dont-let-your-response-headers/" target="_blank" rel="noreferrer">Shhh... don’t let your response headers talk too loudly</a></li><li><a href="https://stackoverflow.com/questions/24594971/how-to-changehide-the-nginx-server-signature" target="_blank" rel="noreferrer">How to change (hide) the Nginx Server Signature?</a></li></ul><h3 id="hide-upstream-proxy-headers" tabindex="-1">🔰 Hide upstream proxy headers <a class="header-anchor" href="#hide-upstream-proxy-headers" aria-label="Permalink to &quot;:beginner: Hide upstream proxy headers&quot;">​</a></h3><h4 id="rationale-6" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-6" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>Securing a server goes far beyond not showing what&#39;s running but I think less is more is better.</p></blockquote><blockquote><p>When Nginx is used to proxy requests to an upstream server (such as a PHP-FPM instance), it can be beneficial to hide certain headers sent in the upstream response (e.g. the version of PHP running).</p></blockquote><h4 id="example-5" tabindex="-1">Example <a class="header-anchor" href="#example-5" aria-label="Permalink to &quot;Example&quot;">​</a></h4><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">proxy_hide_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X-Powered-By;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">proxy_hide_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X-AspNetMvc-Version;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">proxy_hide_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X-AspNet-Version;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">proxy_hide_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X-Drupal-Cache;</span></span></code></pre></div><h4 id="external-resources-5" tabindex="-1">External resources <a class="header-anchor" href="#external-resources-5" aria-label="Permalink to &quot;External resources&quot;">​</a></h4><ul><li><a href="https://veggiespam.com/headers/" target="_blank" rel="noreferrer">Remove insecure http headers</a></li></ul><h3 id="force-all-connections-over-tls" tabindex="-1">🔰 Force all connections over TLS <a class="header-anchor" href="#force-all-connections-over-tls" aria-label="Permalink to &quot;:beginner: Force all connections over TLS&quot;">​</a></h3><h4 id="rationale-7" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-7" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>TLS provides two main services. For one, it validates the identity of the server that the user is connecting to for the user. It also protects the transmission of sensitive information from the user to the server.</p></blockquote><blockquote><p>In my opinion you should always use HTTPS instead of HTTP to protect your website, even if it doesn’t handle sensitive communications. The application can have many sensitive places that should be protected.</p></blockquote><blockquote><p>Always put login page, registration forms, all subsequent authenticated pages, contact forms, and payment details forms in HTTPS to prevent injection and sniffing. Them must be accessed only over TLS to ensure your traffic is secure.</p></blockquote><blockquote><p>If page is available over TLS, it must be composed completely of content which is transmitted over TLS. Requesting subresources using the insecure HTTP protocol weakens the security of the entire page and HTTPS protocol. Modern browsers should blocked or report all active mixed content delivered via HTTP on pages by default.</p></blockquote><blockquote><p>Also remember to implement the <a href="#beginner-http-strict-transport-security">HTTP Strict Transport Security (HSTS)</a>.</p></blockquote><blockquote><p>We have currently the first free and open CA - <a href="https://letsencrypt.org/" target="_blank" rel="noreferrer">Let&#39;s Encrypt</a> - so generating and implementing certificates has never been so easy. It was created to provide free and easy-to-use TLS and SSL certificates.</p></blockquote><h4 id="example-6" tabindex="-1">Example <a class="header-anchor" href="#example-6" aria-label="Permalink to &quot;Example&quot;">​</a></h4><ul><li><p>force all traffic to use TLS:</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  listen </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">10.240.20.2:80;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">domain.com;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 301</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> https://$host$request_uri;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  listen </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">10.240.20.2:443 ssl;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">domain.com;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li><li><p>force e.g. login page to use TLS:</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  listen </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">10.240.20.2:80;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">domain.com;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ^~</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> /login </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 301</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> https://domain.com$request_uri;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></li></ul><h4 id="external-resources-6" tabindex="-1">External resources <a class="header-anchor" href="#external-resources-6" aria-label="Permalink to &quot;External resources&quot;">​</a></h4><ul><li><a href="https://security.stackexchange.com/questions/23646/should-we-force-user-to-https-on-website" target="_blank" rel="noreferrer">Should we force user to HTTPS on website?</a></li><li><a href="https://security.stackexchange.com/questions/137542/force-a-user-to-https" target="_blank" rel="noreferrer">Force a user to HTTPS</a></li><li><a href="https://letsencrypt.org/docs/" target="_blank" rel="noreferrer">Let&#39;s Encrypt Documentation</a></li></ul><h3 id="use-only-the-latest-supported-openssl-version" tabindex="-1">🔰 Use only the latest supported OpenSSL version <a class="header-anchor" href="#use-only-the-latest-supported-openssl-version" aria-label="Permalink to &quot;:beginner: Use only the latest supported OpenSSL version&quot;">​</a></h3><h4 id="rationale-8" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-8" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>Before start see <a href="https://www.openssl.org/policies/releasestrat.html" target="_blank" rel="noreferrer">Release Strategy Policies</a> and <a href="https://www.openssl.org/news/changelog.html" target="_blank" rel="noreferrer">Changelog</a> on the OpenSSL website.</p></blockquote><blockquote><p>Criteria for choosing OpenSSL version can vary and it depends all on your use.</p></blockquote><blockquote><p>The latest versions of the major OpenSSL library are (may be changed):</p><ul><li>the next version of OpenSSL will be 3.0.0</li><li>version 1.1.1 will be supported until 2023-09-11 (LTS) <ul><li>last minor version: 1.1.1c (May 23, 2019)</li></ul></li><li>version 1.1.0 will be supported until 2019-09-11 <ul><li>last minor version: 1.1.0k (May 28, 2018)</li></ul></li><li>version 1.0.2 will be supported until 2019-12-31 (LTS) <ul><li>last minor version: 1.0.2s (May 28, 2018)</li></ul></li><li>any other versions are no longer supported</li></ul></blockquote><blockquote><p>In my opinion the only safe way is based on the up-to-date and still supported version of the OpenSSL. And what&#39;s more, I recommend to hang on to the latest versions (e.g. 1.1.1).</p></blockquote><blockquote><p>If your system repositories do not have the newest OpenSSL, you can do the <a href="https://github.com/trimstray/nginx-admins-handbook#installing-from-source" target="_blank" rel="noreferrer">compilation</a> process (see OpenSSL sub-section).</p></blockquote><h4 id="external-resources-7" tabindex="-1">External resources <a class="header-anchor" href="#external-resources-7" aria-label="Permalink to &quot;External resources&quot;">​</a></h4><ul><li><a href="https://www.openssl.org/" target="_blank" rel="noreferrer">OpenSSL Official Website</a></li><li><a href="https://www.openssl.org/blog/" target="_blank" rel="noreferrer">OpenSSL Official Blog</a></li><li><a href="https://www.openssl.org/news/newslog.html" target="_blank" rel="noreferrer">OpenSSL Official Newslog</a></li></ul><h3 id="use-min-2048-bit-private-keys" tabindex="-1">🔰 Use min. 2048-bit private keys <a class="header-anchor" href="#use-min-2048-bit-private-keys" aria-label="Permalink to &quot;:beginner: Use min. 2048-bit private keys&quot;">​</a></h3><h4 id="rationale-9" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-9" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>Advisories recommend 2048 for now. Security experts are projecting that 2048 bits will be sufficient for commercial use until around the year 2030 (as per NIST).</p></blockquote><blockquote><p>The latest version of FIPS-186 also say the U.S. Federal Government generate (and use) digital signatures with 1024, 2048, or 3072 bit key lengths.</p></blockquote><blockquote><p>Generally there is no compelling reason to choose 4096 bit keys over 2048 provided you use sane expiration intervals.</p></blockquote><blockquote><p>If you want to get <strong>A+ with 100%s on SSL Lab</strong> (for Key Exchange) you should definitely use 4096 bit private keys. That&#39;s the main reason why you should use them.</p></blockquote><blockquote><p>Longer keys take more time to generate and require more CPU and power when used for encrypting and decrypting, also the SSL handshake at the start of each connection will be slower. It also has a small impact on the client side (e.g. browsers).</p></blockquote><blockquote><p>You can test above on your server with <code>openssl speed rsa</code> but remember: in OpenSSL speed tests you see difference on block cipher speed, while in real life most cpu time is spent on asymmetric algorithms during ssl handshake. On the other hand, modern processors are capable of executing at least 1k of RSA 1024-bit signs per second on a single core, so this isn&#39;t usually an issue.</p></blockquote><blockquote><p>Use of alternative solution: <a href="https://en.wikipedia.org/wiki/Elliptic-curve_cryptography" target="_blank" rel="noreferrer">ECC Certificate Signing Request (CSR)</a> - <code>ECDSA</code> certificates contain an <code>ECC</code> public key. <code>ECC</code> keys are better than <code>RSA &amp; DSA</code> keys in that the <code>ECC</code> algorithm is harder to break.</p></blockquote><p>The &quot;SSL/TLS Deployment Best Practices&quot; book say:</p><blockquote><p><em>The cryptographic handshake, which is used to establish secure connections, is an operation whose cost is highly influenced by private key size. Using a key that is too short is insecure, but using a key that is too long will result in &quot;too much&quot; security and slow operation. For most web sites, using RSA keys stronger than 2048 bits and ECDSA keys stronger than 256 bits is a waste of CPU power and might impair user experience. Similarly, there is little benefit to increasing the strength of the ephemeral key exchange beyond 2048 bits for DHE and 256 bits for ECDHE.</em></p></blockquote><p>Konstantin Ryabitsev (Reddit):</p><blockquote><p><em>Generally speaking, if we ever find ourselves in a world where 2048-bit keys are no longer good enough, it won&#39;t be because of improvements in brute-force capabilities of current computers, but because RSA will be made obsolete as a technology due to revolutionary computing advances. If that ever happens, 3072 or 4096 bits won&#39;t make much of a difference anyway. This is why anything above 2048 bits is generally regarded as a sort of feel-good hedging theatre.</em></p></blockquote><p><strong>My recommendation:</strong></p><blockquote><p>Use 2048-bit key instead of 4096-bit at this moment.</p></blockquote><h4 id="example-7" tabindex="-1">Example <a class="header-anchor" href="#example-7" aria-label="Permalink to &quot;Example&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">### Example (RSA):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( _fd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;domain.com.key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ; _len</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2048&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> genrsa</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -out</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${_fd} ${_len} )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Let&#39;s Encrypt:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">certbot</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> certonly</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> domain.com</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> www.domain.com</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --rsa-key-size</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2048</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">### Example (ECC):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## _curve: prime256v1, secp521r1, secp384r1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( _fd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;domain.com.key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ; _fd_csr</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;domain.com.csr&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ; _curve</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;prime256v1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ecparam</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -out</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${_fd} </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${_curve} </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-genkey</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> req</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -new</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${_fd} </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-out</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${_fd_csr} </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-sha256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Let&#39;s Encrypt (from above):</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">certbot</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --csr</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${_fd_csr} </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">-[other-args]</span></span></code></pre></div><p>For <code>x25519</code>:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( _fd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;private.key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ; _curve</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;x25519&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> genpkey</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -algorithm</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${_curve} </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">-out</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${_fd} )</span></span></code></pre></div><p>  ➡️ ssllabs score: <b>100%</b></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">( _fd</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;domain.com.key&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ; _len</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2048&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> genrsa</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -out</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${_fd} ${_len} )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Let&#39;s Encrypt:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">certbot</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> certonly</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> domain.com</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> www.domain.com</span></span></code></pre></div><p>  ➡️ ssllabs score: <b>90%</b></p><h4 id="external-resources-8" tabindex="-1">External resources <a class="header-anchor" href="#external-resources-8" aria-label="Permalink to &quot;External resources&quot;">​</a></h4><ul><li><a href="https://csrc.nist.gov/Projects/Key-Management/Key-Management-Guidelines" target="_blank" rel="noreferrer">Key Management Guidelines by NIST</a></li><li><a href="https://csrc.nist.gov/publications/detail/sp/800-131a/archive/2011-01-13" target="_blank" rel="noreferrer">Recommendation for Transitioning the Use of Cryptographic Algorithms and Key Lengths</a></li><li><a href="http://nvlpubs.nist.gov/nistpubs/FIPS/NIST.FIPS.186-4.pdf" target="_blank" rel="noreferrer">FIPS PUB 186-4 - Digital Signature Standard (DSS)</a> <sup>[pdf]</sup></li><li><a href="https://www.keylength.com/" target="_blank" rel="noreferrer">Cryptographic Key Length Recommendations</a></li><li><a href="https://certsimple.com/blog/measuring-ssl-rsa-keys" target="_blank" rel="noreferrer">So you&#39;re making an RSA key for an HTTPS certificate. What key size do you use?</a></li><li><a href="https://danielpocock.com/rsa-key-sizes-2048-or-4096-bits/" target="_blank" rel="noreferrer">RSA Key Sizes: 2048 or 4096 bits?</a></li><li><a href="https://msol.io/blog/tech/create-a-self-signed-ecc-certificate/" target="_blank" rel="noreferrer">Create a self-signed ECC certificate</a></li></ul><h3 id="keep-only-tls-1-3-and-tls-1-2" tabindex="-1">🔰 Keep only TLS 1.3 and TLS 1.2 <a class="header-anchor" href="#keep-only-tls-1-3-and-tls-1-2" aria-label="Permalink to &quot;:beginner: Keep only TLS 1.3 and TLS 1.2&quot;">​</a></h3><h4 id="rationale-10" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-10" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>It is recommended to run TLS 1.2/1.3 and fully disable SSLv2, SSLv3, TLS 1.0 and TLS 1.1 that have protocol weaknesses and uses older cipher suites (do not provide any modern ciper modes).</p></blockquote><blockquote><p>TLS 1.0 and TLS 1.1 must not be used (see <a href="https://tools.ietf.org/id/draft-moriarty-tls-oldversions-diediedie-00.html" target="_blank" rel="noreferrer">Deprecating TLSv1.0 and TLSv1.1</a>) and were superceded by TLS 1.2, which has now itself been superceded by TLS 1.3. They are also actively being deprecated in accordance with guidance from government agencies (e.g. NIST SP 80052r2) and industry consortia such as the Payment Card Industry Association (PCI) [PCI-TLS1].</p></blockquote><blockquote><p>TLS 1.2 and TLS 1.3 are both without security issues. Only these versions provides modern cryptographic algorithms. TLS 1.3 is a new TLS version that will power a faster and more secure web for the next few years. What&#39;s more, TLS 1.3 comes without a ton of stuff (was removed): renegotiation, compression, and many legacy algorithms: <code>DSA</code>, <code>RC4</code>, <code>SHA1</code>, <code>MD5</code>, <code>CBC</code> MAC-then-Encrypt ciphers. TLS 1.0 and TLS 1.1 protocols will be removed from browsers at the beginning of 2020.</p></blockquote><blockquote><p>TLS 1.2 does require careful configuration to ensure obsolete cipher suites with identified vulnerabilities are not used in conjunction with it. TLS 1.3 removes the need to make these decisions. TLS 1.3 version also improves TLS 1.2 security, privace and performance issues.</p></blockquote><blockquote><p>Before enabling specific protocol version, you should check which ciphers are supported by the protocol. So if you turn on TLS 1.2 and TLS 1.3 both remember about <a href="#beginner-use-only-strong-ciphers">the correct (and strong)</a> ciphers to handle them. Otherwise, they will not be anyway works without supported ciphers (no TLS handshake will succeed).</p></blockquote><blockquote><p>I think the best way to deploy secure configuration is: enable TLS 1.2 without any <code>CBC</code> Ciphers (is safe enough) only TLS 1.3 is safer because of its handling improvement and the exclusion of everything that went obsolete since TLS 1.2 came up.</p></blockquote><blockquote><p>If you told Nginx to use TLS 1.3, it will use TLS 1.3 only where is available. Nginx supports TLS 1.3 since version 1.13.0 (released in April 2017), when built against OpenSSL 1.1.1 or more.</p></blockquote><blockquote><p>For TLS 1.3, think about using <a href="#beginner-prevent-replay-attacks-on-zero-round-trip-time"><code>ssl_early_data</code></a> to allow TLS 1.3 0-RTT handshakes.</p></blockquote><p><strong>My recommendation:</strong></p><blockquote><p>Use only <a href="#keep-only-tls1.2-tls13">TLSv1.3 and TLSv1.2</a>.</p></blockquote><h4 id="example-8" tabindex="-1">Example <a class="header-anchor" href="#example-8" aria-label="Permalink to &quot;Example&quot;">​</a></h4><p>TLS 1.3 + 1.2:</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_protocols </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TLSv1.3 TLSv1.2;</span></span></code></pre></div><p>TLS 1.2:</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_protocols </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TLSv1.2;</span></span></code></pre></div><p>  ➡️ ssllabs score: <b>100%</b></p><p>TLS 1.3 + 1.2 + 1.1:</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_protocols </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TLSv1.3 TLSv1.2 TLSv1.1;</span></span></code></pre></div><p>TLS 1.2 + 1.1:</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_protocols </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">TLSv1.2 TLSv1.1;</span></span></code></pre></div><p>  ➡️ ssllabs score: <b>95%</b></p><h4 id="external-resources-9" tabindex="-1">External resources <a class="header-anchor" href="#external-resources-9" aria-label="Permalink to &quot;External resources&quot;">​</a></h4><ul><li><a href="https://www.ietf.org/rfc/rfc5246.txt" target="_blank" rel="noreferrer">The Transport Layer Security (TLS) Protocol Version 1.2</a></li><li><a href="https://tools.ietf.org/html/draft-ietf-tls-tls13-18" target="_blank" rel="noreferrer">The Transport Layer Security (TLS) Protocol Version 1.3</a></li><li><a href="https://tls12.ulfheim.net/" target="_blank" rel="noreferrer">TLS1.2 - Every byte explained and reproduced</a></li><li><a href="https://tls13.ulfheim.net/" target="_blank" rel="noreferrer">TLS1.3 - Every byte explained and reproduced</a></li><li><a href="https://wiki.openssl.org/index.php/TLS1.3" target="_blank" rel="noreferrer">TLS1.3 - OpenSSLWiki</a></li><li><a href="https://medium.com/@ethicalevil/tls-handshake-protocol-overview-a39e8eee2cf5" target="_blank" rel="noreferrer">TLS v1.2 handshake overview</a></li><li><a href="https://kinsta.com/blog/tls-1-3/" target="_blank" rel="noreferrer">An Overview of TLS 1.3 - Faster and More Secure</a></li><li><a href="https://blog.cloudflare.com/rfc-8446-aka-tls-1-3/" target="_blank" rel="noreferrer">A Detailed Look at RFC 8446 (a.k.a. TLS 1.3)</a></li><li><a href="https://www.wolfssl.com/differences-between-tls-1-2-and-tls-1-3/" target="_blank" rel="noreferrer">Differences between TLS 1.2 and TLS 1.3</a></li><li><a href="https://assured.se/2018/08/29/tls-1-3-in-a-nut-shell/" target="_blank" rel="noreferrer">TLS 1.3 in a nutshell</a></li><li><a href="https://www.ssl.com/article/tls-1-3-is-here-to-stay/" target="_blank" rel="noreferrer">TLS 1.3 is here to stay</a></li><li><a href="https://ma.ttias.be/enable-tls-1-3-nginx/" target="_blank" rel="noreferrer">How to enable TLS 1.3 on Nginx</a></li><li><a href="https://blog.probely.com/how-to-deploy-modern-tls-in-2018-1b9a9cafc454" target="_blank" rel="noreferrer">How to deploy modern TLS in 2019?</a></li><li><a href="https://media.ccc.de/v/33c3-8348-deploying_tls_1_3_the_great_the_good_and_the_bad" target="_blank" rel="noreferrer">Deploying TLS 1.3: the great, the good and the bad</a></li><li><a href="https://www.nccgroup.trust/us/about-us/newsroom-and-events/blog/2019/february/downgrade-attack-on-tls-1.3-and-vulnerabilities-in-major-tls-libraries/" target="_blank" rel="noreferrer">Downgrade Attack on TLS 1.3 and Vulnerabilities in Major TLS Libraries</a></li><li><a href="https://www.fastly.com/blog/phase-two-our-tls-10-and-11-deprecation-plan" target="_blank" rel="noreferrer">Phase two of our TLS 1.0 and 1.1 deprecation plan</a></li><li><a href="https://www.keycdn.com/blog/deprecating-tls-1-0-and-1-1" target="_blank" rel="noreferrer">Deprecating TLS 1.0 and 1.1 - Enhancing Security for Everyone</a></li><li><a href="https://www.acunetix.com/blog/articles/tls-vulnerabilities-attacks-final-part/" target="_blank" rel="noreferrer">TLS/SSL Explained – Examples of a TLS Vulnerability and Attack, Final Part</a></li><li><a href="https://security.googleblog.com/2014/10/this-poodle-bites-exploiting-ssl-30.html" target="_blank" rel="noreferrer">This POODLE bites: exploiting the SSL 3.0 fallback</a></li><li><a href="https://blog.pcisecuritystandards.org/are-you-ready-for-30-june-2018-sayin-goodbye-to-ssl-early-tls" target="_blank" rel="noreferrer">Are You Ready for 30 June 2018? Saying Goodbye to SSL/early TLS</a></li><li><a href="https://tools.ietf.org/id/draft-moriarty-tls-oldversions-diediedie-00.html" target="_blank" rel="noreferrer">Deprecating TLSv1.0 and TLSv1.1</a></li></ul><h3 id="use-only-strong-ciphers" tabindex="-1">🔰 Use only strong ciphers <a class="header-anchor" href="#use-only-strong-ciphers" aria-label="Permalink to &quot;:beginner: Use only strong ciphers&quot;">​</a></h3><h4 id="rationale-11" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-11" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>This parameter changes quite often, the recommended configuration for today may be out of date tomorrow.</p></blockquote><blockquote><p>To check ciphers supported by OpenSSL on your server: <code>openssl ciphers -s -v</code>, <code>openssl ciphers -s -v ECDHE</code> or <code>openssl ciphers -s -v DHE</code>.</p></blockquote><blockquote><p>For more security use only strong and not vulnerable cipher suites. Place <code>ECDHE</code> and <code>DHE</code> suites at the top of your list. The order is important because <code>ECDHE</code> suites are faster, you want to use them whenever clients supports them. Ephemeral <code>DHE/ECDHE</code> are recommended and support Perfect Forward Secrecy.</p></blockquote><blockquote><p>For backward compatibility software components you should use less restrictive ciphers. Not only that you have to enable at least one special <code>AES128</code> cipher for HTTP/2 support regarding to <a href="https://tools.ietf.org/html/rfc7540#section-9.2.2" target="_blank" rel="noreferrer">RFC7540: TLS 1.2 Cipher Suites</a>, you also have to allow <code>prime256</code> elliptic curves which reduces the score for key exchange by another 10% even if a secure server preferred order is set.</p></blockquote><blockquote><p>Also modern cipher suites (e.g. from Mozilla recommendations) suffers from compatibility troubles mainly because drops <code>SHA-1</code>. But be careful if you want to use ciphers with <code>HMAC-SHA-1</code> - there&#39;s a perfectly good <a href="https://crypto.stackexchange.com/a/26518" target="_blank" rel="noreferrer">explanation</a> why.</p></blockquote><blockquote><p>If you want to get <strong>A+ with 100%s on SSL Lab</strong> (for Cipher Strength) you should definitely disable <code>128-bit</code> ciphers. That&#39;s the main reason why you should not use them.</p></blockquote><blockquote><p>In my opinion <code>128-bit</code> symmetric encryption doesn’t less secure. Moreover, there are about 30% faster and still secure. For example TLS 1.3 use <code>TLS_AES_128_GCM_SHA256 (0x1301)</code> (for TLS-compliant applications).</p></blockquote><blockquote><p>It is not possible to control ciphers for TLS 1.3 without support from client to use new API for TLS 1.3 cipher suites. Nginx isn&#39;t able to influence that so at this moment it&#39;s always on (also if you disable potentially weak cipher from Nginx). On the other hand the ciphers in TLSv1.3 have been restricted to only a handful of completely secure ciphers by leading crypto experts.</p></blockquote><blockquote><p>For TLS 1.2 you should consider disable weak ciphers without forward secrecy like ciphers with <code>CBC</code> algorithm. Using them also reduces the final grade because they don&#39;t use ephemeral keys. In my opinion you should use ciphers with <code>AEAD</code> (TLS 1.3 supports only these suites) encryption because they don&#39;t have any known weaknesses.</p></blockquote><blockquote><p>Recently new vulnerabilities like Zombie POODLE, GOLDENDOODLE, 0-Length OpenSSL and Sleeping POODLE were published for websites that use <code>CBC</code> (Cipher Block Chaining) block cipher modes. These vulnerabilities are applicable only if the server uses TLS 1.2 or TLS 1.1 or TLS 1.0 with <code>CBC</code> cipher modes. Look at <a href="https://i.blackhat.com/asia-19/Fri-March-29/bh-asia-Young-Zombie-Poodle-Goldendoodle-and-How-TLSv13-Can-Save-Us-All.pdf" target="_blank" rel="noreferrer">Zombie POODLE, GOLDENDOODLE, &amp; How TLSv1.3 Can Save Us All</a> presentation from Black Hat Asia 2019.</p></blockquote><blockquote><p>Disable TLS cipher modes (all ciphers that start with <code>TLS_RSA_WITH_*</code>) that use RSA encryption because they are vulnerable to <a href="https://robotattack.org/" target="_blank" rel="noreferrer">ROBOT</a> attack. Not all servers that support RSA key exchange are vulnerable, but it is recommended to disable RSA key exchange ciphers as it does not support forward secrecy.</p></blockquote><blockquote><p>You should also absolutely disable weak ciphers regardless of the TLS version do you use, like those with <code>DSS</code>, <code>DSA</code>, <code>DES/3DES</code>, <code>RC4</code>, <code>MD5</code>, <code>SHA1</code>, <code>null</code>, anon in the name.</p></blockquote><blockquote><p>We have a nice online tool for testing compatibility cipher suites with user agents: <a href="https://cryptcheck.fr/suite/" target="_blank" rel="noreferrer">CryptCheck</a>. I think it will be very helpful for you.</p></blockquote><p><strong>My recommendation:</strong></p><blockquote><p>Use only <a href="#keep-only-tls1.2-tls13">TLSv1.3 and TLSv1.2</a> with below cipher suites:</p></blockquote><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_ciphers </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-256-GCM-SHA384:TLS13-AES-128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES128-GCM-SHA256&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h4 id="example-9" tabindex="-1">Example <a class="header-anchor" href="#example-9" aria-label="Permalink to &quot;Example&quot;">​</a></h4><p>Cipher suites for TLS 1.3:</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_ciphers </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-256-GCM-SHA384&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>Cipher suites for TLS 1.2:</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_ciphers </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES256-SHA384&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>  ➡️ ssllabs score: <b>100%</b></p><p>Cipher suites for TLS 1.3:</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_ciphers </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;TLS13-CHACHA20-POLY1305-SHA256:TLS13-AES-256-GCM-SHA384:TLS13-AES-128-GCM-SHA256&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>Cipher suites for TLS 1.2:</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## 1)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_ciphers </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES256-SHA384&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## 2)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_ciphers </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES128-GCM-SHA256&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## 3)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_ciphers </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## 4)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_ciphers </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;EECDH+CHACHA20:EDH+AESGCM:AES256+EECDH:AES256+EDH&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>Cipher suites for TLS 1.1 + 1.2:</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## 1)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_ciphers </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES128-GCM-SHA256&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## 2)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_ciphers </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ECDHE-ECDSA-CHACHA20-POLY1305:ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:!AES256-GCM-SHA256:!AES256-GCM-SHA128:!aNULL:!MD5&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>  ➡️ ssllabs score: <b>90%</b></p><p>This will also give a baseline for comparison with <a href="https://mozilla.github.io/server-side-tls/ssl-config-generator/" target="_blank" rel="noreferrer">Mozilla SSL Configuration Generator</a>:</p><ul><li>Modern profile with OpenSSL 1.1.0b (TLSv1.2)</li></ul><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_ciphers </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><ul><li>Intermediate profile with OpenSSL 1.1.0b (TLSv1, TLSv1.1 and TLSv1.2)</li></ul><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_ciphers </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA:ECDHE-RSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA:ECDHE-ECDSA-DES-CBC3-SHA:ECDHE-RSA-DES-CBC3-SHA:EDH-RSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:DES-CBC3-SHA:!DSS&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h4 id="external-resources-10" tabindex="-1">External resources <a class="header-anchor" href="#external-resources-10" aria-label="Permalink to &quot;External resources&quot;">​</a></h4><ul><li><a href="https://tools.ietf.org/html/rfc7525" target="_blank" rel="noreferrer">RFC 7525 - TLS Recommendations</a></li><li><a href="https://www.iana.org/assignments/tls-parameters/tls-parameters.xhtml#tls-parameters-4" target="_blank" rel="noreferrer">TLS Cipher Suites</a></li><li><a href="https://technology.amis.nl/2017/07/04/ssltls-choose-cipher-suite/" target="_blank" rel="noreferrer">SSL/TLS: How to choose your cipher suite</a></li><li><a href="https://sparanoid.com/note/http2-and-ecdsa-cipher-suites/" target="_blank" rel="noreferrer">HTTP/2 and ECDSA Cipher Suites</a></li><li><a href="https://www.securityevaluators.com/ssl-tls-protocol-versions-cipher-suites-use/" target="_blank" rel="noreferrer">Which SSL/TLS Protocol Versions and Cipher Suites Should I Use?</a></li><li><a href="https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/TLS_Cipher_String_Cheat_Sheet.md" target="_blank" rel="noreferrer">Recommendations for a cipher string by OWASP</a></li><li><a href="https://www.acunetix.com/blog/articles/tls-ssl-cipher-hardening/" target="_blank" rel="noreferrer">Recommendations for TLS/SSL Cipher Hardening by Acunetix</a></li><li><a href="https://wiki.mozilla.org/Security/Server_Side_TLS#Modern_compatibility" target="_blank" rel="noreferrer">Mozilla’s Modern compatibility suite</a></li><li><a href="https://tls.mbed.org/kb/cryptography/ephemeral-diffie-hellman" target="_blank" rel="noreferrer">Why use Ephemeral Diffie-Hellman</a></li><li><a href="https://blogs.technet.microsoft.com/askpfeplat/2017/12/26/cipher-suite-breakdown/" target="_blank" rel="noreferrer">Cipher Suite Breakdown</a></li><li><a href="https://blog.qualys.com/technology/2019/04/22/zombie-poodle-and-goldendoodle-vulnerabilities" target="_blank" rel="noreferrer">Zombie POODLE and GOLDENDOODLE Vulnerabilities</a></li><li><a href="https://testssl.sh/openssl-iana.mapping.html" target="_blank" rel="noreferrer">OpenSSL IANA Mapping</a></li><li><a href="https://lightshipsec.com/goodbye-tls_rsa/" target="_blank" rel="noreferrer">Goodbye TLS_RSA</a></li></ul><h3 id="use-more-secure-ecdh-curve" tabindex="-1">🔰 Use more secure ECDH Curve <a class="header-anchor" href="#use-more-secure-ecdh-curve" aria-label="Permalink to &quot;:beginner: Use more secure ECDH Curve&quot;">​</a></h3><h4 id="rationale-12" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-12" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>In my opinion your main source of knowledge should be <a href="https://safecurves.cr.yp.to/" target="_blank" rel="noreferrer">The SafeCurves web site</a>. This site reports security assessments of various specific curves.</p></blockquote><blockquote><p>For a SSL server certificate, an &quot;elliptic curve&quot; certificate will be used only with digital signatures (<code>ECDSA</code> algorithm). Nginx provides directive to specifies a curve for <code>ECDHE</code> ciphers.</p></blockquote><blockquote><p><code>x25519</code> is a more secure (also with SafeCurves requirements) but slightly less compatible option. I think to maximise interoperability with existing browsers and servers, stick to <code>P-256 prime256v1</code> and <code>P-384 secp384r1</code> curves. Of course there&#39;s tons of different opinions about <code>P-256</code> and <code>P-384</code> curves.</p></blockquote><blockquote><p>NSA Suite B says that NSA uses curves <code>P-256</code> and <code>P-384</code> (in OpenSSL, they are designated as, respectively, <code>prime256v1</code> and <code>secp384r1</code>). There is nothing wrong with <code>P-521</code>, except that it is, in practice, useless. Arguably, <code>P-384</code> is also useless, because the more efficient <code>P-256</code> curve already provides security that cannot be broken through accumulation of computing power.</p></blockquote><blockquote><p>Bernstein and Lange believe that the NIST curves are not optimal and there are better (more secure) curves that work just as fast, e.g. <code>x25519</code>.</p></blockquote><blockquote><p>Keep an eye also on this:</p><p><em>Secure implementations of the standard curves are theoretically possible but very hard.</em></p><p>The SafeCurves say:</p><ul><li><code>NIST P-224</code>, <code>NIST P-256</code> and <code>NIST P-384</code> are UNSAFE</li></ul><p>From the curves described here only <code>x25519</code> is a curve meets all SafeCurves requirements.</p></blockquote><blockquote><p>I think you can use <code>P-256</code> to minimise trouble. If you feel that your manhood is threatened by using a 256-bit curve where a 384-bit curve is available, then use <code>P-384</code>: it will increases your computational and network costs.</p></blockquote><blockquote><p>If you use TLS 1.3 you should enable <code>prime256v1</code> signature algorithm. Without this SSL Lab reports <code>TLS_AES_128_GCM_SHA256 (0x1301)</code> signature as weak.</p></blockquote><blockquote><p>If you do not set <code>ssl_ecdh_curve</code>, then Nginx will use its default settings, e.g. Chrome will prefer <code>x25519</code>, but it is <strong>not recommended</strong> because you can not control default settings (seems to be <code>P-256</code>) from the Nginx.</p></blockquote><blockquote><p>Explicitly set <code>ssl_ecdh_curve X25519:prime256v1:secp521r1:secp384r1;</code> <strong>decreases the Key Exchange SSL Labs rating</strong>.</p></blockquote><blockquote><p>Definitely do not use the <code>secp112r1</code>, <code>secp112r2</code>, <code>secp128r1</code>, <code>secp128r2</code>, <code>secp160k1</code>, <code>secp160r1</code>, <code>secp160r2</code>, <code>secp192k1</code> curves. They have a too small size for security application according to NIST recommendation.</p></blockquote><p><strong>My recommendation:</strong></p><blockquote><p>Use only <a href="#keep-only-tls1.2-tls13">TLSv1.3 and TLSv1.2</a> and <a href="#use-only-strong-ciphers">only strong ciphers</a> with above curves:</p></blockquote><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_ecdh_curve </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X25519:secp521r1:secp384r1:prime256v1;</span></span></code></pre></div><h4 id="example-10" tabindex="-1">Example <a class="header-anchor" href="#example-10" aria-label="Permalink to &quot;Example&quot;">​</a></h4><p>Curves for TLS 1.2:</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_ecdh_curve </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">secp521r1:secp384r1:prime256v1;</span></span></code></pre></div><p>  ➡️ ssllabs score: <b>100%</b></p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Alternative (this one doesn’t affect compatibility, by the way; it’s just a question of the preferred order).</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## This setup downgrade Key Exchange score but is recommended for TLS 1.2 + 1.3:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_ecdh_curve </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X25519:secp521r1:secp384r1:prime256v1;</span></span></code></pre></div><h4 id="external-resources-11" tabindex="-1">External resources <a class="header-anchor" href="#external-resources-11" aria-label="Permalink to &quot;External resources&quot;">​</a></h4><ul><li><a href="https://tools.ietf.org/html/rfc7748" target="_blank" rel="noreferrer">Elliptic Curves for Security</a></li><li><a href="http://www.secg.org/" target="_blank" rel="noreferrer">Standards for Efficient Cryptography Group</a></li><li><a href="https://safecurves.cr.yp.to/" target="_blank" rel="noreferrer">SafeCurves: choosing safe curves for elliptic-curve cryptography</a></li><li><a href="https://eprint.iacr.org/2013/647" target="_blank" rel="noreferrer">A note on high-security general-purpose elliptic curves</a></li><li><a href="https://blog.cr.yp.to/20140323-ecdsa.html" target="_blank" rel="noreferrer">P-521 is pretty nice prime</a></li><li><a href="https://certsimple.com/blog/safe-curves-and-openssl" target="_blank" rel="noreferrer">Safe ECC curves for HTTPS are coming sooner than you think</a></li><li><a href="https://www.keylength.com/" target="_blank" rel="noreferrer">Cryptographic Key Length Recommendations</a></li><li><a href="https://www.owasp.org/index.php/Testing_for_Weak_SSL/TLS_Ciphers,_Insufficient_Transport_Layer_Protection_(OTG-CRYPST-001)" target="_blank" rel="noreferrer">Testing for Weak SSL/TLS Ciphers, Insufficient Transport Layer Protection (OTG-CRYPST-001)</a></li><li><a href="https://tls.mbed.org/kb/cryptography/elliptic-curve-performance-nist-vs-brainpool" target="_blank" rel="noreferrer">Elliptic Curve performance: NIST vs Brainpool</a></li><li><a href="https://security.stackexchange.com/questions/78621/which-elliptic-curve-should-i-use/91562" target="_blank" rel="noreferrer">Which elliptic curve should I use?</a></li><li><a href="http://www.lapsedordinary.net/files/ECC_BSidesLDN_2015.pdf" target="_blank" rel="noreferrer">Elliptic Curve Cryptography for those who are afraid of maths</a></li></ul><h3 id="use-strong-key-exchange-with-perfect-forward-secrecy" tabindex="-1">🔰 Use strong Key Exchange with Perfect Forward Secrecy <a class="header-anchor" href="#use-strong-key-exchange-with-perfect-forward-secrecy" aria-label="Permalink to &quot;:beginner: Use strong Key Exchange with Perfect Forward Secrecy&quot;">​</a></h3><h4 id="rationale-13" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-13" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>To use a signature based authentication you need some kind of DH exchange (fixed or ephemeral/temporary), to exchange the session key. If you use it, Nginx will use the default Ephemeral Diffie-Hellman (<code>DHE</code>) paramaters to define how performs the Diffie-Hellman (DH) key-exchange. This uses a weak key (by default: <code>1024 bit</code>) that gets lower scores.</p></blockquote><blockquote><p>You should always use the Elliptic Curve Diffie Hellman Ephemeral (<code>ECDHE</code>). Due to increasing concern about pervasive surveillance, key exchanges that provide Forward Secrecy are recommended, see for example <a href="https://tools.ietf.org/html/rfc7525#section-6.3" target="_blank" rel="noreferrer">RFC 7525</a>.</p></blockquote><blockquote><p>For greater compatibility but still for security in key exchange, you should prefer the latter E (ephemeral) over the former E (EC). There is recommended configuration: <code>ECDHE</code> &gt; <code>DHE</code> (with min. <code>2048 bit</code> size) &gt; <code>ECDH</code>. With this if the initial handshake fails, another handshake will be initiated using <code>DHE</code>.</p></blockquote><blockquote><p><code>DHE</code> is slower than <code>ECDHE</code>. If you are concerned about performance, prioritize <code>ECDHE-ECDSA</code> over <code>DHE</code>. OWASP estimates that the TLS handshake with <code>DHE</code> hinders the CPU by a factor of 2.4 compared to <code>ECDHE</code>.</p></blockquote><blockquote><p>Diffie-Hellman requires some set-up parameters to begin with. Parameters from <code>ssl_dhparam</code> (which are generated with <code>openssl dhparam ...</code>) define how OpenSSL performs the Diffie-Hellman (DH) key-exchange. They include a field prime <code>p</code> and a generator <code>g</code>. The purpose of the availability to customize these parameter is to allow everyone to use own parameters for this. This can be used to prevent being affected from the Logjam attack.</p></blockquote><blockquote><p>Modern clients prefer <code>ECDHE</code> instead other variants and if your Nginx accepts this preference then the handshake will not use the DH param at all since it will not do a <code>DHE</code> key exchange but an <code>ECDHE</code> key exchange. Thus, if no plain <code>DH/DHE</code> ciphers are configured at your server but only Eliptic curve DH (e.g. <code>ECDHE</code>) then you don&#39;t need to set your own <code>ssl_dhparam</code> directive. Enabling <code>DHE</code> requires us to take care of our DH primes (a.k.a. <code>dhparams</code>) and to trust in <code>DHE</code>.</p></blockquote><blockquote><p>Elliptic curve Diffie-Hellman is a modified Diffie-Hellman exchange which uses Elliptic curve cryptography instead of the traditional RSA-style large primes. So while I&#39;m not sure what parameters it may need (if any), I don&#39;t think it needs the kind you&#39;re generating (<code>ECDH</code> is based on curves, not primes, so I don&#39;t think the traditional DH params will do you any good).</p></blockquote><blockquote><p>Cipher suites using <code>DHE</code> key exchange in OpenSSL require <code>tmp_DH</code> parameters, which the <code>ssl_dhparam</code> directive provides. The same is true for <code>DH_anon</code> key exchange, but in practice nobody uses those. The OpenSSL wiki page for Diffie Hellman Parameters it says: <em>To use perfect forward secrecy cipher suites, you must set up Diffie-Hellman parameters (on the server side).</em> Look also at <a href="https://www.openssl.org/docs/man1.0.2/man3/SSL_CTX_set_tmp_dh.html" target="_blank" rel="noreferrer">SSL_CTX_set_tmp_dh_callback</a>.</p></blockquote><blockquote><p>If you use <code>ECDH/ECDHE</code> key exchange please see <a href="#beginner-use-more-secure-ecdh-curve">Use more secure ECDH Curve</a> rule.</p></blockquote><blockquote><p>Default key size in OpenSSL is <code>1024 bits</code> - it&#39;s vulnerable and breakable. For the best security configuration use your own DH Group (min. <code>2048 bit</code>) or use known safe ones pre-defined DH groups (it&#39;s recommended) from the <a href="https://wiki.mozilla.org/Security/Server_Side_TLS#ffdhe4096" target="_blank" rel="noreferrer">Mozilla</a>.</p></blockquote><blockquote><p>The <code>2048 bit</code> is generally expected to be safe and is already very far into the &quot;cannot break it zone&quot;. However years ago people expected 1024 bit to be safe so if you are after long term resistance You would go up to <code>4096 bit</code> (for both RSA keys and DH parameters). It&#39;s also important if you want to get 100% on Key Exchange of the SSL Labs test.</p></blockquote><blockquote><p>You should remember that the <code>4096 bit</code> modulus will make DH computations slower and won’t actually improve security.</p></blockquote><p>There is <a href="https://security.stackexchange.com/questions/47204/dh-parameters-recommended-size/47207#47207" target="_blank" rel="noreferrer">good explanation</a> about DH parameters recommended size:</p><blockquote><p><em>Current recommendations from various bodies (including NIST) call for a <code>2048-bit</code> modulus for DH. Known DH-breaking algorithms would have a cost so ludicrously high that they could not be run to completion with known Earth-based technology. See this site for pointers on that subject.</em></p></blockquote><blockquote><p><em>You don&#39;t want to overdo the size because the computational usage cost rises relatively sharply with prime size (somewhere between quadratic and cubic, depending on some implementation details) but a <code>2048-bit</code> DH ought to be fine (a basic low-end PC can do several hundreds of <code>2048-bit</code> DH per second).</em></p></blockquote><p>Look also at this answer by <a href="https://www.hezmatt.org/~mpalmer/blog/" target="_blank" rel="noreferrer">Matt Palmer</a>:</p><blockquote><p><em>Indeed, characterising <code>2048 bit</code> DH parameters as &quot;weak as hell&quot; is quite misleading. There are no known feasible cryptographic attacks against arbitrary strong 2048 bit DH groups. To protect against future disclosure of a session key due to breaking DH, sure, you want your DH parameters to be as long as is practical, but since <code>1024 bit</code> DH is only just getting feasible, <code>2048 bits</code> should be OK for most purposes for a while yet.</em></p></blockquote><p><strong>My recommendation:</strong></p><blockquote><p>If you use only TLS 1.3 - <code>ssl_dhparam</code> is not required (not used). Also, if you use <code>ECDHE/ECDH</code> - <code>ssl_dhparam</code> is not required (not used). If you use <code>DHE/DH</code> - <code>ssl_dhparam</code> with DH parameters is required (min. <code>2048 bit</code>). By default no parameters are set, and therefore <code>DHE</code> ciphers will not be used.</p></blockquote><h4 id="example-11" tabindex="-1">Example <a class="header-anchor" href="#example-11" aria-label="Permalink to &quot;Example&quot;">​</a></h4><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## To generate a DH parameters:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dhparam</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nginx/ssl/dhparam_4096.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4096</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## To produce &quot;DSA-like&quot; DH parameters:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dhparam</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -dsaparam</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nginx/ssl/dhparam_4096.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4096</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Nginx configuration only for DH/DHE:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ssl_dhparam</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nginx/ssl/dhparams_4096.pem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>  ➡️ ssllabs score: <b>100%</b></p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## To generate a DH parameters:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dhparam</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nginx/ssl/dhparam_2048.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2048</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## To produce &quot;DSA-like&quot; DH parameters:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dhparam</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -dsaparam</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nginx/ssl/dhparam_2048.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2048</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Nginx configuration only for DH/DHE:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ssl_dhparam</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nginx/ssl/dhparam_2048.pem</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>  ➡️ ssllabs score: <b>90%</b></p><h4 id="external-resources-12" tabindex="-1">External resources <a class="header-anchor" href="#external-resources-12" aria-label="Permalink to &quot;External resources&quot;">​</a></h4><ul><li><a href="https://weakdh.org/" target="_blank" rel="noreferrer">Weak Diffie-Hellman and the Logjam Attack</a></li><li><a href="https://weakdh.org/sysadmin.html" target="_blank" rel="noreferrer">Guide to Deploying Diffie-Hellman for TLS</a></li><li><a href="https://wiki.mozilla.org/Security/Server_Side_TLS#ffdhe4096" target="_blank" rel="noreferrer">Pre-defined DHE groups</a></li><li><a href="https://security.stackexchange.com/questions/95178/diffie-hellman-parameters-still-calculating-after-24-hours/95184#95184" target="_blank" rel="noreferrer">Instructs OpenSSL to produce &quot;DSA-like&quot; DH parameters</a></li><li><a href="https://security.stackexchange.com/questions/44251/openssl-generate-different-types-of-self-signed-certificate" target="_blank" rel="noreferrer">OpenSSL generate different types of self signed certificate</a></li><li><a href="https://2ton.com.au/dhtool/" target="_blank" rel="noreferrer">Public Diffie-Hellman Parameter Service/Tool</a></li><li><a href="http://vincent.bernat.im/en/blog/2011-ssl-perfect-forward-secrecy.html" target="_blank" rel="noreferrer">Vincent Bernat&#39;s SSL/TLS &amp; Perfect Forward Secrecy</a></li><li><a href="https://securitypitfalls.wordpress.com/2014/10/06/rsa-and-ecdsa-performance/" target="_blank" rel="noreferrer">RSA and ECDSA performance</a></li><li><a href="https://technology.amis.nl/2017/07/04/ssltls-choose-cipher-suite/" target="_blank" rel="noreferrer">SSL/TLS: How to choose your cipher suite</a></li><li><a href="https://security.stackexchange.com/questions/41205/diffie-hellman-and-its-tls-ssl-usage" target="_blank" rel="noreferrer">Diffie-Hellman and its TLS/SSL usage</a></li></ul><h3 id="prevent-replay-attacks-on-zero-round-trip-time" tabindex="-1">🔰 Prevent Replay Attacks on Zero Round-Trip Time <a class="header-anchor" href="#prevent-replay-attacks-on-zero-round-trip-time" aria-label="Permalink to &quot;:beginner: Prevent Replay Attacks on Zero Round-Trip Time&quot;">​</a></h3><h4 id="rationale-14" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-14" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>This rules is only important for TLS 1.3. By default enabling TLS 1.3 will not enable 0-RTT support. After all, you should be fully aware of all the potential exposure factors and related risks with the use of this option.</p></blockquote><blockquote><p>0-RTT Handshakes is part of the replacement of TLS Session Resumption and was inspired by the QUIC Protocol.</p></blockquote><blockquote><p>0-RTT creates a significant security risk. With 0-RTT, a threat actor can intercept an encrypted client message and resend it to the server, tricking the server into improperly extending trust to the threat actor and thus potentially granting the threat actor access to sensitive data.</p></blockquote><blockquote><p>On the other hand, including 0-RTT (Zero Round Trip Time Resumption) results in a significant increase in efficiency and connection times. TLS 1.3 has a faster handshake that completes in 1-RTT. Additionally, it has a particular session resumption mode where, under certain conditions, it is possible to send data to the server on the first flight (0-RTT).</p></blockquote><blockquote><p>For example, Cloudflare only supports 0-RTT for <a href="https://new.blog.cloudflare.com/introducing-0-rtt/" target="_blank" rel="noreferrer">GET requests with no query parameters</a> in an attempt to limit the attack surface. Moreover, in order to improve identify connection resumption attempts, they relay this information to the origin by adding an extra header to 0-RTT requests. This header uniquely identifies the request, so if one gets repeated, the origin will know it&#39;s a replay attack (the application needs to track values received from that and reject duplicates on non-idempotent endpoints).</p></blockquote><blockquote><p>To protect against such attacks at the application layer, the <code>$ssl_early_data</code> variable should be used. You&#39;ll also need to ensure that the <code>Early-Data</code> header is passed to your application. <code>$ssl_early_data</code> returns 1 if TLS 1.3 early data is used and the handshake is not complete.</p></blockquote><blockquote><p>However, as part of the upgrade, you should disable 0-RTT until you can audit your application for this class of vulnerability.</p></blockquote><blockquote><p>In order to send early-data, client and server <a href="https://tools.ietf.org/html/rfc8446#section-2.3" target="_blank" rel="noreferrer">must support PSK exchange mode</a> (session cookies).</p></blockquote><blockquote><p>In addition, I would like to recommend <a href="https://news.ycombinator.com/item?id=16667036" target="_blank" rel="noreferrer">this</a> great discussion about TLS 1.3 and 0-RTT.</p></blockquote><p>If you are unsure to enable 0-RTT, look what Cloudflare say about it:</p><blockquote><p><em>Generally speaking, 0-RTT is safe for most web sites and applications. If your web application does strange things and you’re concerned about its replay safety, consider not using 0-RTT until you can be certain that there are no negative effects. [...] TLS 1.3 is a big step forward for web performance and security. By combining TLS 1.3 with 0-RTT, the performance gains are even more dramatic.</em></p></blockquote><h4 id="example-12" tabindex="-1">Example <a class="header-anchor" href="#example-12" aria-label="Permalink to &quot;Example&quot;">​</a></h4><p>Test 0-RTT with OpenSSL:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## 1)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">_host</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;example.com&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> req.in</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> __EOF__</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">HEAD / HTTP/1.1</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Host: </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$_host</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Connection: close</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">__EOF__</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## or:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## echo -e &quot;GET / HTTP/1.1\r\nHost: $_host\r\nConnection: close\r\n\r\n&quot; &gt; req.in</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> s_client</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -connect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${_host}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:443</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -tls1_3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sess_out</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> session.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -ign_eof</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> req.in</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> s_client</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -connect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ${_host}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">:443</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -tls1_3</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -sess_in</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> session.pem</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -early_data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> req.in</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## 2)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -m</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sslyze</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --early_data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$_host</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span></code></pre></div><p>Enable 0-RTT with <code>$ssl_early_data</code> variable:</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ssl_protocols </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  TLSv1.2 TLSv1.3;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ## To enable 0-RTT (TLS 1.3):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  ssl_early_data </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      http://backend_x20;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ## It protect against such attacks at the application layer:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Early-Data $ssl_early_data;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="external-resources-13" tabindex="-1">External resources <a class="header-anchor" href="#external-resources-13" aria-label="Permalink to &quot;External resources&quot;">​</a></h4><ul><li><a href="https://github.com/tlswg/tls13-spec/issues/1001" target="_blank" rel="noreferrer">Security Review of TLS1.3 0-RTT</a></li><li><a href="https://new.blog.cloudflare.com/introducing-0-rtt/" target="_blank" rel="noreferrer">Introducing Zero Round Trip Time Resumption (0-RTT)</a></li><li><a href="https://blog.trailofbits.com/2019/03/25/what-application-developers-need-to-know-about-tls-early-data-0rtt/" target="_blank" rel="noreferrer">What Application Developers Need To Know About TLS Early Data (0RTT)</a></li><li><a href="https://eprint.iacr.org/2017/082.pdf" target="_blank" rel="noreferrer">Replay Attacks on Zero Round-Trip Time: The Case of the TLS 1.3 Handshake Candidates</a></li><li><a href="https://tools.ietf.org/html/rfc8446#section-8" target="_blank" rel="noreferrer">0-RTT and Anti-Replay</a></li><li><a href="https://tools.ietf.org/id/draft-thomson-http-replay-00.html_" target="_blank" rel="noreferrer">Using Early Data in HTTP (2017)</a></li><li><a href="https://tools.ietf.org/html/draft-ietf-httpbis-replay-04" target="_blank" rel="noreferrer">Using Early Data in HTTP (2018)</a></li><li><a href="https://ldapwiki.com/wiki/0-RTT%20Handshakes" target="_blank" rel="noreferrer">0-RTT Handshakes</a></li></ul><h3 id="defend-against-the-beast-attack" tabindex="-1">🔰 Defend against the BEAST attack <a class="header-anchor" href="#defend-against-the-beast-attack" aria-label="Permalink to &quot;:beginner: Defend against the BEAST attack&quot;">​</a></h3><h4 id="rationale-15" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-15" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>Generally the BEAST attack relies on a weakness in the way <code>CBC</code> mode is used in SSL/TLS.</p></blockquote><blockquote><p>More specifically, to successfully perform the BEAST attack, there are some conditions which needs to be met:</p><ul><li>vulnerable version of SSL must be used using a block cipher (<code>CBC</code> in particular)</li><li>JavaScript or a Java applet injection - should be in the same origin of the web site</li><li>data sniffing of the network connection must be possible</li></ul></blockquote><blockquote><p>To prevent possible use BEAST attacks you should enable server-side protection, which causes the server ciphers should be preferred over the client ciphers, and completely excluded TLS 1.0 from your protocol stack.</p></blockquote><h4 id="example-13" tabindex="-1">Example <a class="header-anchor" href="#example-13" aria-label="Permalink to &quot;Example&quot;">​</a></h4><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ssl_prefer_server_ciphers </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h4 id="external-resources-14" tabindex="-1">External resources <a class="header-anchor" href="#external-resources-14" aria-label="Permalink to &quot;External resources&quot;">​</a></h4><ul><li><a href="https://commandlinefanatic.com/cgi-bin/showarticle.cgi?article=art027" target="_blank" rel="noreferrer">An Illustrated Guide to the BEAST Attack</a></li><li><a href="https://blog.ivanristic.com/2013/09/is-beast-still-a-threat.html" target="_blank" rel="noreferrer">Is BEAST still a threat?</a></li><li><a href="https://blogs.cisco.com/security/beat-the-beast-with-tls" target="_blank" rel="noreferrer">Beat the BEAST with TLS 1.1/1.2 and More</a></li><li><a href="#beginner-use-only-strong-ciphers">Use only strong ciphers (from this handbook)</a></li></ul><h3 id="mitigation-of-crime-breach-attacks" tabindex="-1">🔰 Mitigation of CRIME/BREACH attacks <a class="header-anchor" href="#mitigation-of-crime-breach-attacks" aria-label="Permalink to &quot;:beginner: Mitigation of CRIME/BREACH attacks&quot;">​</a></h3><h4 id="rationale-16" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-16" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>Disable HTTP compression or compress only zero sensitive content.</p></blockquote><blockquote><p>You should probably never use TLS compression. Some user agents (at least Chrome) will disable it anyways. Disabling SSL/TLS compression stops the attack very effectively. A deployment of HTTP/2 over TLS 1.2 must disable TLS compression (please see <a href="https://tools.ietf.org/html/rfc7540#section-9.2" target="_blank" rel="noreferrer">RFC 7540: 9.2. Use of TLS Features</a>).</p></blockquote><blockquote><p>CRIME exploits SSL/TLS compression which is disabled since nginx 1.3.2. BREACH exploits HTTP compression</p></blockquote><blockquote><p>Some attacks are possible (e.g. the real BREACH attack is a complicated) because of gzip (HTTP compression not TLS compression) being enabled on SSL requests. In most cases, the best action is to simply disable gzip for SSL.</p></blockquote><blockquote><p>Compression is not the only requirement for the attack to be done so using it does not mean that the attack will succeed. Generally you should consider whether having an accidental performance drop on HTTPS sites is better than HTTPS sites being accidentally vulnerable.</p></blockquote><blockquote><p>You shouldn&#39;t use HTTP compression on private responses when using TLS.</p></blockquote><blockquote><p>I would gonna to prioritise security over performance but compression can be (I think) okay to HTTP compress publicly available static content like css or js and HTML content with zero sensitive info (like an &quot;About Us&quot; page).</p></blockquote><blockquote><p>Remember: by default, Nginx doesn&#39;t compress image files using its per-request gzip module.</p></blockquote><blockquote><p>Gzip static module is better, for 2 reasons:</p><ul><li>you don&#39;t have to gzip for each request</li><li>you can use a higher gzip level</li></ul></blockquote><blockquote><p>You should put the <code>gzip_static on;</code> inside the blocks that configure static files, but if you’re only running one site, it’s safe to just put it in the http block.</p></blockquote><h4 id="example-14" tabindex="-1">Example <a class="header-anchor" href="#example-14" aria-label="Permalink to &quot;Example&quot;">​</a></h4><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Disable dynamic HTTP compression:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">gzip </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">off</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Enable dynamic HTTP compression for specific location context:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  gzip </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Enable static gzip compression:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ^~</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> /assets/ </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  gzip_static </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="external-resources-15" tabindex="-1">External resources <a class="header-anchor" href="#external-resources-15" aria-label="Permalink to &quot;External resources&quot;">​</a></h4><ul><li><a href="https://security.stackexchange.com/questions/20406/is-http-compression-safe" target="_blank" rel="noreferrer">Is HTTP compression safe?</a></li><li><a href="https://www.pcworld.com/article/3051675/http-compression-continues-to-put-encrypted-communications-at-risk.html" target="_blank" rel="noreferrer">HTTP compression continues to put encrypted communications at risk</a></li><li><a href="http://niiconsulting.com/checkmate/2013/12/ssltls-attacks-part-2-crime-attack/" target="_blank" rel="noreferrer">SSL/TLS attacks: Part 2 – CRIME Attack</a></li><li><a href="https://blog.qualys.com/ssllabs/2013/08/07/defending-against-the-breach-attack" target="_blank" rel="noreferrer">Defending against the BREACH Attack</a></li><li><a href="https://security.stackexchange.com/questions/172581/to-avoid-breach-can-we-use-gzip-on-non-token-responses" target="_blank" rel="noreferrer">To avoid BREACH, can we use gzip on non-token responses?</a></li><li><a href="https://blog.ircmaxell.com/2013/08/dont-worry-about-breach.html" target="_blank" rel="noreferrer">Don&#39;t Worry About BREACH</a></li><li><a href="http://nginx.org/en/docs/http/ngx_http_gzip_static_module.html" target="_blank" rel="noreferrer">Module ngx_http_gzip_static_module</a></li><li><a href="https://theartofmachinery.com/2016/06/06/nginx_gzip_static.html" target="_blank" rel="noreferrer">Offline Compression with Nginx</a></li></ul><h3 id="http-strict-transport-security" tabindex="-1">🔰 HTTP Strict Transport Security <a class="header-anchor" href="#http-strict-transport-security" aria-label="Permalink to &quot;:beginner: HTTP Strict Transport Security&quot;">​</a></h3><h4 id="rationale-17" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-17" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>Generally HSTS is a way for websites to tell browsers that the connection should only ever be encrypted. This prevents MITM attacks, downgrade attacks, sending plain text cookies and session ids.</p></blockquote><blockquote><p>The header indicates for how long a browser should unconditionally refuse to take part in unsecured HTTP connection for a specific domain.</p></blockquote><blockquote><p>When a browser knows that a domain has enabled HSTS, it does two things:</p><ul><li>always uses an <code>https://</code> connection, even when clicking on an <code>http://</code> link or after typing a domain into the location bar without specifying a protocol</li><li>removes the ability for users to click through warnings about invalid certificates</li></ul></blockquote><blockquote><p>I recommend to set the <code>max-age</code> to a big value like <code>31536000</code> (12 months) or <code>63072000</code> (24 months).</p></blockquote><blockquote><p>There are a few simple best practices for HSTS (from <a href="https://blog.qualys.com/securitylabs/2016/03/28/the-importance-of-a-proper-http-strict-transport-security-implementation-on-your-web-server" target="_blank" rel="noreferrer"> The Importance of a Proper HTTP Strict Transport Security Implementation on Your Web Server</a>):</p><ul><li><p>The strongest protection is to ensure that all requested resources use only TLS with a well-formed HSTS header. Qualys recommends providing an HSTS header on all HTTPS resources in the target domain</p></li><li><p>It is advisable to assign the max-age directive’s value to be greater than <code>10368000</code> seconds (120 days) and ideally to <code>31536000</code> (one year). Websites should aim to ramp up the max-age value to ensure heightened security for a long duration for the current domain and/or subdomains</p></li><li><p><a href="https://tools.ietf.org/html/rfc6797" target="_blank" rel="noreferrer">RFC 6797</a>, section 14.4 advocates that a web application must aim to add the <code>includeSubDomain</code> directive in the policy definition whenever possible. The directive’s presence ensures the HSTS policy is applied to the domain of the issuing host and all of its subdomains, e.g. <code>example.com</code> and <code>www.example.com</code></p></li><li><p>The application should never send an HSTS header over a plaintext HTTP header, as doing so makes the connection vulnerable to SSL stripping attacks</p></li><li><p>It is not recommended to provide an HSTS policy via the http-equiv attribute of a meta tag. According to HSTS RFC 6797, user agents don’t heed <code>http-equiv=&quot;Strict-Transport-Security&quot;</code> attribute on <code>&lt;meta&gt;</code> elements on the received content`</p></li></ul></blockquote><blockquote><p>To meet the HSTS preload list standard a root domain needs to return a <code>strict-transport-security</code> header that includes both the <code>includeSubDomains</code> and <code>preload</code> directives and has a minimum <code>max-age</code> of one year. Your site must also serve a valid SSL certificate on the root domain and all subdomains, as well as redirect all HTTP requests to HTTPS on the same host.</p></blockquote><blockquote><p>You had better be pretty sure that your website is indeed all HTTPS before you turn this on because HSTS adds complexity to your rollback strategy. Google recommend enabling HSTS this way:</p><ol><li>Roll out your HTTPS pages without HSTS first</li><li>Start sending HSTS headers with a short <code>max-age</code>. Monitor your traffic both from users and other clients, and also dependents&#39; performance, such as ads</li><li>Slowly increase the HSTS <code>max-age</code></li><li>If HSTS doesn&#39;t affect your users and search engines negatively, you can, if you wish, ask your site to be added to the HSTS preload list used by most major browsers</li></ol></blockquote><h4 id="example-15" tabindex="-1">Example <a class="header-anchor" href="#example-15" aria-label="Permalink to &quot;Example&quot;">​</a></h4><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Strict-Transport-Security </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;max-age=63072000; includeSubdomains&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> always;</span></span></code></pre></div><p>  ➡️ ssllabs score: <b>A+</b></p><h4 id="external-resources-16" tabindex="-1">External resources <a class="header-anchor" href="#external-resources-16" aria-label="Permalink to &quot;External resources&quot;">​</a></h4><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Strict-Transport-Security" target="_blank" rel="noreferrer">Strict-Transport-Security</a></li><li><a href="https://zinoui.com/blog/security-http-headers#strict-transport-security" target="_blank" rel="noreferrer">Security HTTP Headers - Strict-Transport-Security</a></li><li><a href="https://https.cio.gov/hsts/" target="_blank" rel="noreferrer">HTTP Strict Transport Security</a></li><li><a href="https://www.owasp.org/index.php/HTTP_Strict_Transport_Security_Cheat_Sheet" target="_blank" rel="noreferrer">HTTP Strict Transport Security Cheat Sheet</a></li><li><a href="https://scotthelme.co.uk/hsts-cheat-sheet/" target="_blank" rel="noreferrer">HSTS Cheat Sheet</a></li><li><a href="https://textslashplain.com/2018/04/09/hsts-preload-and-subdomains/" target="_blank" rel="noreferrer">HSTS Preload and Subdomains</a></li><li><a href="https://www.nginx.com/blog/http-strict-transport-security-hsts-and-nginx/" target="_blank" rel="noreferrer">HTTP Strict Transport Security (HSTS) and Nginx</a></li><li><a href="https://www.reddit.com/r/bigseo/comments/8zw45d/is_hsts_as_a_proper_substitute_for_httptohttps/" target="_blank" rel="noreferrer">Is HSTS as a proper substitute for HTTP-to-HTTPS redirects?</a></li><li><a href="https://www.danielmorell.com/blog/how-to-configure-hsts-on-www-and-other-subdomains" target="_blank" rel="noreferrer">How to configure HSTS on www and other subdomains</a></li><li><a href="https://serverfault.com/questions/927336/hsts-is-includesubdomains-on-main-domain-sufficient" target="_blank" rel="noreferrer">HSTS: Is includeSubDomains on main domain sufficient?</a></li><li><a href="https://www.danielmorell.com/blog/how-to-configure-hsts-on-www-and-other-subdomains" target="_blank" rel="noreferrer">The HSTS preload list eligibility</a></li><li><a href="https://hstspreload.org/" target="_blank" rel="noreferrer">Check HSTS preload status and eligibility</a></li><li><a href="https://hstspreload.org/#deployment-recommendations" target="_blank" rel="noreferrer">HSTS Deployment Recommendations</a></li><li><a href="https://serverfault.com/questions/927145/how-does-hsts-handle-mixed-content" target="_blank" rel="noreferrer">How does HSTS handle mixed content?</a></li></ul><h3 id="reduce-xss-risks-content-security-policy" tabindex="-1">🔰 Reduce XSS risks (Content-Security-Policy) <a class="header-anchor" href="#reduce-xss-risks-content-security-policy" aria-label="Permalink to &quot;:beginner: Reduce XSS risks (Content-Security-Policy)&quot;">​</a></h3><h4 id="rationale-18" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-18" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>CSP reduce the risk and impact of XSS attacks in modern browsers.</p></blockquote><blockquote><p>Whitelisting known-good resource origins, refusing to execute potentially dangerous inline scripts, and banning the use of eval are all effective mechanisms for mitigating cross-site scripting attacks.</p></blockquote><blockquote><p>The inclusion of CSP policies significantly impedes successful XSS attacks, UI Redressing (Clickjacking), malicious use of frames or CSS injections.</p></blockquote><blockquote><p>CSP is a good defence-in-depth measure to make exploitation of an accidental lapse in that less likely.</p></blockquote><blockquote><p>The default policy that starts building a header is: block everything. By modifying the CSP value, the programmer loosens restrictions for specific groups of resources (e.g. separately for scripts, images, etc.).</p></blockquote><blockquote><p>Before enable this header you should discuss with developers about it. They probably going to have to update your application to remove any inline script and style, and make some additional modifications there.</p></blockquote><blockquote><p>Strict policies will significantly increase security, and higher code quality will reduce the overall number of errors. CSP can never replace secure code - new restrictions help reduce the effects of attacks (such as XSS), but they are not mechanisms to prevent them!</p></blockquote><blockquote><p>You should always validate CSP before implement: <a href="https://csp-evaluator.withgoogle.com/" target="_blank" rel="noreferrer">CSP Evaluator</a> and <a href="https://cspvalidator.org/" target="_blank" rel="noreferrer">Content Security Policy (CSP) Validator</a>.</p></blockquote><blockquote><p>For generate a policy: <a href="https://report-uri.com/home/generate" target="_blank" rel="noreferrer">https://report-uri.com/home/generate</a>. Remember, however, that these types of tools may become outdated or have errors.</p></blockquote><h4 id="example-16" tabindex="-1">Example <a class="header-anchor" href="#example-16" aria-label="Permalink to &quot;Example&quot;">​</a></h4><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## This policy allows images, scripts, AJAX, and CSS from the same origin, and does not allow any other resources to load:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Content-Security-Policy </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;default-src &#39;none&#39;; script-src &#39;self&#39;; connect-src &#39;self&#39;; img-src &#39;self&#39;; style-src &#39;self&#39;;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> always;</span></span></code></pre></div><h4 id="external-resources-17" tabindex="-1">External resources <a class="header-anchor" href="#external-resources-17" aria-label="Permalink to &quot;External resources&quot;">​</a></h4><ul><li><a href="https://content-security-policy.com/" target="_blank" rel="noreferrer">Content Security Policy (CSP) Quick Reference Guide</a></li><li><a href="https://www.owasp.org/index.php/Content_Security_Policy_Cheat_Sheet" target="_blank" rel="noreferrer">Content Security Policy Cheat Sheet – OWASP</a></li><li><a href="https://www.owasp.org/index.php/Content_Security_Policy" target="_blank" rel="noreferrer">Content Security Policy – OWASP</a></li><li><a href="https://scotthelme.co.uk/content-security-policy-an-introduction/" target="_blank" rel="noreferrer">Content Security Policy - An Introduction - Scott Helme</a></li><li><a href="https://scotthelme.co.uk/csp-cheat-sheet/" target="_blank" rel="noreferrer">CSP Cheat Sheet - Scott Helme</a></li><li><a href="https://zinoui.com/blog/security-http-headers#content-security-policy" target="_blank" rel="noreferrer">Security HTTP Headers - Content-Security-Policy</a></li><li><a href="https://csp-evaluator.withgoogle.com/" target="_blank" rel="noreferrer">CSP Evaluator</a></li><li><a href="https://cspvalidator.org/" target="_blank" rel="noreferrer">Content Security Policy (CSP) Validator</a></li><li><a href="https://caniuse.com/#search=CSP" target="_blank" rel="noreferrer">Can I Use CSP</a></li><li><a href="https://ai.google/research/pubs/pub45542" target="_blank" rel="noreferrer">CSP Is Dead, Long Live CSP!</a></li></ul><h3 id="control-the-behaviour-of-the-referer-header-referrer-policy" tabindex="-1">🔰 Control the behaviour of the Referer header (Referrer-Policy) <a class="header-anchor" href="#control-the-behaviour-of-the-referer-header-referrer-policy" aria-label="Permalink to &quot;:beginner: Control the behaviour of the Referer header (Referrer-Policy)&quot;">​</a></h3><h4 id="rationale-19" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-19" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>Determine what information is sent along with the requests.</p></blockquote><h4 id="example-17" tabindex="-1">Example <a class="header-anchor" href="#example-17" aria-label="Permalink to &quot;Example&quot;">​</a></h4><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Referrer-Policy </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;no-referrer&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h4 id="external-resources-18" tabindex="-1">External resources <a class="header-anchor" href="#external-resources-18" aria-label="Permalink to &quot;External resources&quot;">​</a></h4><ul><li><a href="https://scotthelme.co.uk/a-new-security-header-referrer-policy/" target="_blank" rel="noreferrer">A new security header: Referrer Policy</a></li><li><a href="https://zinoui.com/blog/security-http-headers#referrer-policy" target="_blank" rel="noreferrer">Security HTTP Headers - Referrer-Policy</a></li></ul><h3 id="provide-clickjacking-protection-x-frame-options" tabindex="-1">🔰 Provide clickjacking protection (X-Frame-Options) <a class="header-anchor" href="#provide-clickjacking-protection-x-frame-options" aria-label="Permalink to &quot;:beginner: Provide clickjacking protection (X-Frame-Options)&quot;">​</a></h3><h4 id="rationale-20" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-20" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>Helps to protect your visitors against clickjacking attacks. It is recommended that you use the <code>x-frame-options</code> header on pages which should not be allowed to render a page in a frame.</p></blockquote><h4 id="example-18" tabindex="-1">Example <a class="header-anchor" href="#example-18" aria-label="Permalink to &quot;Example&quot;">​</a></h4><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X-Frame-Options </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;SAMEORIGIN&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> always;</span></span></code></pre></div><h4 id="external-resources-19" tabindex="-1">External resources <a class="header-anchor" href="#external-resources-19" aria-label="Permalink to &quot;External resources&quot;">​</a></h4><ul><li><a href="https://tools.ietf.org/html/rfc7034" target="_blank" rel="noreferrer">HTTP Header Field X-Frame-Options</a></li><li><a href="https://www.owasp.org/index.php/Clickjacking_Defense_Cheat_Sheet" target="_blank" rel="noreferrer">Clickjacking Defense Cheat Sheet</a></li><li><a href="https://zinoui.com/blog/security-http-headers#x-frame-options" target="_blank" rel="noreferrer">Security HTTP Headers - X-Frame-Options</a></li><li><a href="https://scotthelme.co.uk/hardening-your-http-response-headers/#x-frame-options" target="_blank" rel="noreferrer">X-Frame-Options - Scott Helme</a></li></ul><h3 id="prevent-some-categories-of-xss-attacks-x-xss-protection" tabindex="-1">🔰 Prevent some categories of XSS attacks (X-XSS-Protection) <a class="header-anchor" href="#prevent-some-categories-of-xss-attacks-x-xss-protection" aria-label="Permalink to &quot;:beginner: Prevent some categories of XSS attacks (X-XSS-Protection)&quot;">​</a></h3><h4 id="rationale-21" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-21" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>Enable the cross-site scripting (XSS) filter built into modern web browsers.</p></blockquote><h4 id="example-19" tabindex="-1">Example <a class="header-anchor" href="#example-19" aria-label="Permalink to &quot;Example&quot;">​</a></h4><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X-XSS-Protection </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;1; mode=block&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> always;</span></span></code></pre></div><h4 id="external-resources-20" tabindex="-1">External resources <a class="header-anchor" href="#external-resources-20" aria-label="Permalink to &quot;External resources&quot;">​</a></h4><ul><li><a href="https://www.owasp.org/index.php/XSS_(Cross_Site_Scripting)_Prevention_Cheat_Sheet" target="_blank" rel="noreferrer">XSS (Cross Site Scripting) Prevention Cheat Sheet</a></li><li><a href="https://www.owasp.org/index.php/DOM_based_XSS_Prevention_Cheat_Sheet" target="_blank" rel="noreferrer">DOM based XSS Prevention Cheat Sheet</a></li><li><a href="https://www.tunetheweb.com/security/http-security-headers/x-xss-protection/" target="_blank" rel="noreferrer">X-XSS-Protection HTTP Header</a></li><li><a href="https://zinoui.com/blog/security-http-headers#x-xss-protection" target="_blank" rel="noreferrer">Security HTTP Headers - X-XSS-Protection</a></li></ul><h3 id="prevent-sniff-mimetype-middleware-x-content-type-options" tabindex="-1">🔰 Prevent Sniff Mimetype middleware (X-Content-Type-Options) <a class="header-anchor" href="#prevent-sniff-mimetype-middleware-x-content-type-options" aria-label="Permalink to &quot;:beginner: Prevent Sniff Mimetype middleware (X-Content-Type-Options)&quot;">​</a></h3><h4 id="rationale-22" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-22" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>It prevents the browser from doing MIME-type sniffing (prevents &quot;mime&quot; based attacks).</p></blockquote><h4 id="example-20" tabindex="-1">Example <a class="header-anchor" href="#example-20" aria-label="Permalink to &quot;Example&quot;">​</a></h4><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X-Content-Type-Options </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;nosniff&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> always;</span></span></code></pre></div><h4 id="external-resources-21" tabindex="-1">External resources <a class="header-anchor" href="#external-resources-21" aria-label="Permalink to &quot;External resources&quot;">​</a></h4><ul><li><a href="https://www.keycdn.com/support/x-content-type-options" target="_blank" rel="noreferrer">X-Content-Type-Options HTTP Header</a></li><li><a href="https://zinoui.com/blog/security-http-headers#x-content-type-options" target="_blank" rel="noreferrer">Security HTTP Headers - X-Content-Type-Options</a></li><li><a href="https://scotthelme.co.uk/hardening-your-http-response-headers/#x-content-type-options" target="_blank" rel="noreferrer">X-Content-Type-Options - Scott Helme</a></li></ul><h3 id="deny-the-use-of-browser-features-feature-policy" tabindex="-1">🔰 Deny the use of browser features (Feature-Policy) <a class="header-anchor" href="#deny-the-use-of-browser-features-feature-policy" aria-label="Permalink to &quot;:beginner: Deny the use of browser features (Feature-Policy)&quot;">​</a></h3><h4 id="rationale-23" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-23" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>This header protects your site from third parties using APIs that have security and privacy implications, and also from your own team adding outdated APIs or poorly optimised images.</p></blockquote><h4 id="example-21" tabindex="-1">Example <a class="header-anchor" href="#example-21" aria-label="Permalink to &quot;Example&quot;">​</a></h4><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Feature-Policy </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;geolocation &#39;none&#39;; midi &#39;none&#39;; notifications &#39;none&#39;; push &#39;none&#39;; sync-xhr &#39;none&#39;; microphone &#39;none&#39;; camera &#39;none&#39;; magnetometer &#39;none&#39;; gyroscope &#39;none&#39;; speaker &#39;none&#39;; vibrate &#39;none&#39;; fullscreen &#39;none&#39;; payment &#39;none&#39;; usb &#39;none&#39;;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h4 id="external-resources-22" tabindex="-1">External resources <a class="header-anchor" href="#external-resources-22" aria-label="Permalink to &quot;External resources&quot;">​</a></h4><ul><li><a href="https://docs.google.com/document/d/1k0Ua-ZWlM_PsFCFdLMa8kaVTo32PeNZ4G7FFHqpFx4E/edit" target="_blank" rel="noreferrer">Feature Policy Explainer</a></li><li><a href="https://github.com/w3c/webappsec-feature-policy/blob/master/features.md" target="_blank" rel="noreferrer">Policy Controlled Features</a></li><li><a href="https://zinoui.com/blog/security-http-headers#feature-policy" target="_blank" rel="noreferrer">Security HTTP Headers - Feature-Policy</a></li></ul><h3 id="reject-unsafe-http-methods" tabindex="-1">🔰 Reject unsafe HTTP methods <a class="header-anchor" href="#reject-unsafe-http-methods" aria-label="Permalink to &quot;:beginner: Reject unsafe HTTP methods&quot;">​</a></h3><h4 id="rationale-24" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-24" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>Set of methods support by a resource. An ordinary web server supports the <code>HEAD</code>, <code>GET</code> and <code>POST</code> methods to retrieve static and dynamic content. Other (e.g. <code>OPTIONS</code>, <code>TRACE</code>) methods should not be supported on public web servers, as they increase the attack surface.</p></blockquote><h4 id="example-22" tabindex="-1">Example <a class="header-anchor" href="#example-22" aria-label="Permalink to &quot;Example&quot;">​</a></h4><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Allow </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;GET, POST, HEAD&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> always;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ($request_method </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!~ </span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">^(GET|POST|HEAD)$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 405</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="external-resources-23" tabindex="-1">External resources <a class="header-anchor" href="#external-resources-23" aria-label="Permalink to &quot;External resources&quot;">​</a></h4><ul><li><a href="https://www.onwebsecurity.com/security/unsafe-http-methods.html" target="_blank" rel="noreferrer">Vulnerability name: Unsafe HTTP methods</a></li></ul><h3 id="prevent-caching-of-sensitive-data" tabindex="-1">🔰 Prevent caching of sensitive data <a class="header-anchor" href="#prevent-caching-of-sensitive-data" aria-label="Permalink to &quot;:beginner: Prevent caching of sensitive data&quot;">​</a></h3><h4 id="rationale-25" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-25" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>This policy should be implemented by the application architect, however, I know from experience that this does not always happen.</p></blockquote><blockquote><p>Don&#39; to cache or persist sensitive data. As browsers have different default behaviour for caching HTTPS content, pages containing sensitive information should include a <code>Cache-Control</code> header to ensure that the contents are not cached.</p></blockquote><blockquote><p>One option is to add anticaching headers to relevant HTTP/1.1 and HTTP/2 responses, e.g. <code>Cache-Control: no-cache, no-store</code> and <code>Expires: 0</code>.</p></blockquote><blockquote><p>To cover various browser implementations the full set of headers to prevent content being cached should be:</p><p><code>Cache-Control: no-cache, no-store, private, must-revalidate, max-age=0, no-transform</code> &gt; <code>Pragma: no-cache</code> &gt; <code>Expires: 0</code></p></blockquote><h4 id="example-23" tabindex="-1">Example <a class="header-anchor" href="#example-23" aria-label="Permalink to &quot;Example&quot;">​</a></h4><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /api </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  expires </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  add_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Cache-Control </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;no-cache, no-store&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="external-resources-24" tabindex="-1">External resources <a class="header-anchor" href="#external-resources-24" aria-label="Permalink to &quot;External resources&quot;">​</a></h4><ul><li><a href="https://tools.ietf.org/html/rfc2616" target="_blank" rel="noreferrer">RFC 2616 - Hypertext Transfer Protocol (HTTP/1.1): Standards Track</a></li><li><a href="https://tools.ietf.org/html/rfc7234" target="_blank" rel="noreferrer">RFC 7234 - Hypertext Transfer Protocol (HTTP/1.1): Caching</a></li><li><a href="https://www.keycdn.com/blog/http-cache-headers" target="_blank" rel="noreferrer">HTTP Cache Headers - A Complete Guide</a></li><li><a href="https://jakearchibald.com/2016/caching-best-practices/" target="_blank" rel="noreferrer">Caching best practices &amp; max-age gotchas</a></li><li><a href="https://devcenter.heroku.com/articles/increasing-application-performance-with-http-cache-headers" target="_blank" rel="noreferrer">Increasing Application Performance with HTTP Cache Headers</a></li><li><a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/http-caching" target="_blank" rel="noreferrer">HTTP Caching</a></li></ul><h3 id="control-buffer-overflow-attacks" tabindex="-1">🔰 Control Buffer Overflow attacks <a class="header-anchor" href="#control-buffer-overflow-attacks" aria-label="Permalink to &quot;:beginner: Control Buffer Overflow attacks&quot;">​</a></h3><h4 id="rationale-26" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-26" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>Buffer overflow attacks are made possible by writing data to a buffer and exceeding that buffers’ boundary and overwriting memory fragments of a process. To prevent this in Nginx we can set buffer size limitations for all clients.</p></blockquote><h4 id="example-24" tabindex="-1">Example <a class="header-anchor" href="#example-24" aria-label="Permalink to &quot;Example&quot;">​</a></h4><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">client_body_buffer_size </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100k</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">client_header_buffer_size </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1k</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">client_max_body_size </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">100k</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">large_client_header_buffers </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1k</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h4 id="external-resources-25" tabindex="-1">External resources <a class="header-anchor" href="#external-resources-25" aria-label="Permalink to &quot;External resources&quot;">​</a></h4><ul><li><a href="https://www.owasp.org/index.php/SCG_WS_nginx" target="_blank" rel="noreferrer">SCG WS nginx</a></li></ul><h3 id="mitigating-slow-http-dos-attacks-closing-slow-connections" tabindex="-1">🔰 Mitigating Slow HTTP DoS attacks (Closing Slow Connections) <a class="header-anchor" href="#mitigating-slow-http-dos-attacks-closing-slow-connections" aria-label="Permalink to &quot;:beginner: Mitigating Slow HTTP DoS attacks (Closing Slow Connections)&quot;">​</a></h3><h4 id="rationale-27" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-27" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>Close connections that are writing data too infrequently, which can represent an attempt to keep connections open as long as possible.</p></blockquote><blockquote><p>You can close connections that are writing data too infrequently, which can represent an attempt to keep connections open as long as possible (thus reducing the server’s ability to accept new connections).</p></blockquote><h4 id="example-25" tabindex="-1">Example <a class="header-anchor" href="#example-25" aria-label="Permalink to &quot;Example&quot;">​</a></h4><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">client_body_timeout </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">client_header_timeout </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">keepalive_timeout </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5s</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">send_timeout </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10s</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h4 id="external-resources-26" tabindex="-1">External resources <a class="header-anchor" href="#external-resources-26" aria-label="Permalink to &quot;External resources&quot;">​</a></h4><ul><li><a href="https://www.nginx.com/blog/mitigating-ddos-attacks-with-nginx-and-nginx-plus/" target="_blank" rel="noreferrer">Mitigating DDoS Attacks with Nginx and Nginx Plus</a></li><li><a href="https://www.owasp.org/index.php/SCG_WS_nginx" target="_blank" rel="noreferrer">SCG WS nginx</a></li><li><a href="https://blog.qualys.com/securitylabs/2011/11/02/how-to-protect-against-slow-http-attacks" target="_blank" rel="noreferrer">How to Protect Against Slow HTTP Attacks</a></li><li><a href="https://ma.ttias.be/effectively-using-detecting-the-slowloris-http-dos-tool/" target="_blank" rel="noreferrer">Effectively Using and Detecting The Slowloris HTTP DoS Tool</a></li></ul><h2 id="反向代理" tabindex="-1">反向代理 <a class="header-anchor" href="#反向代理" aria-label="Permalink to &quot;反向代理&quot;">​</a></h2><h3 id="使用与后端协议兼容的-pass-指令" tabindex="-1">使用与后端协议兼容的 pass 指令 <a class="header-anchor" href="#使用与后端协议兼容的-pass-指令" aria-label="Permalink to &quot;使用与后端协议兼容的 pass 指令&quot;">​</a></h3><blockquote><p>All <code>proxy_*</code> directives are related to the backends that use the specific backend protocol.</p></blockquote><blockquote><p>You should use <code>proxy_pass</code> only for HTTP servers working on the backend layer (set also the <code>http://</code> protocol before referencing the HTTP backend) and other <code>*_pass</code> directives only for non-HTTP backend servers (like a uWSGI or FastCGI).</p></blockquote><blockquote><p>Directives such as <code>uwsgi_pass</code>, <code>fastcgi_pass</code>, or <code>scgi_pass</code> are designed specifically for non-HTTP apps and you should use them instead of the <code>proxy_pass</code> (non-HTTP talking).</p></blockquote><blockquote><p>For example: <code>uwsgi_pass</code> uses an uwsgi protocol. <code>proxy_pass</code> uses normal HTTP to talking with uWSGI server. uWSGI docs claims that uwsgi protocol is better, faster and can benefit from all of uWSGI special features. You can send to uWSGI information what type of data you are sending and what uWSGI plugin should be invoked to generate response. With http (<code>proxy_pass</code>) you won&#39;t get that.</p></blockquote><p>示例：</p><p>❌ 错误配置</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /app/ </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    ## For this, you should use uwsgi_pass directive.</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     192.168.154.102:4000;         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## backend layer: uWSGI Python app.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>⭕ 正确配置</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /app/ </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     http://192.168.154.102:80;    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## backend layer: OpenResty as a front for app.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /app/v3 </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    uwsgi_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">     192.168.154.102:8080;         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## backend layer: uWSGI Python app.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> /app/v4 </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    fastcgi_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   192.168.154.102:8081;         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## backend layer: php-fpm app.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="小心-proxy-pass-指令中的斜杠" tabindex="-1">小心 <code>proxy_pass</code> 指令中的斜杠 <a class="header-anchor" href="#小心-proxy-pass-指令中的斜杠" aria-label="Permalink to &quot;小心 `proxy_pass` 指令中的斜杠&quot;">​</a></h3><blockquote><p>注意尾随斜杠，因为 Nginx 会逐字替换部分，并且您可能会得到一些奇怪的 URL。</p><p>如果 proxy_pass 不带 URI 使用（即 server:port 之后没有路径），Nginx 会将原始请求中的 URI 与所有双斜杠 <code>../</code> 完全一样。</p><p><code>proxy_pass</code> 中的 URI 就像别名指令一样，意味着 Nginx 将用 <code>proxy_pass</code> 指令中的 URI 替换与位置前缀匹配的部分（我故意将其与位置前缀相同），因此 URI 将与请求的相同，但被规范化（没有小写斜杠和其他所有内容） 员工）。</p></blockquote><p>示例：</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> /a </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://127.0.0.1:8080/a;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ^~</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> /a/ </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http://127.0.0.1:8080/a/;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ...</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h4 id="仅使用-host-变量设置和传递-host-头" tabindex="-1">仅使用 <code>$host</code> 变量设置和传递 Host 头 <a class="header-anchor" href="#仅使用-host-变量设置和传递-host-头" aria-label="Permalink to &quot;仅使用 `$host` 变量设置和传递 Host 头&quot;">​</a></h4><blockquote><p>几乎应该始终将 <code>$host</code> 用作传入的主机变量，因为无论用户代理如何行为，它都是保证具有某种意义的唯一变量，除非您特别需要其他变量之一的语义。</p><p>变量 <code>$host</code> 是请求行或 http 头中的主机名。 变量 <code>$server_name</code> 是我们当前所在的服务器块的名称。</p></blockquote><blockquote><p>区别：</p><ul><li><code>$host</code> 包含“按此优先顺序：请求行中的主机名，或“主机”请求标头字段中的主机名，或与请求匹配的服务器名”</li><li>如果请求中包含 HTTP 主机标头字段，则 <code>$http_host</code> 包含该内容（始终等于 HTTP_HOST 请求标头）</li><li><code>$server_name</code> contains the <code>server_name</code> of the virtual host which processed the request, as it was defined in the Nginx configuration. If a server contains multiple server names, only the first one will be present in this variable</li></ul></blockquote><blockquote><p><code>http_host</code>, moreover, is better than <code>$host:$server_port</code> because it uses the port as present in the URL, unlike <code>$server_port</code> which uses the port that Nginx listens on.</p></blockquote><p>示例：</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   Host    $host;</span></span></code></pre></div><h3 id="正确设置-x-forwarded-for-头的值" tabindex="-1">正确设置 <code>X-Forwarded-For</code> 头的值 <a class="header-anchor" href="#正确设置-x-forwarded-for-头的值" aria-label="Permalink to &quot;正确设置 `X-Forwarded-For` 头的值&quot;">​</a></h3><h4 id="rationale-28" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-28" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>In the light of the latest httpoxy vulnerabilities, there is really a need for a full example, how to use <code>HTTP_X_FORWARDED_FOR</code> properly. In short, the load balancer sets the &#39;most recent&#39; part of the header. In my opinion, for security reasons, the proxy servers must be specified by the administrator manually.</p></blockquote><blockquote><p><code>X-Forwarded-For</code> is the custom HTTP header that carries along the original IP address of a client so the app at the other end knows what it is. Otherwise it would only see the proxy IP address, and that makes some apps angry.</p></blockquote><blockquote><p>The <code>X-Forwarded-For</code> depends on the proxy server, which should actually pass the IP address of the client connecting to it. Where a connection passes through a chain of proxy servers, <code>X-Forwarded-For</code> can give a comma-separated list of IP addresses with the first being the furthest downstream (that is, the user). Because of this, servers behind proxy servers need to know which of them are trustworthy.</p></blockquote><blockquote><p>The proxy used can set this header to anything it wants to, and therefore you can&#39;t trust its value. Most proxies do set the correct value though. This header is mostly used by caching proxies, and in those cases you&#39;re in control of the proxy and can thus verify that is gives you the correct information. In all other cases its value should be considered untrustworthy.</p></blockquote><blockquote><p>Some systems also use <code>X-Forwarded-For</code> to enforce access control. A good number of applications rely on knowing the actual IP address of a client to help prevent fraud and enable access.</p></blockquote><blockquote><p>Value of the <code>X-Forwarded-For</code> header field can be set at the client&#39;s side - this can also be termed as <code>X-Forwarded-For</code> spoofing. However, when the web request is made via a proxy server, the proxy server modifies the <code>X-Forwarded-For</code> field by appending the IP address of the client (user). This will result in 2 comma separated IP addresses in the <code>X-Forwarded-For</code> field.</p></blockquote><blockquote><p>A reverse proxy is not source IP address transparent. This is a pain when you need the client source IP address to be correct in the logs of the backend servers. I think the best solution of this problem is configure the load balancer to add/modify an <code>X-Forwarded-For</code> header with the source IP of the client and forward it to the backend in the correct form.</p></blockquote><blockquote><p>Unfortunately, on the proxy side we are not able to solve this problem (all solutions can be spoofable), it is important that this header is correctly interpreted by application servers. Doing so ensures that the apps or downstream services have accurate information on which to make their decisions, including those regarding access and authorization.</p></blockquote><p>There is also an interesing idea what to do in this situation:</p><blockquote><p><em>To prevent this we must distrust that header by default and follow the IP address breadcrumbs backwards from our server. First we need to make sure the <code>REMOTE_ADDR</code> is someone we trust to have appended a proper value to the end of <code>X-Forwarded-For</code>. If so then we need to make sure we trust the <code>X-Forwarded-For</code> IP to have appended the proper IP before it, so on and so forth. Until, finally we get to an IP we don’t trust and at that point we have to assume that’s the IP of our user.</em> - it comes from <a href="https://xyu.io/2013/07/04/proxies-ip-spoofing/" target="_blank" rel="noreferrer">Proxies &amp; IP Spoofing</a> by <a href="https://github.com/xyu" target="_blank" rel="noreferrer">Xiao Yu</a>.</p></blockquote><h4 id="example-26" tabindex="-1">Example <a class="header-anchor" href="#example-26" aria-label="Permalink to &quot;Example&quot;">​</a></h4><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## The whole purpose that it exists is to do the appending behavior:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   X-Forwarded-For    $proxy_add_x_forwarded_for;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## Above is equivalent for this:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   X-Forwarded-For    $http_x_forwarded_for,$remote_addr;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## The following is also equivalent for above but in this example we use http_realip_module:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   X-Forwarded-For    </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">http_x_forwarded_for</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">, $</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">realip_remote_addr</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h4 id="external-resources-27" tabindex="-1">External resources <a class="header-anchor" href="#external-resources-27" aria-label="Permalink to &quot;External resources&quot;">​</a></h4><ul><li><a href="https://totaluptime.com/kb/prevent-x-forwarded-for-spoofing-or-manipulation/" target="_blank" rel="noreferrer">Prevent X-Forwarded-For Spoofing or Manipulation</a></li><li><a href="https://www.sjoerdlangkemper.nl/2017/03/01/bypass-ip-block-with-x-forwarded-for-header/" target="_blank" rel="noreferrer">Bypass IP blocks with the X-Forwarded-For header</a></li><li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Forwarded" target="_blank" rel="noreferrer">Forwarded header</a></li></ul><h3 id="不要在反向代理后面使用带有-scheme-的-x-forwarded-proto" tabindex="-1">不要在反向代理后面使用带有 <code>$scheme</code> 的 <code>X-Forwarded-Proto</code> <a class="header-anchor" href="#不要在反向代理后面使用带有-scheme-的-x-forwarded-proto" aria-label="Permalink to &quot;不要在反向代理后面使用带有 `$scheme` 的 `X-Forwarded-Proto`&quot;">​</a></h3><blockquote><p>反向代理可以设置 <code>X-Forwarded-Proto</code>，以告知应用程序它是 HTTPS 还是 HTTP 甚至是无效名称。schema 变量仅在需要的时候才会被评估（仅用于当前请求）。</p><p>如果设置了 $schema 变量且沿途遇上多个代理，则会导致变形。例如：如果客户端转到<a href="https://example.com" target="_blank" rel="noreferrer">https://example.com</a>，则代理将方案值存储为HTTPS。 如果代理与下一级代理之间的通信是通过 HTTP 进行的，则后端会将方案视为 HTTP。</p></blockquote><p>示例：</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## 1) client &lt;-&gt; proxy &lt;-&gt; backend</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   X-Forwarded-Proto  $scheme;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## 2) client &lt;-&gt; proxy &lt;-&gt; proxy &lt;-&gt; backend</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">## proxy_set_header  X-Forwarded-Proto  https;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   X-Forwarded-Proto  $proxy_x_forwarded_proto;</span></span></code></pre></div><h4 id="始终将-host-x-real-ip-和-x-forwarded-标头传递给后端" tabindex="-1">始终将 Host，X-Real-IP 和 X-Forwarded 标头传递给后端 <a class="header-anchor" href="#始终将-host-x-real-ip-和-x-forwarded-标头传递给后端" aria-label="Permalink to &quot;始终将 Host，X-Real-IP 和 X-Forwarded 标头传递给后端&quot;">​</a></h4><h4 id="rationale-29" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-29" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>When using Nginx as a reverse proxy you may want to pass through some information of the remote client to your backend web server. I think it&#39;s good practices because gives you more control of forwarded headers.</p></blockquote><blockquote><p>It&#39;s very important for servers behind proxy because it allow to interpret the client correctly. Proxies are the &quot;eyes&quot; of such servers, they should not allow a curved perception of reality. If not all requests are passed through a proxy, as a result, requests received directly from clients may contain e.g. inaccurate IP addresses in headers.</p></blockquote><blockquote><p><code>X-Forwarded</code> headers are also important for statistics or filtering. Other example could be access control rules on your app, because without these headers filtering mechanism may not working properly.</p></blockquote><blockquote><p>If you use a front-end service like Apache or whatever else as the front-end to your APIs, you will need these headers to understand what IP or hostname was used to connect to the API.</p></blockquote><blockquote><p>Forwarding these headers is also important if you use the https protocol (it has become a standard nowadays).</p></blockquote><blockquote><p>However, I would not rely on either the presence of all <code>X-Forwarded</code> headers, or the validity of their data.</p></blockquote><h4 id="example-27" tabindex="-1">Example <a class="header-anchor" href="#example-27" aria-label="Permalink to &quot;Example&quot;">​</a></h4><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">         http://bk_upstream_01;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ## The following headers also should pass to the backend:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ##   - Host - host name from the request line, or host name from the Host request header field, or the server name matching a request</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ## proxy_set_header  Host               $host:$server_port;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ## proxy_set_header  Host               $http_host;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   Host               $host;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ##   - X-Real-IP - forwards the real visitor remote IP address to the proxied server</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   X-Real-IP          $remote_addr;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ## X-Forwarded headers stack:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ##   - X-Forwarded-For - mark origin IP of client connecting to server through proxy</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ## proxy_set_header  X-Forwarded-For    $remote_addr;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ## proxy_set_header  X-Forwarded-For    $http_x_forwarded_for,$remote_addr;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ## proxy_set_header  X-Forwarded-For    &quot;$http_x_forwarded_for, $realip_remote_addr&quot;;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   X-Forwarded-For    $proxy_add_x_forwarded_for;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ##   - X-Forwarded-Host - mark origin host of client connecting to server through proxy</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ## proxy_set_header  X-Forwarded-Host   $host:443;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   X-Forwarded-Host   $host:$server_port;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ##   - X-Forwarded-Server - the hostname of the proxy server</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   X-Forwarded-Server $host;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ##   - X-Forwarded-Port - defines the original port requested by the client</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ## proxy_set_header  X-Forwarded-Port   443;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   X-Forwarded-Port   $server_port;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ##   - X-Forwarded-Proto - mark protocol of client connecting to server through proxy</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ## proxy_set_header  X-Forwarded-Proto  https;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  ## proxy_set_header  X-Forwarded-Proto  $proxy_x_forwarded_proto;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">   X-Forwarded-Proto  $scheme;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="prefix-使用不带-x-前缀的自定义头" tabindex="-1">prefix 使用不带 <code>X-</code> 前缀的自定义头 <a class="header-anchor" href="#prefix-使用不带-x-前缀的自定义头" aria-label="Permalink to &quot;prefix 使用不带 `X-` 前缀的自定义头&quot;">​</a></h3><h4 id="rationale-30" tabindex="-1">Rationale <a class="header-anchor" href="#rationale-30" aria-label="Permalink to &quot;Rationale&quot;">​</a></h4><blockquote><p>Internet Engineering Task Force released a new RFC (<a href="https://tools.ietf.org/html/rfc6648" target="_blank" rel="noreferrer">RFC-6648</a>), recommending deprecation of <code>X-</code> prefix.</p></blockquote><blockquote><p>The <code>X-</code> in front of a header name customarily has denoted it as experimental/non-standard/vendor-specific. Once it&#39;s a standard part of HTTP, it&#39;ll lose the prefix.</p></blockquote><blockquote><p>If it’s possible for new custom header to be standardized, use a non-used and meaningful header name.</p></blockquote><blockquote><p>The use of custom headers with <code>X-</code> prefix is not forbidden but discouraged. In other words, you can keep using <code>X-</code> prefixed headers, but it&#39;s not recommended and you may not document them as if they are public standard.</p></blockquote><h4 id="example-28" tabindex="-1">Example <a class="header-anchor" href="#example-28" aria-label="Permalink to &quot;Example&quot;">​</a></h4><p>Not recommended configuration:</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">X-Backend-Server $hostname;</span></span></code></pre></div><p>Recommended configuration:</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">add_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Backend-Server   $hostname;</span></span></code></pre></div><h4 id="external-resources-28" tabindex="-1">External resources <a class="header-anchor" href="#external-resources-28" aria-label="Permalink to &quot;External resources&quot;">​</a></h4><ul><li><a href="https://tools.ietf.org/html/draft-saintandre-xdash-00" target="_blank" rel="noreferrer">Use of the &quot;X-&quot; Prefix in Application Protocols</a></li><li><a href="https://stackoverflow.com/questions/3561381/custom-http-headers-naming-conventions/3561399#3561399" target="_blank" rel="noreferrer">Custom HTTP headers : naming conventions</a></li></ul><h2 id="负载均衡" tabindex="-1">负载均衡 <a class="header-anchor" href="#负载均衡" aria-label="Permalink to &quot;负载均衡&quot;">​</a></h2><p>负载平衡是一种有用的机制，可将传入的流量分布在几个有能力的服务器之间。</p><h3 id="健康检查" tabindex="-1">健康检查 <a class="header-anchor" href="#健康检查" aria-label="Permalink to &quot;健康检查&quot;">​</a></h3><blockquote><p>健康监控对于所有类型的负载平衡都非常重要，主要是为了业务连续性。 被动检查会按照客户端的请求监视通过 Nginx 的连接失败或超时。</p><p>默认情况下启用此功能，但是此处提到的参数允许您调整其行为。 默认值为：<code>max_fails = 1</code> 和 <code>fail_timeout = 10s</code>。</p></blockquote><p>示例：</p><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> backend </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bk01_node:80 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">max_fails</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fail_timeout=5s;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bk02_node:80 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">max_fails</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fail_timeout=5s;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="down-参数" tabindex="-1">down 参数 <a class="header-anchor" href="#down-参数" aria-label="Permalink to &quot;down 参数&quot;">​</a></h3><blockquote><p>有时我们需要关闭后端，例如 在维护时。 我认为良好的解决方案是使用 down 参数将服务器标记为永久不可用，即使停机时间很短也是如此。</p><p>如果您使用 IP 哈希负载平衡技术，那也很重要。 如果其中一台服务器需要临时删除，则应使用此参数进行标记，以保留客户端 IP 地址的当前哈希值。</p><p>注释对于真正永久禁用服务器或要出于历史目的而保留信息非常有用。</p><p>Nginx 还提供了一个备份参数，将该服务器标记为备份服务器。 当主服务器不可用时，将传递请求。 仅当我确定后端将在维护时正常工作时，我才很少将此选项用于上述目的。</p></blockquote><h4 id="示例" tabindex="-1">示例 <a class="header-anchor" href="#示例" aria-label="Permalink to &quot;示例&quot;">​</a></h4><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> backend </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bk01_node:80 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">max_fails</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fail_timeout=5s down;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> bk02_node:80 </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">max_fails</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fail_timeout=5s;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="安全" tabindex="-1">安全 <a class="header-anchor" href="#安全" aria-label="Permalink to &quot;安全&quot;">​</a></h2><h3 id="防盗链" tabindex="-1">防盗链 <a class="header-anchor" href="#防盗链" aria-label="Permalink to &quot;防盗链&quot;">​</a></h3><div class="language-nginx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">nginx</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">location</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ~*</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> \.(gif|jpg|png)$ </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # 只允许 192.168.0.1 请求资源</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    valid_referers </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">none blocked </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">192.168.0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ($invalid_referer) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">       rewrite</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;"> ^/ http://$</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">host/logo.png;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="参考资料" tabindex="-1">参考资料 <a class="header-anchor" href="#参考资料" aria-label="Permalink to &quot;参考资料&quot;">​</a></h2><ul><li><a href="https://juejin.im/post/5d81906c518825300a3ec7ca" target="_blank" rel="noreferrer">nginx 这一篇就够了</a></li></ul></div></div></main><footer class="VPDocFooter" data-v-39a288b8 data-v-d4a0bba5><!--[--><!--]--><div class="edit-info" data-v-d4a0bba5><!----><div class="last-updated" data-v-d4a0bba5><p class="VPLastUpdated" data-v-d4a0bba5 data-v-7e05ebdb>Last updated: <time datetime="2024-06-24T13:55:08.000Z" data-v-7e05ebdb></time></p></div></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-d4a0bba5><span class="visually-hidden" id="doc-footer-aria-label" data-v-d4a0bba5>Pager</span><div class="pager" data-v-d4a0bba5><a class="VPLink link pager-link prev" href="/nginx/02-nginx-ops.html" data-v-d4a0bba5><!--[--><span class="desc" data-v-d4a0bba5>Previous page</span><span class="title" data-v-d4a0bba5>02-nginx-ops</span><!--]--></a></div><div class="pager" data-v-d4a0bba5><a class="VPLink link pager-link next" href="/nginx/04-nginx-faq.html" data-v-d4a0bba5><!--[--><span class="desc" data-v-d4a0bba5>Next page</span><span class="title" data-v-d4a0bba5>04-nginx-faq</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-5d98c3a5 data-v-e315a0ad><div class="container" data-v-e315a0ad><!----><p class="copyright" data-v-e315a0ad>Copyright © 2024-present Etsuyou</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"algorithm_structure.md\":\"DaD3PJL7\",\"algorithm_linked_list.md\":\"Be5SJe9g\",\"algorithm_binarysearch.md\":\"D1eLoPmc\",\"algorithm_sort.md\":\"D_nKEVT3\",\"algorithm_design2.md\":\"DDV93pHz\",\"algorithm_stack_queue.md\":\"BeMvD4FN\",\"algorithm_time_space.md\":\"Ccwaftil\",\"algorithm_mergesort.md\":\"D0KRkfkU\",\"algorithm_algorithm.md\":\"Dz1y6q5H\",\"applet_applet.md\":\"BfnCz71g\",\"algorithm_heap.md\":\"BDMT4c5b\",\"applet_webview_jscore.md\":\"D89suBs7\",\"algorithm_bubblesort.md\":\"oxLodSHF\",\"algorithm_quicksort.md\":\"GzDqaog8\",\"applet_login.md\":\"DN8V26Fs\",\"algorithm_insertionsort.md\":\"B4VErLkX\",\"algorithm_tree.md\":\"DLCKbNMy\",\"applet_optimization.md\":\"IqhtpyPT\",\"applet_requestpayment.md\":\"BMlgxVrf\",\"css_css_performance.md\":\"BFb7NKpE\",\"css_bfc.md\":\"DyRg1ZR_\",\"css_box.md\":\"mTWCbYzn\",\"applet_lifecycle.md\":\"VkNOU2ZN\",\"css_animation.md\":\"CLgaabL5\",\"css_css3_features.md\":\"CJgcTzwu\",\"applet_publish.md\":\"BQdxgwZr\",\"algorithm_design1.md\":\"Djwn2w_n\",\"applet_navigate.md\":\"Bix06TCi\",\"algorithm_set.md\":\"_t7slnBR\",\"algorithm_graph.md\":\"Cwtz8YiQ\",\"css_center.md\":\"BSKu7hGP\",\"css_em_px_rem_vh_vw.md\":\"DTefSw43\",\"algorithm_selectionsort.md\":\"D77-afSk\",\"css_responsive_layout.md\":\"X0YIxTOO\",\"css_grid.md\":\"DVnv1_ff\",\"css_hide_attributes.md\":\"CKmeRadk\",\"css_less_12px.md\":\"mHuWXt6Q\",\"css_dp_px_dpr_ppi.md\":\"DItaB0GI\",\"css_column_layout.md\":\"CZdoBiv-\",\"css_flexbox.md\":\"BDFSDh1r\",\"css_layout_painting.md\":\"DN5Oxcc2\",\"css_single_multi_line.md\":\"BuZ2Rx9E\",\"design_factory_pattern.md\":\"GHacSbDx\",\"css_triangle.md\":\"CBL4-8-S\",\"css_visual_scrolling.md\":\"DrcNMrGI\",\"css_sass_less_stylus.md\":\"x15wpPvS\",\"css_selector.md\":\"CEpxQv2t\",\"design_design.md\":\"DnC34OkB\",\"design_observer_pattern.md\":\"CgobX4Ft\",\"es6_decorator.md\":\"BdOAM4G4\",\"design_proxy_pattern.md\":\"DyWE8-U_\",\"design_singleton_pattern.md\":\"BVolp3TO\",\"es6_function.md\":\"DjEqVzSF\",\"design_strategy_pattern.md\":\"xcLoJXet\",\"es6_array.md\":\"OmeU0aXF\",\"git_version_control.md\":\"f1AVv7br\",\"es6_var_let_const.md\":\"BefuBFTU\",\"es6_generator.md\":\"D2WWSpGx\",\"git_git.md\":\"Djd8mugv\",\"git_head_tree_index.md\":\"CeIHEFMa\",\"git_git_reset_ git_revert.md\":\"CJYOoK-h\",\"es6_module.md\":\"Cw4RQO8S\",\"es6_proxy.md\":\"Dz0XLjBp\",\"git_conflict.md\":\"0v8Rngpl\",\"git_git_pull_git_fetch.md\":\"CqmKchOq\",\"git_git_stash.md\":\"CrgchnE2\",\"es6_promise.md\":\"BCB4sU6s\",\"es6_object.md\":\"BwQ-fACO\",\"git_fork_clone_branch.md\":\"DH9LukZl\",\"git_command.md\":\"DdHl23SK\",\"git_git_rebase_ git_merge.md\":\"Dl1Mqkiv\",\"es6_set_map.md\":\"CT8yzWN9\",\"http_headers.md\":\"-nviz1od\",\"http_websocket.md\":\"DnR2zQ_F\",\"interview_index.md\":\"CuUX9_k_\",\"http_tcp_ip.md\":\"BV_ReY5q\",\"http_http_https.md\":\"Ddb17Swj\",\"http_dns.md\":\"Dq2hyrVD\",\"http_https.md\":\"ag2kGjot\",\"http_udp_tcp.md\":\"CeO0yUXG\",\"http_1.0_1.1_2.0.md\":\"oCrfthHU\",\"http_osi.md\":\"BQTHwV2m\",\"http_cdn.md\":\"CyeDVgJa\",\"http_handshakes_waves.md\":\"CU2vKA5V\",\"interview_css.md\":\"6aVkzXGj\",\"index.md\":\"pcSGiX6k\",\"http_get_post.md\":\"oB3A3HVh\",\"http_after_url.md\":\"VUVITt42\",\"http_status.md\":\"Bzg1Vjc8\",\"interview_vue_class_summary.md\":\"VIopvdiK\",\"interview_miniapp.md\":\"lRiLaYjm\",\"javascript_ajax.md\":\"j1SGWoCv\",\"javascript_cache.md\":\"DoNN-2A-\",\"javascript_context_stack.md\":\"yBW4U3If\",\"javascript_bom.md\":\"-8bQBYch\",\"javascript_______.md\":\"Dxk0RaAP\",\"javascript_dom.md\":\"oLAIusIX\",\"javascript_bind_call_apply.md\":\"BpxeEVd-\",\"javascript_closure.md\":\"Dt73jtXc\",\"javascript_array_api.md\":\"1jRaKPGz\",\"interview_vue.md\":\"C-Vtzubs\",\"javascript_data_type.md\":\"DA4waK9h\",\"javascript_continue_to_upload.md\":\"BHEFI5VF\",\"javascript_copy.md\":\"Bv-gIuXK\",\"javascript_event_agent.md\":\"D2CnZZBS\",\"javascript_event_model.md\":\"D5O5Pb9N\",\"javascript_debounce_throttle.md\":\"CxIsfVUU\",\"interview_vue-hangzhou.md\":\"DIiMyubg\",\"javascript_loss_accuracy.md\":\"DhrMxZNj\",\"javascript_function_cache.md\":\"hysXNqEi\",\"javascript_new.md\":\"BPcI2Orc\",\"javascript_memory_leak.md\":\"BDJIiQBD\",\"javascript_prototype.md\":\"BVfDdwfq\",\"javascript_js_data_structure.md\":\"CpHjAqac\",\"javascript_event_loop.md\":\"D7e7gVpQ\",\"javascript_inherit.md\":\"CyuJxbDQ\",\"javascript_functional_programming.md\":\"qCVbPFfV\",\"javascript_scope.md\":\"CWJdlfgu\",\"javascript_single_sign.md\":\"BiuMi23y\",\"javascript_tail_recursion.md\":\"DVXDJ7MR\",\"javascript_regexp.md\":\"BPrkP169\",\"javascript_string_api.md\":\"Cn21oxHk\",\"javascript_pull_up_loading_pull_down_refresh.md\":\"FAMOqa75\",\"javascript_security.md\":\"B2-T9Bes\",\"javascript_type_conversion.md\":\"Bxz5lGUG\",\"linux_thread_process.md\":\"BItz4PlH\",\"linux_file.md\":\"Bt__hwBy\",\"linux_linux.md\":\"C5pr1TUT\",\"linux_shell.md\":\"Q1DSkdpk\",\"interview_js.md\":\"5AKxgbhR\",\"linux_linux_users.md\":\"BrIN1T0T\",\"javascript_typeof_instanceof.md\":\"9ZL29TWn\",\"linux_vim.md\":\"C7CKsopt\",\"markdown.md\":\"BlubeR16\",\"linux_redirect_pipe.md\":\"D72BnxoA\",\"nginx_00-nginx-introduction.md\":\"CJcXIgTP\",\"nginx_01-nginx-quickstart.md\":\"D0teYg2E\",\"javascript_visible.md\":\"PHtKSTP3\",\"javascript_this.md\":\"CKIGWM7a\",\"nginx_04-nginx-faq.md\":\"Zg56zvPz\",\"nodejs_stream.md\":\"eMZegDf8\",\"nodejs_buffer.md\":\"OtnRu_Z-\",\"nodejs_event_loop.md\":\"C0sAmwgA\",\"nodejs_file_upload.md\":\"DQeAwZ3A\",\"nginx_02-nginx-ops.md\":\"C7xTcYrp\",\"nodejs_eventemitter.md\":\"B7LgplY3\",\"nodejs_nodejs.md\":\"Dm6Fs9Sx\",\"nodejs_process.md\":\"B9wlo09t\",\"tutorial_00-前端工具_03-网络抓包和代理工具：whistle.md\":\"Bb8wyJE_\",\"nodejs_require_order.md\":\"Dp2tcHcE\",\"nodejs_global.md\":\"PsiIsJf6\",\"nodejs_performance.md\":\"DJRnaCN8\",\"nodejs_middleware.md\":\"C0iW51ib\",\"nodejs_jwt.md\":\"SmUQFaPT\",\"nodejs_paging.md\":\"MSEQSrzl\",\"nodejs_fs.md\":\"D_BLGhp8\",\"tutorial_00-前端工具_vs code的使用积累.md\":\"B-pNgVMo\",\"tutorial_00-前端工具_02-git的使用.md\":\"D8RJl6Eu\",\"tutorial_00-前端工具_mac安装和配置iterm2.md\":\"CO2eP6Bd\",\"tutorial_00-前端工具_github的使用.md\":\"CEuh7nkX\",\"tutorial_01-html_01-认识web和web标准.md\":\"THi-SwGe\",\"tutorial_00-前端工具_atom在前端的使用.md\":\"BkI-NTa_\",\"tutorial_00-前端工具_04-解决 git 不区分大小写导致的文件冲突问题.md\":\"C2JEJBOH\",\"tutorial_01-html_06-html标签：图片标签.md\":\"CHbXJ3Nw\",\"tutorial_00-前端工具_iconmoon.md\":\"7t7QlgHI\",\"tutorial_00-前端工具_sublime text在前端中的使用.md\":\"Dglltm6J\",\"tutorial_00-前端工具_01-vs code的使用.md\":\"DII3heSP\",\"tutorial_00-前端工具_webstorm的使用.md\":\"Dp2xJO27\",\"tutorial_00-前端工具_chrome浏览器.md\":\"BP2vCf82\",\"tutorial_01-html_05-html标签：字体标签和超链接.md\":\"BLS6ELZm\",\"tutorial_00-前端工具_emmet in vs code.md\":\"tFaFkcE7\",\"tutorial_01-html_02-浏览器的介绍.md\":\"DWrJr0oI\",\"tutorial_01-html_04-html标签：排版标签.md\":\"UnntLncb\",\"nginx_03-nginx-configuration.md\":\"DTJfc777\",\"tutorial_01-html_07-html标签图文详解（二）.md\":\"6eBICBrV\",\"tutorial_01-html_12-html基础回顾.md\":\"CQcaJHj1\",\"tutorial_01-html_09-html5举例：简单的视频播放器.md\":\"Do345cOE\",\"tutorial_02-css基础_05-css样式表的继承性和层叠性.md\":\"D7UtBS-a\",\"tutorial_01-html_03-初识html.md\":\"CTbryuJq\",\"tutorial_01-html_11-html5详解（三）.md\":\"D3coukHQ\",\"tutorial_02-css基础_01-css属性：字体属性和文本属性.md\":\"B64mTht7\",\"tutorial_02-css基础_04-css选择器：伪类.md\":\"DOspVvQ7\",\"tutorial_02-css基础_07-浮动.md\":\"BeyhozXa\",\"tutorial_01-html_08-html5详解.md\":\"DjF2PoF1\",\"tutorial_02-css基础_06-css盒模型详解.md\":\"BkxZApRD\",\"tutorial_01-html_10-html5详解（二）.md\":\"u5mxWthF\",\"tutorial_02-css基础_10-css3选择器详解.md\":\"BmICJGAi\",\"tutorial_02-css基础_02-css属性：背景属性.md\":\"2WGiRIfL\",\"tutorial_02-css基础_03-css样式表和选择器.md\":\"3Zu6RgiU\",\"tutorial_02-css基础_08-css属性：定位属性.md\":\"ByeenI0R\",\"tutorial_02-css基础_15-sass入门.md\":\"BDduwRA0\",\"tutorial_03-css进阶_00-准备.md\":\"DWEaFkre\",\"tutorial_03-css进阶_01-css中的非布局样式.md\":\"BCuuKU_V\",\"tutorial_02-css基础_14-css3属性详解：web字体.md\":\"CDIn_Mgz\",\"tutorial_03-css进阶_02-css布局.md\":\"DL-UU4ph\",\"tutorial_02-css基础_16-浏览器的兼容性问题.md\":\"BilmO4Ij\",\"tutorial_02-css基础_others.md\":\"BfKShMRs\",\"tutorial_02-css基础_11-css3属性详解（一）.md\":\"BLI24G0P\",\"tutorial_03-css进阶_css开发积累.md\":\"DYfkFQN8\",\"tutorial_03-css进阶_css的一些小知识.md\":\"sON4q1EB\",\"tutorial_03-css进阶_css文章推荐.md\":\"Cu8t8l6c\",\"tutorial_index.md\":\"C3TGtaR9\",\"tutorial_03-css进阶_css面试题.md\":\"K6tGeKUt\",\"tutorial_02-css基础_09-css案例讲解：博雅互动.md\":\"DsOqpCiY\",\"tutorial_03-css进阶_03-网页设计和开发中，关于字体的常识.md\":\"m7teD6N2\",\"tutorial_02-css基础_13-css3属性：flex布局图文详解.md\":\"BgNnDNvH\",\"typescript_function.md\":\"BM8JEqOg\",\"typescript_high_type.md\":\"BjDyxF1c\",\"typescript_generic.md\":\"2HKr_Bpn\",\"typescript_data_type.md\":\"DK3Ezvub\",\"typescript_class.md\":\"Du3BXhDF\",\"tutorial_03-css进阶_04-如何让一个元素水平垂直居中？.md\":\"CxEcc8-x\",\"typescript_decorator.md\":\"DyM22_eD\",\"typescript_enum.md\":\"BoUU9-Zf\",\"tutorial_02-css基础_17-css3的常见边框汇总.md\":\"Bm6TOgQH\",\"typescript_typescript_javascript.md\":\"BPgUO1xD\",\"typescript_vue.md\":\"Ei2OecWj\",\"typescript_namespace_module.md\":\"B5CqGWht\",\"vue_axios.md\":\"CkjuF_SB\",\"typescript_react.md\":\"ClV2sBx9\",\"vue_components_plugin.md\":\"B7dYCRJk\",\"typescript_interface.md\":\"Di9g1n4l\",\"vue_404.md\":\"C-OzG4ge\",\"vue_communication.md\":\"WacB1lUo\",\"tutorial_02-css基础_12-css3属性详解：动画详解.md\":\"CEYrBLZ5\",\"vue_cors.md\":\"DvWdBBOy\",\"vue_data_object_add_attrs.md\":\"DGWJJPr0\",\"vue_bind.md\":\"BJCgwLmO\",\"vue_data.md\":\"DFXIRbaK\",\"vue_error.md\":\"Wj3gox_8\",\"vue_if_for.md\":\"CHGrSldV\",\"vue_first_page_time.md\":\"CTozARdm\",\"vue_diff.md\":\"DCXwQIvB\",\"vue_directive.md\":\"B7xYhnm5\",\"vue_axioscode.md\":\"D7WVFj84\",\"vue_filter.md\":\"B7V-cpI1\",\"vue_lifecycle.md\":\"CTobxY0Z\",\"vue_nexttick.md\":\"DAFaaSfJ\",\"vue_show_if.md\":\"DhogZVA3\",\"vue_keepalive.md\":\"DJ5lgwSo\",\"vue_key.md\":\"DcKXKyqg\",\"vue_new_vue.md\":\"DlmMmlmV\",\"vue_observable.md\":\"DyPEDDMt\",\"vue_mixin.md\":\"7PuKohVh\",\"vue_modifier.md\":\"BRIOtU_9\",\"vue_spa.md\":\"KWUhjnJU\",\"vue_slot.md\":\"BJNWZwTO\",\"vue3_composition.md\":\"DxR9Iv8W\",\"vue_vue3_vue2.md\":\"BpFOPn15\",\"vue3_goal.md\":\"soaibG42\",\"vue_structure.md\":\"DgAQ0Uwu\",\"vue3_performance.md\":\"Bq-FHZbt\",\"vue_vue.md\":\"CiHLPJxx\",\"vue_permission.md\":\"DuzRw2El\",\"vue_ssr.md\":\"BUyXA2fn\",\"vue3_treeshaking.md\":\"DNd86WVA\",\"vue3_modal_component.md\":\"B1Aaswm8\",\"vue_vnode.md\":\"B8ed6-b0\",\"webpack_hmr.md\":\"CjESKkrM\",\"webpack_proxy.md\":\"CcUMK2D9\",\"webpack_loader_plugin.md\":\"BtKzwQ0F\",\"webpack_rollup_parcel_snowpack_vite.md\":\"BMgjDW9Y\",\"webpack_improve_build.md\":\"Ut9KumRx\",\"webpack_build_process.md\":\"CPUPtumC\",\"webpack_plugin.md\":\"DlKus2Rn\",\"webpack_loader.md\":\"BJigqpw7\",\"vue3_proxy.md\":\"DWa55Jv-\",\"参考_index2222.md\":\"Bz7Z0Gcn\",\"参考_api-examples.md\":\"CFBQ2Xyo\",\"webpack_webpack.md\":\"DdrhCDL8\",\"参考_markdown-examples.md\":\"BhOW3iTD\",\"webpack_performance.md\":\"6l_84CAg\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"前端笔记\",\"description\":\"整理了常见的前端面试问题，希望对大家有所帮助\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"outlineTitle\":\"文章目录\",\"outline\":[2,6],\"search\":{\"provider\":\"local\",\"options\":{\"translations\":{\"button\":{\"buttonText\":\"搜索文档\",\"buttonAriaLabel\":\"搜索文档\"},\"modal\":{\"noResultsText\":\"无法找到相关结果\",\"resetButtonTitle\":\"清除查询条件\",\"footer\":{\"selectText\":\"选择\",\"navigateText\":\"切换\"}}}}},\"nav\":[{\"text\":\"面试题\",\"items\":[{\"text\":\"CSS\",\"link\":\"/interview/css\"},{\"text\":\"JS\",\"link\":\"/interview/js\"},{\"text\":\"小程序\",\"link\":\"/interview/miniapp\"},{\"text\":\"Vue\",\"link\":\"/interview/vue-hangzhou\"}]},{\"text\":\"部署\",\"items\":[{\"text\":\"nginx\",\"link\":\"/nginx/00-nginx-introduction\"}]},{\"text\":\"教程\",\"items\":[{\"text\":\"介绍\",\"link\":\"/tutorial/index\"},{\"text\":\"教程目录\",\"items\":[{\"text\":\"00-前端工具\",\"link\":\"/tutorial/00-前端工具/01-VS Code的使用\"},{\"text\":\"01-HTML\",\"link\":\"/tutorial/01-HTML/01-认识Web和Web标准\"},{\"text\":\"02-CSS基础\",\"link\":\"/tutorial/02-CSS基础/01-CSS属性：字体属性和文本属性\"},{\"text\":\"03-CSS进阶\",\"link\":\"/tutorial/03-CSS进阶/00-准备\"}]}]},{\"text\":\"面试官系列\",\"items\":[{\"text\":\"Vue系列\",\"items\":[{\"text\":\"Vue\",\"link\":\"/vue/vue\"},{\"text\":\"Vue3\",\"link\":\"/vue3/goal\"}]},{\"text\":\"JavaScript系列\",\"items\":[{\"text\":\"JavaScript\",\"link\":\"/javascript/data_type\"},{\"text\":\"ES6\",\"link\":\"/es6/var_let_const\"},{\"text\":\"TypeScript\",\"link\":\"/typescript/typescript_javascript\"}]},{\"text\":\"CSS系列\",\"items\":[{\"text\":\"CSS\",\"link\":\"/css/box\"}]},{\"text\":\"小程序系列\",\"items\":[{\"text\":\"小程序\",\"link\":\"/applet/applet\"}]},{\"text\":\"环境和打包系列\",\"items\":[{\"text\":\"Webpack\",\"link\":\"/webpack/webpack\"},{\"text\":\"NodeJS\",\"link\":\"/nodejs/nodejs\"}]},{\"text\":\"计算机通识\",\"items\":[{\"text\":\"HTTP\",\"link\":\"/http/HTTP_HTTPS\"},{\"text\":\"算法与数据结构\",\"link\":\"/algorithm/Algorithm\"},{\"text\":\"Linux\",\"link\":\"/linux/linux\"},{\"text\":\"版本控制\",\"link\":\"/git/Version_control\"},{\"text\":\"设计模式\",\"link\":\"/design/design\"}]}]}],\"sidebar\":{\"/interview/\":[{\"text\":\"面试题汇总\",\"items\":[{\"text\":\"CSS\",\"items\":[{\"text\":\"CSS面试题\",\"link\":\"/interview/css\"}]},{\"text\":\"JS\",\"items\":[{\"text\":\"JS面试题\",\"link\":\"/interview/js\"}]},{\"text\":\"小程序\",\"items\":[{\"text\":\"小程序面试题\",\"link\":\"/interview/miniapp\"}]},{\"text\":\"Vue\",\"items\":[{\"text\":\"Vue面试题-杭州\",\"link\":\"/interview/vue-hangzhou\"},{\"text\":\"Vue面试题\",\"link\":\"/interview/vue\"},{\"text\":\"Vue重难点\",\"link\":\"/interview/Vue_class_summary\"}]}]}],\"/tutorial/00-前端工具/\":[{\"text\":\"00-前端工具\",\"items\":[{\"text\":\"01-VS Code的使用\",\"link\":\"/tutorial/00-前端工具/01-VS Code的使用.md\"},{\"text\":\"02-Git的使用\",\"link\":\"/tutorial/00-前端工具/02-Git的使用.md\"},{\"text\":\"03-网络抓包和代理工具：Whistle\",\"link\":\"/tutorial/00-前端工具/03-网络抓包和代理工具：Whistle.md\"},{\"text\":\"04-解决 Git 不区分大小写导致的文件冲突问题\",\"link\":\"/tutorial/00-前端工具/04-解决 Git 不区分大小写导致的文件冲突问题.md\"},{\"text\":\"Atom在前端的使用\",\"link\":\"/tutorial/00-前端工具/Atom在前端的使用.md\"},{\"text\":\"chrome浏览器\",\"link\":\"/tutorial/00-前端工具/chrome浏览器.md\"},{\"text\":\"Emmet in VS Code\",\"link\":\"/tutorial/00-前端工具/Emmet in VS Code.md\"},{\"text\":\"GitHub的使用\",\"link\":\"/tutorial/00-前端工具/GitHub的使用.md\"},{\"text\":\"iconMoon\",\"link\":\"/tutorial/00-前端工具/iconMoon.md\"},{\"text\":\"Mac安装和配置iTerm2\",\"link\":\"/tutorial/00-前端工具/Mac安装和配置iTerm2.md\"},{\"text\":\"Sublime Text在前端中的使用\",\"link\":\"/tutorial/00-前端工具/Sublime Text在前端中的使用.md\"},{\"text\":\"VS Code的使用积累\",\"link\":\"/tutorial/00-前端工具/VS Code的使用积累.md\"},{\"text\":\"WebStorm的使用\",\"link\":\"/tutorial/00-前端工具/WebStorm的使用.md\"}]}],\"/tutorial/01-HTML/\":[{\"text\":\"01-HTML\",\"items\":[{\"text\":\"01-认识Web和Web标准\",\"link\":\"/tutorial/01-HTML/01-认识Web和Web标准.md\"},{\"text\":\"02-浏览器的介绍\",\"link\":\"/tutorial/01-HTML/02-浏览器的介绍.md\"},{\"text\":\"03-初识HTML\",\"link\":\"/tutorial/01-HTML/03-初识HTML.md\"},{\"text\":\"04-HTML标签：排版标签\",\"link\":\"/tutorial/01-HTML/04-HTML标签：排版标签.md\"},{\"text\":\"05-HTML标签：字体标签和超链接\",\"link\":\"/tutorial/01-HTML/05-HTML标签：字体标签和超链接.md\"},{\"text\":\"06-HTML标签：图片标签\",\"link\":\"/tutorial/01-HTML/06-HTML标签：图片标签.md\"},{\"text\":\"07-html标签图文详解（二）\",\"link\":\"/tutorial/01-HTML/07-html标签图文详解（二）.md\"},{\"text\":\"08-HTML5详解\",\"link\":\"/tutorial/01-HTML/08-HTML5详解.md\"},{\"text\":\"09-HTML5举例：简单的视频播放器\",\"link\":\"/tutorial/01-HTML/09-HTML5举例：简单的视频播放器.md\"},{\"text\":\"10-HTML5详解（二）\",\"link\":\"/tutorial/01-HTML/10-HTML5详解（二）.md\"},{\"text\":\"11-HTML5详解（三）\",\"link\":\"/tutorial/01-HTML/11-HTML5详解（三）.md\"},{\"text\":\"12-HTML基础回顾\",\"link\":\"/tutorial/01-HTML/12-HTML基础回顾.md\"}]}],\"/tutorial/02-CSS基础/\":[{\"text\":\"02-CSS基础\",\"items\":[{\"text\":\"01-CSS属性：字体属性和文本属性\",\"link\":\"/tutorial/02-CSS基础/01-CSS属性：字体属性和文本属性.md\"},{\"text\":\"02-CSS属性：背景属性\",\"link\":\"/tutorial/02-CSS基础/02-CSS属性：背景属性.md\"},{\"text\":\"03-CSS样式表和选择器\",\"link\":\"/tutorial/02-CSS基础/03-CSS样式表和选择器.md\"},{\"text\":\"04-CSS选择器：伪类\",\"link\":\"/tutorial/02-CSS基础/04-CSS选择器：伪类.md\"},{\"text\":\"05-CSS样式表的继承性和层叠性\",\"link\":\"/tutorial/02-CSS基础/05-CSS样式表的继承性和层叠性.md\"},{\"text\":\"06-CSS盒模型详解\",\"link\":\"/tutorial/02-CSS基础/06-CSS盒模型详解.md\"},{\"text\":\"07-浮动\",\"link\":\"/tutorial/02-CSS基础/07-浮动.md\"},{\"text\":\"08-CSS属性：定位属性\",\"link\":\"/tutorial/02-CSS基础/08-CSS属性：定位属性.md\"},{\"text\":\"09-CSS案例讲解：博雅互动\",\"link\":\"/tutorial/02-CSS基础/09-CSS案例讲解：博雅互动.md\"},{\"text\":\"10-CSS3选择器详解\",\"link\":\"/tutorial/02-CSS基础/10-CSS3选择器详解.md\"},{\"text\":\"11-CSS3属性详解（一）\",\"link\":\"/tutorial/02-CSS基础/11-CSS3属性详解（一）.md\"},{\"text\":\"12-CSS3属性详解：动画详解\",\"link\":\"/tutorial/02-CSS基础/12-CSS3属性详解：动画详解.md\"},{\"text\":\"13-CSS3属性：Flex布局图文详解\",\"link\":\"/tutorial/02-CSS基础/13-CSS3属性：Flex布局图文详解.md\"},{\"text\":\"14-CSS3属性详解：Web字体\",\"link\":\"/tutorial/02-CSS基础/14-CSS3属性详解：Web字体.md\"},{\"text\":\"15-Sass入门\",\"link\":\"/tutorial/02-CSS基础/15-Sass入门.md\"},{\"text\":\"16-浏览器的兼容性问题\",\"link\":\"/tutorial/02-CSS基础/16-浏览器的兼容性问题.md\"},{\"text\":\"17-CSS3的常见边框汇总\",\"link\":\"/tutorial/02-CSS基础/17-CSS3的常见边框汇总.md\"},{\"text\":\"others\",\"link\":\"/tutorial/02-CSS基础/others.md\"}]}],\"/tutorial/03-CSS进阶/\":[{\"text\":\"03-CSS进阶\",\"items\":[{\"text\":\"00-准备\",\"link\":\"/tutorial/03-CSS进阶/00-准备.md\"},{\"text\":\"01-CSS中的非布局样式\",\"link\":\"/tutorial/03-CSS进阶/01-CSS中的非布局样式.md\"},{\"text\":\"02-CSS布局\",\"link\":\"/tutorial/03-CSS进阶/02-CSS布局.md\"},{\"text\":\"03-网页设计和开发中，关于字体的常识\",\"link\":\"/tutorial/03-CSS进阶/03-网页设计和开发中，关于字体的常识.md\"},{\"text\":\"04-如何让一个元素水平垂直居中？\",\"link\":\"/tutorial/03-CSS进阶/04-如何让一个元素水平垂直居中？.md\"},{\"text\":\"CSS开发积累\",\"link\":\"/tutorial/03-CSS进阶/CSS开发积累.md\"},{\"text\":\"CSS文章推荐\",\"link\":\"/tutorial/03-CSS进阶/CSS文章推荐.md\"},{\"text\":\"CSS的一些小知识\",\"link\":\"/tutorial/03-CSS进阶/CSS的一些小知识.md\"},{\"text\":\"CSS面试题\",\"link\":\"/tutorial/03-CSS进阶/CSS面试题.md\"}]}],\"/nginx/\":[{\"text\":\"Nginx教程\",\"items\":[{\"text\":\"00-nginx-introduction\",\"link\":\"/nginx/00-nginx-introduction.md\"},{\"text\":\"01-nginx-quickstart\",\"link\":\"/nginx/01-nginx-quickstart.md\"},{\"text\":\"02-nginx-ops\",\"link\":\"/nginx/02-nginx-ops.md\"},{\"text\":\"03-nginx-configuration\",\"link\":\"/nginx/03-nginx-configuration.md\"},{\"text\":\"04-nginx-faq\",\"link\":\"/nginx/04-nginx-faq.md\"}]}],\"/vue3/\":[{\"text\":\"Vue3\",\"items\":[{\"text\":\"vue3目录\",\"items\":[{\"text\":\"Vue3.0的设计目标是什么 做了哪些优化\",\"link\":\"/vue3/goal\"},{\"text\":\"Vue3.0 性能提升主要是通过哪几方面体现的\",\"link\":\"/vue3/performance\"},{\"text\":\"Vue3.0里为什么要用 Proxy API 替代 defineProperty API ？\",\"link\":\"/vue3/proxy\"},{\"text\":\"Vue3.0 所采用的 Composition Api 与 Vue2.x 使用的 Options Api 有什么不同？\",\"link\":\"/vue3/composition\"},{\"text\":\"说说Vue 3.0中Treeshaking特性？举例说明一下？\",\"link\":\"/vue3/treeshaking\"},{\"text\":\"用Vue3.0 写过组件吗？如果想实现一个 Modal你会怎么设计？\",\"link\":\"/vue3/modal_component\"}]}]}],\"/vue/\":[{\"text\":\"Vue\",\"items\":[{\"text\":\"Vue目录\",\"items\":[{\"text\":\"说说你对vue的理解?\",\"link\":\"/vue/vue\"},{\"text\":\"说说你对SPA（单页应用）的理解?\",\"link\":\"/vue/spa\"},{\"text\":\"Vue中的v-show和v-if怎么理解？\",\"link\":\"/vue/show_if\"},{\"text\":\"Vue实例挂载的过程中发生了什么?\",\"link\":\"/vue/new_vue\"},{\"text\":\"说说你对Vue生命周期的理解?\",\"link\":\"/vue/lifecycle\"},{\"text\":\"为什么Vue中的v-if和v-for不建议一起用?\",\"link\":\"/vue/if_for\"},{\"text\":\"SPA（单页应用）首屏加载速度慢怎么解决？\",\"link\":\"/vue/first_page_time\"},{\"text\":\"为什么data属性是一个函数而不是一个对象？\",\"link\":\"/vue/data\"},{\"text\":\"Vue中给对象添加新属性界面不刷新?\",\"link\":\"/vue/data_object_add_attrs\"},{\"text\":\"Vue中组件和插件有什么区别？\",\"link\":\"/vue/components_plugin\"},{\"text\":\"Vue组件间通信方式都有哪些?\",\"link\":\"/vue/communication\"},{\"text\":\"说说你对双向绑定的理解?\",\"link\":\"/vue/bind\"},{\"text\":\"说说你对nexttick的理解?\",\"link\":\"/vue/nexttick\"},{\"text\":\"说说你对vue的mixin的理解，有什么应用场景？\",\"link\":\"/vue/mixin\"},{\"text\":\"说说你对slot的理解？slot使用场景有哪些？\",\"link\":\"/vue/slot\"},{\"text\":\"Vue.observable你有了解过吗？说说看\",\"link\":\"/vue/observable\"},{\"text\":\"你知道vue中key的原理吗？说说你对它的理解？\",\"link\":\"/vue/key\"},{\"text\":\"怎么缓存当前的组件？缓存后怎么更新？说说你对keep-alive的理解是什么？\",\"link\":\"/vue/keepalive\"},{\"text\":\"Vue常用的修饰符有哪些？有什么应用场景？\",\"link\":\"/vue/modifier\"},{\"text\":\"你有写过自定义指令吗？自定义指令的应用场景有哪些？\",\"link\":\"/vue/directive\"},{\"text\":\"Vue中的过滤器了解吗？过滤器的应用场景有哪些？\",\"link\":\"/vue/filter\"},{\"text\":\"什么是虚拟DOM？如何实现一个虚拟DOM？说说你的思路\",\"link\":\"/vue/vnode\"},{\"text\":\"你了解vue的diff算法吗？说说看\",\"link\":\"/vue/diff\"},{\"text\":\"Vue项目中有封装过axios吗？主要是封装哪方面的？\",\"link\":\"/vue/axios\"},{\"text\":\"你了解axios的原理吗？有看过它的源码吗？\",\"link\":\"/vue/axiosCode\"},{\"text\":\"SSR解决了什么问题？有做过SSR吗？你是怎么做的？\",\"link\":\"/vue/ssr\"},{\"text\":\"说下你的vue项目的目录结构，如果是大型项目你该怎么划分结构和划分组件呢？\",\"link\":\"/vue/structure\"},{\"text\":\"vue要做权限管理该怎么做？如果控制到按钮级别的权限怎么做？\",\"link\":\"/vue/permission\"},{\"text\":\"Vue项目中你是如何解决跨域的呢？\",\"link\":\"/vue/cors\"},{\"text\":\"vue项目本地开发完成后部署到服务器后报404是什么原因呢？\",\"link\":\"/vue/404\"},{\"text\":\"你是怎么处理vue项目中的错误的？\",\"link\":\"/vue/error\"},{\"text\":\"Vue3有了解过吗？能说说跟Vue2的区别吗？\",\"link\":\"/vue/vue3_vue2\"}]}]}],\"/es6/\":[{\"text\":\"ES6\",\"items\":[{\"text\":\"说说var、let、const之间的区别\",\"link\":\"/es6/var_let_const\"},{\"text\":\"ES6中数组新增了哪些扩展?\",\"link\":\"/es6/array\"},{\"text\":\"ES6中对象新增了哪些扩展?\",\"link\":\"/es6/object\"},{\"text\":\"ES6中函数新增了哪些扩展?\",\"link\":\"/es6/function\"},{\"text\":\"ES6中新增的Set、Map两种数据结构怎么理解?\",\"link\":\"/es6/set_map\"},{\"text\":\"你是怎么理解ES6中 Promise的？使用场景？\",\"link\":\"/es6/promise\"},{\"text\":\"怎么理解ES6中 Generator的？使用场景？\",\"link\":\"/es6/generator\"},{\"text\":\"你是怎么理解ES6中Proxy的？使用场景?\",\"link\":\"/es6/proxy\"},{\"text\":\"你是怎么理解ES6中Module的？使用场景？\",\"link\":\"/es6/module\"},{\"text\":\"你是怎么理解ES6中 Decorator 的？使用场景？\",\"link\":\"/es6/decorator\"}]}],\"/javascript/\":[{\"text\":\"JavaScript\",\"items\":[{\"text\":\"说说JavaScript中的数据类型？存储上的差别？\",\"link\":\"/javascript/data_type\"},{\"text\":\"数组的常用方法有哪些？\",\"link\":\"/javascript/array_api\"},{\"text\":\"JavaScript字符串的常用方法有哪些？\",\"link\":\"/javascript/string_api\"},{\"text\":\"谈谈 JavaScript 中的类型转换机制\",\"link\":\"/javascript/type_conversion\"},{\"text\":\"== 和 ===区别，分别在什么情况使用\",\"link\":\"/javascript/==_===\"},{\"text\":\"深拷贝浅拷贝的区别？如何实现一个深拷贝？\",\"link\":\"/javascript/copy\"},{\"text\":\"说说你对闭包的理解？闭包使用场景\",\"link\":\"/javascript/closure\"},{\"text\":\"说说你对作用域链的理解\",\"link\":\"/javascript/scope\"},{\"text\":\"JavaScript原型，原型链 ? 有什么特点？\",\"link\":\"/javascript/prototype\"},{\"text\":\"Javascript如何实现继承？\",\"link\":\"/javascript/inherit\"},{\"text\":\"谈谈this对象的理解\",\"link\":\"/javascript/this\"},{\"text\":\"JavaScript中执行上下文和执行栈是什么？\",\"link\":\"/javascript/context_stack\"},{\"text\":\"说说JavaScript中的事件模型\",\"link\":\"/javascript/event_Model\"},{\"text\":\"typeof 与 instanceof 区别\",\"link\":\"/javascript/typeof_instanceof\"},{\"text\":\"解释下什么是事件代理？应用场景？\",\"link\":\"/javascript/event_agent\"},{\"text\":\"说说new操作符具体干了什么？\",\"link\":\"/javascript/new\"},{\"text\":\"ajax原理是什么？如何实现？\",\"link\":\"/javascript/ajax\"},{\"text\":\"bind、call、apply 区别？如何实现一个bind?\",\"link\":\"/javascript/bind_call_apply\"},{\"text\":\"说说你对正则表达式的理解？应用场景？\",\"link\":\"/javascript/regexp\"},{\"text\":\"说说你对事件循环的理解\",\"link\":\"/javascript/event_loop\"},{\"text\":\"DOM常见的操作有哪些？\",\"link\":\"/javascript/Dom\"},{\"text\":\"说说你对BOM的理解，常见的BOM对象你了解哪些？\",\"link\":\"/javascript/BOM\"},{\"text\":\"举例说明你对尾递归的理解，有哪些应用场景\",\"link\":\"/javascript/tail_recursion\"},{\"text\":\"说说 JavaScript 中内存泄漏的几种情况？\",\"link\":\"/javascript/memory_leak\"},{\"text\":\"Javascript本地存储的方式有哪些？区别及应用场景？\",\"link\":\"/javascript/cache\"},{\"text\":\"说说你对函数式编程的理解？优缺点？\",\"link\":\"/javascript/functional_programming\"},{\"text\":\"Javascript中如何实现函数缓存？函数缓存有哪些应用场景？\",\"link\":\"/javascript/function_cache\"},{\"text\":\"说说 Javascript 数字精度丢失的问题，如何解决？\",\"link\":\"/javascript/loss_accuracy\"},{\"text\":\"什么是防抖和节流？有什么区别？如何实现？\",\"link\":\"/javascript/debounce_throttle\"},{\"text\":\"如何判断一个元素是否在可视区域中？\",\"link\":\"/javascript/visible\"},{\"text\":\"大文件上传如何做断点续传？\",\"link\":\"/javascript/continue_to_upload\"},{\"text\":\"如何实现上拉加载，下拉刷新？\",\"link\":\"/javascript/pull_up_loading_pull_down_refresh\"},{\"text\":\"什么是单点登录？如何实现？\",\"link\":\"/javascript/single_sign\"},{\"text\":\"web常见的攻击方式有哪些？如何防御？\",\"link\":\"/javascript/security\"}]}],\"/css/\":[{\"text\":\"CSS\",\"items\":[{\"text\":\"说说你对盒子模型的理解?\",\"link\":\"/css/box\"},{\"text\":\"css选择器有哪些？优先级？哪些属性可以继承？\",\"link\":\"/css/selector\"},{\"text\":\"说说em/px/rem/vh/vw区别?\",\"link\":\"/css/em_px_rem_vh_vw\"},{\"text\":\"说说设备像素、css像素、设备独立像素、dpr、ppi 之间的区别？\",\"link\":\"/css/dp_px_dpr_ppi\"},{\"text\":\"css中，有哪些方式可以隐藏页面元素？区别?\",\"link\":\"/css/hide_attributes\"},{\"text\":\"谈谈你对BFC的理解？\",\"link\":\"/css/BFC\"},{\"text\":\"元素水平垂直居中的方法有哪些？如果元素不定宽高呢？\",\"link\":\"/css/center\"},{\"text\":\"如何实现两栏布局，右侧自适应？三栏布局中间自适应呢？\",\"link\":\"/css/column_layout\"},{\"text\":\"说说flexbox（弹性盒布局模型）,以及适用场景？\",\"link\":\"/css/flexbox\"},{\"text\":\"介绍一下grid网格布局\",\"link\":\"/css/grid\"},{\"text\":\"CSS3新增了哪些新特性？\",\"link\":\"/css/css3_features\"},{\"text\":\"css3动画有哪些？\",\"link\":\"/css/animation\"},{\"text\":\"怎么理解回流跟重绘？什么场景下会触发？\",\"link\":\"/css/layout_painting\"},{\"text\":\"什么是响应式设计？响应式设计的基本原理是什么？如何做？\",\"link\":\"/css/responsive_layout\"},{\"text\":\"如果要做优化，CSS提高性能的方法有哪些？\",\"link\":\"/css/css_performance\"},{\"text\":\"如何实现单行／多行文本溢出的省略样式？\",\"link\":\"/css/single_multi_line\"},{\"text\":\"如何使用css完成视差滚动效果?\",\"link\":\"/css/visual_scrolling\"},{\"text\":\"CSS如何画一个三角形？原理是什么？\",\"link\":\"/css/triangle\"},{\"text\":\"让Chrome支持小于12px 的文字方式有哪些？区别？\",\"link\":\"/css/less_12px\"},{\"text\":\"说说对Css预编语言的理解？有哪些区别?\",\"link\":\"/css/sass_less_stylus\"}]}],\"/webpack/\":[{\"text\":\"Webpack\",\"items\":[{\"text\":\"说说你对webpack的理解？解决了什么问题？\",\"link\":\"/webpack/webpack\"},{\"text\":\"说说webpack的构建流程?\",\"link\":\"/webpack/build_process\"},{\"text\":\"说说webpack中常见的Loader？解决了什么问题？\",\"link\":\"/webpack/Loader\"},{\"text\":\"说说webpack中常见的Plugin？解决了什么问题？\",\"link\":\"/webpack/Plugin\"},{\"text\":\"说说Loader和Plugin的区别？编写Loader，Plugin的思路？\",\"link\":\"/webpack/Loader_Plugin\"},{\"text\":\"说说webpack的热更新是如何做到的？原理是什么？\",\"link\":\"/webpack/HMR\"},{\"text\":\"说说webpack proxy工作原理？为什么能解决跨域?\",\"link\":\"/webpack/proxy\"},{\"text\":\"说说如何借助webpack来优化前端性能？\",\"link\":\"/webpack/performance\"},{\"text\":\"如何提高webpack的构建速度？\",\"link\":\"/webpack/improve_build\"},{\"text\":\"与webpack类似的工具还有哪些？区别？\",\"link\":\"/webpack/Rollup_Parcel_snowpack_Vite\"}]}],\"/http/\":[{\"text\":\"HTTP\",\"items\":[{\"text\":\"什么是HTTP? HTTP 和 HTTPS 的区别?\",\"link\":\"/http/HTTP_HTTPS\"},{\"text\":\"为什么说HTTPS比HTTP安全? HTTPS是如何保证安全的？\",\"link\":\"/http/HTTPS\"},{\"text\":\"如何理解UDP 和 TCP? 区别? 应用场景?\",\"link\":\"/http/UDP_TCP\"},{\"text\":\"如何理解OSI七层模型?\",\"link\":\"/http/OSI\"},{\"text\":\"如何理解TCP/IP协议?\",\"link\":\"/http/TCP_IP\"},{\"text\":\"DNS协议 是什么？说说DNS 完整的查询过程?\",\"link\":\"/http/DNS\"},{\"text\":\"如何理解CDN？说说实现原理？\",\"link\":\"/http/CDN\"},{\"text\":\"说说 HTTP1.0/1.1/2.0 的区别?\",\"link\":\"/http/1.0_1.1_2.0\"},{\"text\":\"说说 HTTP 常见的状态码有哪些，适用场景？\",\"link\":\"/http/status\"},{\"text\":\"说一下 GET 和 POST 的区别？\",\"link\":\"/http/GET_POST\"},{\"text\":\"说说 HTTP 常见的请求头有哪些? 作用？\",\"link\":\"/http/headers\"},{\"text\":\"说说地址栏输入 URL 敲下回车后发生了什么？\",\"link\":\"/http/after_url\"},{\"text\":\"说说TCP为什么需要三次握手和四次挥手？\",\"link\":\"/http/handshakes_waves\"},{\"text\":\"说说对WebSocket的理解？应用场景？\",\"link\":\"/http/WebSocket\"}]}],\"/nodejs/\":[{\"text\":\"NodeJS\",\"items\":[{\"text\":\"说说你对 Node.js 的理解？优缺点？应用场景？\",\"link\":\"/nodejs/nodejs\"},{\"text\":\"说说 Node.js 有哪些全局对象？\",\"link\":\"/nodejs/global\"},{\"text\":\"说说对 Node 中的 process 的理解？有哪些常用方法？\",\"link\":\"/nodejs/process\"},{\"text\":\"说说对 Node 中的 fs模块的理解? 有哪些常用方法\",\"link\":\"/nodejs/fs\"},{\"text\":\"说说对 Node 中的 Buffer 的理解？应用场景？\",\"link\":\"/nodejs/Buffer\"},{\"text\":\"说说对 Node 中的 Stream 的理解？应用场景？\",\"link\":\"/nodejs/Stream\"},{\"text\":\"说说Node中的EventEmitter? 如何实现一个EventEmitter?\",\"link\":\"/nodejs/EventEmitter\"},{\"text\":\"说说对 Nodejs 中的事件循环机制理解?\",\"link\":\"/nodejs/event_loop\"},{\"text\":\"说说 Node 文件查找的优先级以及 Require 方法的文件查找策略?\",\"link\":\"/nodejs/require_order\"},{\"text\":\"说说对中间件概念的理解，如何封装 node 中间件？\",\"link\":\"/nodejs/middleware\"},{\"text\":\"如何实现jwt鉴权机制？说说你的思路\",\"link\":\"/nodejs/jwt\"},{\"text\":\"如何实现文件上传？说说你的思路\",\"link\":\"/nodejs/file_upload\"},{\"text\":\"如果让你来设计一个分页功能, 你会怎么设计? 前后端如何交互?\",\"link\":\"/nodejs/paging\"},{\"text\":\"Node性能如何进行监控以及优化？\",\"link\":\"/nodejs/performance\"}]}],\"/git/\":[{\"text\":\"版本控制\",\"items\":[{\"text\":\"说说你对版本管理的理解？常用的版本管理工具有哪些？\",\"link\":\"/git/Version_control\"},{\"text\":\"说说你对Git的理解？\",\"link\":\"/git/Git\"},{\"text\":\"说说Git中 fork, clone,branch这三个概念，有什么区别?\",\"link\":\"/git/fork_clone_branch\"},{\"text\":\"说说Git常用的命令有哪些？\",\"link\":\"/git/command\"},{\"text\":\"说说Git 中 HEAD、工作树和索引之间的区别？\",\"link\":\"/git/HEAD_tree_index\"},{\"text\":\"说说对git pull 和 git fetch 的理解？有什么区别？\",\"link\":\"/git/git_pull_git_fetch\"},{\"text\":\"说说你对git stash 的理解？应用场景？\",\"link\":\"/git/git_stash\"},{\"text\":\"说说你对git rebase 和 git merge的理解？区别？\",\"link\":\"/git/git_rebase_ git_merge\"},{\"text\":\"说说 git 发生冲突的场景？如何解决？\",\"link\":\"/git/conflict\"},{\"text\":\"说说你对git reset 和 git revert 的理解？区别？\",\"link\":\"/git/git_reset_ git_revert\"}]}],\"/linux/\":[{\"text\":\"操作系统\",\"items\":[{\"text\":\"说说你对操作系统的理解？核心概念有哪些？\",\"link\":\"/linux/linux\"},{\"text\":\"说说什么是进程？什么是线程？区别？\",\"link\":\"/linux/thread_process\"},{\"text\":\"说说 linux系统下 文件操作常用的命令有哪些？\",\"link\":\"/linux/file\"},{\"text\":\"说说 linux 系统下 文本编辑常用的命令有哪些？\",\"link\":\"/linux/vim\"},{\"text\":\"说说你对 linux 用户管理的理解？相关的命令有哪些？\",\"link\":\"/linux/linux_users\"},{\"text\":\"说说你对输入输出重定向和管道的理解？应用场景？\",\"link\":\"/linux/redirect_pipe\"},{\"text\":\"说说你对 shell 的理解？常见的命令？\",\"link\":\"/linux/shell\"}]}],\"/typescript/\":[{\"text\":\"TypeScript\",\"items\":[{\"text\":\"说说你对 TypeScript 的理解？与 JavaScript 的区别？\",\"link\":\"/typescript/typescript_javascript\"},{\"text\":\"说说 typescript 的数据类型有哪些？\",\"link\":\"/typescript/data_type\"},{\"text\":\"说说你对 TypeScript 中枚举类型的理解？应用场景？\",\"link\":\"/typescript/enum\"},{\"text\":\"说说你对 TypeScript 中接口的理解？应用场景？\",\"link\":\"/typescript/interface\"},{\"text\":\"说说你对 TypeScript 中类的理解？应用场景？\",\"link\":\"/typescript/class\"},{\"text\":\"说说你对 TypeScript 中函数的理解？与 JavaScript 函数的区别？\",\"link\":\"/typescript/function\"},{\"text\":\"说说你对 TypeScript 中泛型的理解？应用场景？\",\"link\":\"/typescript/generic\"},{\"text\":\"说说你对 TypeScript 中高级类型的理解？有哪些？\",\"link\":\"/typescript/high_type\"},{\"text\":\"说说你对 TypeScript 装饰器的理解？应用场景？\",\"link\":\"/typescript/decorator\"},{\"text\":\"说说对 TypeScript 中命名空间与模块的理解？区别？\",\"link\":\"/typescript/namespace_module\"},{\"text\":\"说说如何在 React 项目中应用 TypeScript？\",\"link\":\"/typescript/react\"},{\"text\":\"说说如何在Vue项目中应用TypeScript？\",\"link\":\"/typescript/vue\"}]}],\"/algorithm/\":[{\"text\":\"算法与数据结构\",\"items\":[{\"text\":\"说说你对算法的理解？应用场景？\",\"link\":\"/algorithm/Algorithm\"},{\"text\":\"说说你对算法中时间复杂度，空间复杂度的理解？如何计算？\",\"link\":\"/algorithm/time_space\"},{\"text\":\"说说你对数据结构的理解？有哪些？区别？\",\"link\":\"/algorithm/structure\"},{\"text\":\"说说你对栈、队列的理解？应用场景？\",\"link\":\"/algorithm/stack_queue\"},{\"text\":\"说说你对链表的理解？常见的操作有哪些？\",\"link\":\"/algorithm/Linked_List\"},{\"text\":\"说说你对集合的理解？常见的操作有哪些？\",\"link\":\"/algorithm/set\"},{\"text\":\"说说你对树的理解？相关的操作有哪些？\",\"link\":\"/algorithm/tree\"},{\"text\":\"说说你对堆的理解？如何实现？应用场景？\",\"link\":\"/algorithm/Heap\"},{\"text\":\"说说你对图的理解？相关操作有哪些？\",\"link\":\"/algorithm/graph\"},{\"text\":\"说说常见的排序算法有哪些？区别？\",\"link\":\"/algorithm/sort\"},{\"text\":\"说说你对冒泡排序的理解？如何实现？应用场景？\",\"link\":\"/algorithm/bubbleSort\"},{\"text\":\"说说你对选择排序的理解？如何实现？应用场景？\",\"link\":\"/algorithm/selectionSort\"},{\"text\":\"说说你对插入排序的理解？如何实现？应用场景？\",\"link\":\"/algorithm/insertionSort\"},{\"text\":\"说说你对归并排序的理解？如何实现？应用场景？\",\"link\":\"/algorithm/mergeSort\"},{\"text\":\"说说你对快速排序的理解？如何实现？应用场景？\",\"link\":\"/algorithm/quickSort\"},{\"text\":\"说说你对二分查找的理解？如何实现？应用场景？\",\"link\":\"/algorithm/BinarySearch\"},{\"text\":\"说说说你对分而治之、动态规划的理解？区别？\",\"link\":\"/algorithm/design1\"},{\"text\":\"说说你对贪心算法、回溯算法的理解？应用场景？\",\"link\":\"/algorithm/design2\"}]}],\"/applet/\":[{\"text\":\"小程序\",\"items\":[{\"text\":\"说说你对微信小程序的理解？优缺点？\",\"link\":\"/applet/applet\"},{\"text\":\"说说微信小程序的生命周期函数有哪些？\",\"link\":\"/applet/lifecycle\"},{\"text\":\"说说微信小程序中路由跳转的方式有哪些？区别？\",\"link\":\"/applet/navigate\"},{\"text\":\"说说提高微信小程序的应用速度的手段有哪些？\",\"link\":\"/applet/optimization\"},{\"text\":\"说说微信小程序的登录流程？\",\"link\":\"/applet/login\"},{\"text\":\"说说微信小程序的发布流程？\",\"link\":\"/applet/publish\"},{\"text\":\"说说微信小程序的支付流程？\",\"link\":\"/applet/requestPayment\"},{\"text\":\"说说微信小程序的实现原理？\",\"link\":\"/applet/WebView_jscore\"}]}],\"/design/\":[{\"text\":\"设计模式\",\"items\":[{\"text\":\"说说对设计模式的理解？常见的设计模式有哪些？\",\"link\":\"/design/design\"},{\"text\":\"说说你对单例模式的理解？如何实现？\",\"link\":\"/design/Singleton_Pattern\"},{\"text\":\"说说你对工厂模式的理解？应用场景？\",\"link\":\"/design/Factory_Pattern\"},{\"text\":\"说说你对策略模式的理解？应用场景？\",\"link\":\"/design/Strategy_Pattern\"},{\"text\":\"说说你对代理模式的理解？应用场景？\",\"link\":\"/design/Proxy_Pattern\"},{\"text\":\"说说你对发布订阅、观察者模式的理解？区别？\",\"link\":\"/design/Observer_Pattern\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/etsuyou\"},{\"icon\":{\"svg\":\"\\n            <svg t=\\\"1713377554330\\\" class=\\\"icon\\\" viewBox=\\\"0 0 1024 1024\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" p-id=\\\"12062\\\" data-darkreader-inline-fill=\\\"\\\" width=\\\"200\\\" height=\\\"200\\\"><path d=\\\"M511.317333 0A512 512 0 0 0 0 512a512 512 0 0 0 512 512 512 512 0 0 0 512-512A512 512 0 0 0 512 0a512 512 0 0 0-0.682667 0z m259.84 227.541333c13.994667 0 25.301333 11.349333 25.258667 25.301334v63.232a25.344 25.344 0 0 1-25.301333 25.258666H417.152c-41.898667 0-75.861333 33.962667-75.861333 75.861334v240.213333c0 13.952 11.349333 25.258667 25.301333 25.258667h240.213333c41.898667 0 75.861333-33.962667 75.861334-75.861334v-12.629333a25.301333 25.301333 0 0 0-25.258667-25.301333h-177.066667a25.258667 25.258667 0 0 1-25.258666-25.258667v-63.232a25.301333 25.301333 0 0 1 25.301333-25.258667h290.773333c13.952 0 25.301333 11.306667 25.301334 25.258667v145.408a170.666667 170.666667 0 0 1-170.666667 170.666667H252.842667a25.301333 25.301333 0 0 1-25.301334-25.301334V417.194667a189.610667 189.610667 0 0 1 189.653334-189.610667h353.962666z\\\" p-id=\\\"12063\\\"></path></svg>\"},\"link\":\"https://gitee.com/etsuyou\"},{\"icon\":{\"svg\":\"\\n            <svg t=\\\"1713377220319\\\" class=\\\"icon\\\" viewBox=\\\"0 0 1024 1024\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" p-id=\\\"4260\\\" data-darkreader-inline-fill=\\\"\\\" width=\\\"200\\\" height=\\\"200\\\"><path d=\\\"M977.2 208.2c33.4 36.2 48.8 79.4 46.6 131.4v404.8c-0.8 52.8-18.4 96.2-53 130.2-34.4 34-78.2 51.8-131 53.4H184.04c-52.9-1.6-96.42-19.6-130.56-54.4C19.364 838.8 1.534 793 0 736.4V339.6c1.534-52 19.364-95.2 53.48-131.4C87.62 175.5 131.14 157.54 184.04 156h58.76L192.1 104.38c-11.5-11.46-17.26-26-17.26-43.58 0-17.6 5.76-32.12 17.26-43.594C203.6 5.736 218.2 0 235.8 0s32.2 5.736 43.8 17.206L426.2 156h176l149-138.794C763.4 5.736 778.4 0 796 0c17.6 0 32.2 5.736 43.8 17.206 11.4 11.474 17.2 25.994 17.2 43.594 0 17.58-5.8 32.12-17.2 43.58L789.2 156h58.6c52.8 1.54 96 19.5 129.4 52.2z m-77.6 139.4c-0.8-19.2-7.4-34.8-21.4-47-10.4-12.2-28-18.8-45.4-19.6H192.1c-19.18 0.8-34.9 7.4-47.16 19.6-12.28 12.2-18.8 27.8-19.56 47v388.8c0 18.4 6.52 34 19.56 47s28.76 19.6 47.16 19.6H832.8c18.4 0 34-6.6 46.6-19.6 12.6-13 19.4-28.6 20.2-47V347.6z m-528.6 85.4c12.6 12.6 19.4 28.2 20.2 46.4V546c-0.8 18.4-7.4 33.8-19.6 46.4-12.4 12.6-28 19-47.2 19-19.2 0-35-6.4-47.2-19-12.2-12.6-18.8-28-19.6-46.4v-66.6c0.8-18.2 7.6-33.8 20.2-46.4 12.6-12.6 26.4-19.2 46.6-20 18.4 0.8 34 7.4 46.6 20z m383 0c12.6 12.6 19.4 28.2 20.2 46.4V546c-0.8 18.4-7.4 33.8-19.6 46.4-12.2 12.6-28 19-47.2 19-19.2 0-34.8-6.4-47.2-19-14-12.6-18.8-28-19.4-46.4v-66.6c0.6-18.2 7.4-33.8 20-46.4 12.6-12.6 28.2-19.2 46.6-20 18.4 0.8 34 7.4 46.6 20z\\\" p-id=\\\"4261\\\"></path></svg>\"},\"link\":\"https://space.bilibili.com/13716124\"}],\"footer\":{\"copyright\":\"Copyright © 2024-present Etsuyou\"},\"logo\":\"/1024x1024.png\"},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>